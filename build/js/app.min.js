!function(){"use strict";function createCommonjsModule(a,b){return b={exports:{}},a(b,b.exports),b.exports}function _typeof(a){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function earcut(a,b,c){c=c||2;var d=b&&b.length,e=d?b[0]*c:a.length,f=linkedList(a,0,e,c,!0),g=[];if(!f||f.next===f.prev)return g;var h,i,j,k,l,m,n;if(d&&(f=eliminateHoles(a,b,f,c)),a.length>80*c){h=j=a[0],i=k=a[1];for(var o=c;o<e;o+=c)l=a[o],m=a[o+1],l<h&&(h=l),m<i&&(i=m),l>j&&(j=l),m>k&&(k=m);n=Math.max(j-h,k-i),n=0!==n?1/n:0}return earcutLinked(f,g,c,h,i,n),g}function linkedList(a,b,c,d,e){var f,g;if(e===signedArea(a,b,c,d)>0)for(f=b;f<c;f+=d)g=insertNode(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=insertNode(f,a[f],a[f+1],g);return g&&equals(g,g.next)&&(removeNode(g),g=g.next),g}function filterPoints(a,b){if(!a)return a;b||(b=a);var c,d=a;do{if(c=!1,d.steiner||!equals(d,d.next)&&0!==area(d.prev,d,d.next))d=d.next;else{if(removeNode(d),(d=b=d.prev)===d.next)break;c=!0}}while(c||d!==b);return b}function earcutLinked(a,b,c,d,e,f,g){if(a){!g&&f&&indexCurve(a,d,e,f);for(var h,i,j=a;a.prev!==a.next;)if(h=a.prev,i=a.next,f?isEarHashed(a,d,e,f):isEar(a))b.push(h.i/c),b.push(a.i/c),b.push(i.i/c),removeNode(a),a=i.next,j=i.next;else if((a=i)===j){g?1===g?(a=cureLocalIntersections(a,b,c),earcutLinked(a,b,c,d,e,f,2)):2===g&&splitEarcut(a,b,c,d,e,f):earcutLinked(filterPoints(a),b,c,d,e,f,1);break}}}function isEar(a){var b=a.prev,c=a,d=a.next;if(area(b,c,d)>=0)return!1;for(var e=a.next.next;e!==a.prev;){if(pointInTriangle(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&area(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function isEarHashed(a,b,c,d){var e=a.prev,f=a,g=a.next;if(area(e,f,g)>=0)return!1;for(var h=e.x<f.x?e.x<g.x?e.x:g.x:f.x<g.x?f.x:g.x,i=e.y<f.y?e.y<g.y?e.y:g.y:f.y<g.y?f.y:g.y,j=e.x>f.x?e.x>g.x?e.x:g.x:f.x>g.x?f.x:g.x,k=e.y>f.y?e.y>g.y?e.y:g.y:f.y>g.y?f.y:g.y,l=zOrder(h,i,b,c,d),m=zOrder(j,k,b,c,d),n=a.prevZ,o=a.nextZ;n&&n.z>=l&&o&&o.z<=m;){if(n!==a.prev&&n!==a.next&&pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;if(n=n.prevZ,o!==a.prev&&o!==a.next&&pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,o.x,o.y)&&area(o.prev,o,o.next)>=0)return!1;o=o.nextZ}for(;n&&n.z>=l;){if(n!==a.prev&&n!==a.next&&pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.prevZ}for(;o&&o.z<=m;){if(o!==a.prev&&o!==a.next&&pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,o.x,o.y)&&area(o.prev,o,o.next)>=0)return!1;o=o.nextZ}return!0}function cureLocalIntersections(a,b,c){var d=a;do{var e=d.prev,f=d.next.next;!equals(e,f)&&intersects(e,d,d.next,f)&&locallyInside(e,f)&&locallyInside(f,e)&&(b.push(e.i/c),b.push(d.i/c),b.push(f.i/c),removeNode(d),removeNode(d.next),d=a=f),d=d.next}while(d!==a);return d}function splitEarcut(a,b,c,d,e,f){var g=a;do{for(var h=g.next.next;h!==g.prev;){if(g.i!==h.i&&isValidDiagonal(g,h)){var i=splitPolygon(g,h);return g=filterPoints(g,g.next),i=filterPoints(i,i.next),earcutLinked(g,b,c,d,e,f),void earcutLinked(i,b,c,d,e,f)}h=h.next}g=g.next}while(g!==a)}function eliminateHoles(a,b,c,d){var e,f,g,h,i,j=[];for(e=0,f=b.length;e<f;e++)g=b[e]*d,h=e<f-1?b[e+1]*d:a.length,i=linkedList(a,g,h,d,!1),i===i.next&&(i.steiner=!0),j.push(getLeftmost(i));for(j.sort(compareX),e=0;e<j.length;e++)eliminateHole(j[e],c),c=filterPoints(c,c.next);return c}function compareX(a,b){return a.x-b.x}function eliminateHole(a,b){if(b=findHoleBridge(a,b)){var c=splitPolygon(b,a);filterPoints(c,c.next)}}function findHoleBridge(a,b){var c,d=b,e=a.x,f=a.y,g=-1/0;do{if(f<=d.y&&f>=d.next.y&&d.next.y!==d.y){var h=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(h<=e&&h>g){if(g=h,h===e){if(f===d.y)return d;if(f===d.next.y)return d.next}c=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!c)return null;if(e===g)return c.prev;var i,j=c,k=c.x,l=c.y,m=1/0;for(d=c.next;d!==j;)e>=d.x&&d.x>=k&&e!==d.x&&pointInTriangle(f<l?e:g,f,k,l,f<l?g:e,f,d.x,d.y)&&((i=Math.abs(f-d.y)/(e-d.x))<m||i===m&&d.x>c.x)&&locallyInside(d,a)&&(c=d,m=i),d=d.next;return c}function indexCurve(a,b,c,d){var e=a;do{null===e.z&&(e.z=zOrder(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next}while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,sortLinked(e)}function sortLinked(a){var b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;b<j&&(h++,d=d.nextZ);b++);for(i=j;h>0||i>0&&d;)0!==h&&(0===i||!d||c.z<=d.z)?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1);return a}function zOrder(a,b,c,d,e){return a=32767*(a-c)*e,b=32767*(b-d)*e,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1}function getLeftmost(a){var b=a,c=a;do{(b.x<c.x||b.x===c.x&&b.y<c.y)&&(c=b),b=b.next}while(b!==a);return c}function pointInTriangle(a,b,c,d,e,f,g,h){return(e-g)*(b-h)-(a-g)*(f-h)>=0&&(a-g)*(d-h)-(c-g)*(b-h)>=0&&(c-g)*(f-h)-(e-g)*(d-h)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function equals(a,b){return a.x===b.x&&a.y===b.y}function intersects(a,b,c,d){return!!(equals(a,b)&&equals(c,d)||equals(a,d)&&equals(c,b))||area(a,b,c)>0!=area(a,b,d)>0&&area(c,d,a)>0!=area(c,d,b)>0}function intersectsPolygon(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&intersects(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do{c.y>f!=c.next.y>f&&c.next.y!==c.y&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next}while(c!==a);return d}function splitPolygon(a,b){var c=new Node(a.i,a.x,a.y),d=new Node(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function insertNode(a,b,c,d){var e=new Node(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function removeNode(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Node(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(a,b,c,d){for(var e=0,f=b,g=c-d;f<c;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}!function(a){var b={};"function"==typeof define&&define.amd?define([],function(){return{me:b}}):"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.me=b),"undefined"!=typeof window?window.me=b:void 0!==a&&(a.me=b)}(window),function(){"undefined"==typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}}),function(){var a,b=0,c=["ms","moz","webkit","o"],d=window.requestAnimationFrame,e=window.cancelAnimationFrame;for(a=0;a<c.length&&!d;++a)d=window[c[a]+"RequestAnimationFrame"];for(a=0;a<c.length&&!e;++a)e=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"];d&&e||(d=function(a){var c=window.performance.now(),d=Math.max(0,1e3/60-(c-b)),e=window.setTimeout(function(){a(c+d)},d);return b=c+d,e},e=function(a){window.clearTimeout(a)},window.requestAnimationFrame=d,window.cancelAnimationFrame=e)}()}();var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jayExtend=createCommonjsModule(function(a){!function(){function b(){function a(){return this.init.apply(this,arguments),this}for(var e={},f=new Array(arguments.length),g=0;g<arguments.length;g++)f.push(arguments[g]);if(a.prototype=Object.create(this.prototype),f.forEach(function(b){c(a,e,b.__methods__||b)}),!("init"in a.prototype))throw new TypeError("extend: Class is missing a constructor named `init`");return Object.defineProperty(a.prototype,"_super",{value:d}),Object.defineProperty(a,"__methods__",{value:e}),a.extend=b,a}function c(a,b,c){Object.keys(c).forEach(function(d){if(b[d]=c[d],"function"!=typeof c[d])throw new TypeError("extend: Method `"+d+"` is not a function");Object.defineProperty(a.prototype,d,{configurable:!0,value:c[d]})})}function d(a,b,c){return a.prototype[b].apply(this,c)}var e=function(){Object.apply(this,arguments)};e.prototype=Object.create(Object.prototype),e.prototype.constructor=e,Object.defineProperty(e,"extend",{value:b}),"undefined"!=typeof window?window.Jay=e:a.exports=e}()});me.Object=window.Jay,function(){var a=function(a){return a.substring(0,1).toUpperCase()+a.substring(1,a.length)};me.agent=function(){var b={},c=["ms","MS","moz","webkit","o"];return b.prefixed=function(b,d){if(d=d||window,b in d)return d[b];var e,f=a(b);return c.some(function(a){var b=a+f;return e=b in d?d[b]:void 0}),e},b.setPrefixed=function(b,d,e){if(e=e||window,b in e)return void(e[b]=d);var f=a(b);c.some(function(a){var b=a+f;return b in e&&(e[b]=d,!0)})},b}()}(),function(){me.device=function(){function a(a){c.accelerationX=a.accelerationIncludingGravity.x,c.accelerationY=a.accelerationIncludingGravity.y,c.accelerationZ=a.accelerationIncludingGravity.z}function b(a){c.gamma=a.gamma,c.beta=a.beta,c.alpha=a.alpha}var c={},d=!1,e=!1,f=!0,g=function(a){return a.preventDefault(),"function"==typeof window.scroll&&window.scroll(0,0),!1},h=!1,i=!1,j=[];return c._domReady=function(a){if(!i){if(!document.body)return setTimeout(me.device._domReady,13);for(document.removeEventListener&&document.removeEventListener("DOMContentLoaded",me.device._domReady,!1),window.removeEventListener("load",me.device._domReady,!1);j.length;)j.shift().call(window,[]);i=!0}},c._check=function(){me.device._detectDevice(),me.device.isMobile&&c.enableSwipe(!1),me.device.TouchEvent=!!("ontouchstart"in window),me.device.PointerEvent=!!window.PointerEvent,window.gesture=me.agent.prefixed("gesture"),me.device.touch=me.device.TouchEvent||me.device.PointerEvent,me.device.maxTouchPoints=me.device.touch?me.device.PointerEvent?navigator.maxTouchPoints||1:10:1,me.device.wheel="onwheel"in document.createElement("div"),me.device.hasAccelerometer=void 0!==window.DeviceMotionEvent,this.hasPointerLockSupport=me.agent.prefixed("pointerLockElement",document),this.hasPointerLockSupport&&(document.exitPointerLock=me.agent.prefixed("exitPointerLock",document)),window.DeviceOrientationEvent&&(me.device.hasDeviceOrientation=!0),this.hasFullscreenSupport=me.agent.prefixed("fullscreenEnabled",document)||document.mozFullScreenEnabled,document.exitFullscreen=me.agent.prefixed("cancelFullScreen",document)||me.agent.prefixed("exitFullscreen",document),navigator.vibrate=me.agent.prefixed("vibrate",navigator),this.hasWebAudio=!(!window.AudioContext&&!window.webkitAudioContext);try{c.localStorage=!!window.localStorage}catch(a){c.localStorage=!1}window.addEventListener("blur",function(){me.sys.stopOnBlur&&me.state.stop(!0),me.sys.pauseOnBlur&&me.state.pause(!0)},!1),window.addEventListener("focus",function(){me.sys.stopOnBlur&&me.state.restart(!0),me.sys.resumeOnFocus&&me.state.resume(!0),me.sys.autoFocus&&me.device.focus()},!1);var a,b;void 0!==document.hidden?(a="hidden",b="visibilitychange"):void 0!==document.mozHidden?(a="mozHidden",b="mozvisibilitychange"):void 0!==document.msHidden?(a="msHidden",b="msvisibilitychange"):void 0!==document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange"),"string"==typeof b&&document.addEventListener(b,function(){document[a]?(me.sys.stopOnBlur&&me.state.stop(!0),me.sys.pauseOnBlur&&me.state.pause(!0)):(me.sys.stopOnBlur&&me.state.restart(!0),me.sys.resumeOnFocus&&me.state.resume(!0))},!1)},c._detectDevice=function(){me.device.iOS=/iPhone|iPad|iPod/i.test(me.device.ua),me.device.android=/Android/i.test(me.device.ua),me.device.android2=/Android 2/i.test(me.device.ua),me.device.linux=/Linux/i.test(me.device.ua),me.device.chromeOS=/CrOS/.test(me.device.ua),me.device.wp=/Windows Phone/i.test(me.device.ua),me.device.BlackBerry=/BlackBerry/i.test(me.device.ua),me.device.Kindle=/Kindle|Silk.*Mobile Safari/i.test(me.device.ua),me.device.isMobile=/Mobi/i.test(me.device.ua)||me.device.iOS||me.device.android||me.device.wp||me.device.BlackBerry||me.device.Kindle||!1,me.device.ejecta=void 0!==window.ejecta,me.device.isWeixin=/MicroMessenger/i.test(me.device.ua)},c.ua=navigator.userAgent,c.localStorage=!1,c.hasAccelerometer=!1,c.hasDeviceOrientation=!1,c.hasFullscreenSupport=!1,c.hasPointerLockSupport=!1,c.hasWebAudio=!1,c.nativeBase64="function"==typeof window.atob,c.maxTouchPoints=1,c.touch=!1,c.wheel=!1,c.isMobile=!1,c.iOS=!1,c.android=!1,c.android2=!1,c.linux=!1,c.ejecta=!1,c.isWeixin=!1,c.chromeOS=!1,c.wp=!1,c.BlackBerry=!1,c.Kindle=!1,c.accelerationX=0,c.accelerationY=0,c.accelerationZ=0,c.gamma=0,c.beta=0,c.alpha=0,c.language=navigator.language||navigator.browserLanguage||navigator.userLanguage||"en",c.onReady=function(a){i?a.call(window,[]):(j.push(a),h||("complete"===document.readyState?window.setTimeout(me.device._domReady,0):(document.addEventListener&&document.addEventListener("DOMContentLoaded",me.device._domReady,!1),window.addEventListener("load",me.device._domReady,!1)),h=!0))},c.enableSwipe=function(a){!1!==a?!1===f&&(window.document.removeEventListener("touchmove",g,!1),f=!0):!0===f&&(window.document.addEventListener("touchmove",g,!1),f=!1)},c.requestFullscreen=function(a){this.hasFullscreenSupport&&(a=a||me.video.getWrapper(),a.requestFullscreen=me.agent.prefixed("requestFullscreen",a)||a.mozRequestFullScreen,a.requestFullscreen())},c.exitFullscreen=function(){this.hasFullscreenSupport&&document.exitFullscreen()},c.getScreenOrientation=function(){var a=window.screen;if(void 0!==a){var b=me.agent.prefixed("orientation",a);if(void 0!==b&&_typeof("string"===b.type))return b.type;if("string"==typeof b)return b}return"number"==typeof window.orientation?90===Math.abs(window.orientation)?"landscape":"portrait":window.outerWidth>window.outerHeight?"landscape":"portrait"},c.lockOrientation=function(a){var b=window.screen;if(void 0!==b){var c=me.agent.prefixed("lockOrientation",b);if(void 0!==c)return c(a)}return!1},c.unlockOrientation=function(a){var b=window.screen;if(void 0!==b){var c=me.agent.prefixed("unlockOrientation",b);if(void 0!==c)return c(a)}return!1},c.isPortrait=function(){return me.device.getScreenOrientation().includes("portrait")},c.isLandscape=function(){return me.device.getScreenOrientation().includes("landscape")},c.getStorage=function(a){switch(a=a||"local"){case"local":return me.save;default:throw new Error("storage type "+a+" not supported")}},c.getMaxShaderPrecision=function(a){return a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision>0?"highp":a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision>0?"mediump":"lowp"},c.focus=function(){"function"==typeof window.focus&&window.focus()},c.turnOnPointerLock=function(){if(this.hasPointerLockSupport){var a=me.video.getWrapper();if(me.device.ua.match(/Firefox/i)){var b=function b(){(me.agent.prefixed("fullscreenElement",document)||document.mozFullScreenElement)===a&&(document.removeEventListener("fullscreenchange",b),document.removeEventListener("mozfullscreenchange",b),a.requestPointerLock=me.agent.prefixed("requestPointerLock",a),a.requestPointerLock())};document.addEventListener("fullscreenchange",b,!1),document.addEventListener("mozfullscreenchange",b,!1),me.device.requestFullscreen()}else a.requestPointerLock()}},c.turnOffPointerLock=function(){this.hasPointerLockSupport&&document.exitPointerLock()},c.watchAccelerometer=function(){return!!me.device.hasAccelerometer&&(d||(window.addEventListener("devicemotion",a,!1),d=!0),!0)},c.unwatchAccelerometer=function(){d&&(window.removeEventListener("devicemotion",a,!1),d=!1)},c.watchDeviceOrientation=function(){return me.device.hasDeviceOrientation&&!e&&(window.addEventListener("deviceorientation",b,!1),e=!0),!1},c.unwatchDeviceOrientation=function(){e&&(window.removeEventListener("deviceorientation",b,!1),e=!1)},c.vibrate=function(a){navigator.vibrate&&navigator.vibrate(a)},c}(),Object.defineProperty(me.device,"devicePixelRatio",{get:function(){return window.devicePixelRatio||1}}),Object.defineProperty(me.device,"isFullscreen",{get:function(){return!!me.device.hasFullscreenSupport&&!(!me.agent.prefixed("fullscreenElement",document)&&!document.mozFullScreenElement)}}),Object.defineProperty(me.device,"sound",{get:function(){return me.audio.hasAudio()}})}();var minpubsub_src=createCommonjsModule(function(a,b){!function(c){var d={},e=c.c_||{};d.publish=function(a,b){for(var d=e[a],f=d?d.length:0;f--;)d[f].apply(c,b||[])},d.subscribe=function(a,b){return e[a]||(e[a]=[]),e[a].push(b),[a,b]},d.unsubscribe=function(a,b){for(var c=e[b?a:a[0]],b=b||a[1],d=c?c.length:0;d--;)c[d]===b&&c.splice(d,1)},a.exports?a.exports=b=d:"object"==typeof c&&(c.publish=d.publish,c.subscribe=d.subscribe,c.unsubscribe=d.unsubscribe)}(commonjsGlobal.window)});!function(){me.event=function(){var a={};return a.STATE_PAUSE="me.state.onPause",a.STATE_RESUME="me.state.onResume",a.STATE_STOP="me.state.onStop",a.STATE_RESTART="me.state.onRestart",a.GAME_INIT="me.game.onInit",a.GAME_RESET="me.game.onReset",a.GAME_UPDATE="me.game.onUpdate",a.LEVEL_LOADED="me.game.onLevelLoaded",a.LOADER_COMPLETE="me.loader.onload",a.LOADER_PROGRESS="me.loader.onProgress",a.KEYDOWN="me.input.keydown",a.KEYUP="me.input.keyup",a.GAMEPAD_CONNECTED="gamepad.connected",a.GAMEPAD_DISCONNECTED="gamepad.disconnected",a.GAMEPAD_UPDATE="gamepad.update",a.POINTERMOVE="me.event.pointermove",a.DRAGSTART="me.game.dragstart",a.DRAGEND="me.game.dragend",a.WINDOW_ONRESIZE="window.onresize",a.CANVAS_ONRESIZE="canvas.onresize",a.VIEWPORT_ONRESIZE="viewport.onresize",a.WINDOW_ONORIENTATION_CHANGE="window.orientationchange",a.WINDOW_ONSCROLL="window.onscroll",a.VIEWPORT_ONCHANGE="viewport.onchange",a.WEBGL_ONCONTEXT_LOST="renderer.webglcontextlost",a.WEBGL_ONCONTEXT_RESTORED="renderer.webglcontextrestored",a.publish=minpubsub_src.publish,a.subscribe=minpubsub_src.subscribe,a.unsubscribe=minpubsub_src.unsubscribe,a}()}(),function(){me.game=function(){var a={},b=!0,c=!1,d=0,e=1,f=0,g=0,h=0,i=1e3/60,j=0,k=null,l=0,m=null;return a.viewport=void 0,a.world=null,a.mergeGroup=!0,a.sortOn="z",a.onLevelLoaded=function(){},a.init=function(c,d){c=c||me.video.renderer.getWidth(),d=d||me.video.renderer.getHeight(),a.world=new me.Container(0,0,c,d,!0),a.world.name="rootContainer",a.world.anchorPoint.set(0,0),me.collision.init(),m=me.video.renderer,me.event.publish(me.event.GAME_INIT),b=!0},a.reset=function(){me.collision.quadTree.clear(),a.world.reset(),a.world.anchorPoint.set(0,0),a.viewport=me.state.current().cameras.get("default"),me.event.publish(me.event.GAME_RESET),a.updateFrameRate()},a.updateFrameRate=function(){d=0,e=~~(.5+60/me.sys.fps),i=1e3/me.sys.updatesPerSecond,f=0,g=10*i,c=me.sys.fps>me.sys.updatesPerSecond},a.getParentContainer=function(a){return a.ancestor},a.repaint=function(){b=!0},a.update=function(c,m){if(++d%e==0)for(d=0,me.event.publish(me.event.GAME_UPDATE,[c]),f+=me.timer.getDelta(),f=Math.min(f,g),j=me.sys.interpolation?me.timer.getDelta():i,h=me.sys.interpolation?j:Math.max(j,l);f>=h||me.sys.interpolation;)if(k=window.performance.now(),me.collision.quadTree.clear(),me.collision.quadTree.insertContainer(a.world),b=a.world.update(j)||b,m.cameras.forEach(function(a){a.update(j)&&(b=!0)}),me.timer.lastUpdate=window.performance.now(),l=me.timer.lastUpdate-k,f-=h,me.sys.interpolation){f=0;break}},a.draw=function(a){!0===m.isContextValid&&(b||c)&&(m.clear(),a.cameras.forEach(function(a){a.draw(m,me.game.world)}),b=!1,m.flush())},a}()}(),function(){me.version="7.1.0",me.sys={fps:60,updatesPerSecond:60,interpolation:!1,scale:null,gravity:void 0,stopOnAudioError:!0,pauseOnBlur:!0,resumeOnFocus:!0,autoFocus:!0,stopOnBlur:!1,preRender:!1},me.initialized=!1,me.skipAutoInit=!1,me.boot=function(){!0!==me.initialized&&(me.device._check(),me.pool.init(),me.save.init(),me.timer.init(),me.loader.setNocache(me.utils.getUriFragment().nocache||!1),me.state.init(),me.input.initKeyboardEvent(),me.levelDirector.init(),me.initialized=!0,!0===me.skipAutoInit&&me.device._domReady())},me.device.onReady(function(){!1===me.skipAutoInit&&me.boot()})}(),function(){me.timer=function(){var a={},b=0,c=0,d=0,e=0,f=0,g=Math.ceil(1e3/me.sys.fps),h=1e3/me.sys.fps*1.25,i=[],j=0,k=function(a){for(var b=0,c=i.length;b<c;b++)if(i[b].timerId===a){i.splice(b,1);break}},l=function(b){d=e,e=b,f=e-d,f<0&&(f=0),a.tick=f>h&&me.sys.interpolation?f/g:1;for(var c=0,j=i.length;c<j;c++){var k=i[c];k.pauseable&&me.state.isPaused()||(k.elapsed+=f),k.elapsed>=k.delay&&(k.fn.apply(null,k.args),!0===k.repeat?k.elapsed-=k.delay:me.timer.clearTimeout(k.timerId))}};return a.tick=1,a.fps=0,a.lastUpdate=window.performance.now(),a.init=function(){a.reset(),e=d=0,me.event.subscribe(me.event.GAME_UPDATE,l)},a.reset=function(){d=e=window.performance.now(),f=0,c=0,b=0},a.setTimeout=function(a,b,c){return i.push({fn:a,delay:b,elapsed:0,repeat:!1,timerId:++j,pauseable:!0===c||!0,args:arguments.length>3?Array.prototype.slice.call(arguments,3):void 0}),j},a.setInterval=function(a,b,c){return i.push({fn:a,delay:b,elapsed:0,repeat:!0,timerId:++j,pauseable:!0===c||!0,args:arguments.length>3?Array.prototype.slice.call(arguments,3):void 0}),j},a.clearTimeout=function(a){me.utils.function.defer(k,this,a)},a.clearInterval=function(a){me.utils.function.defer(k,this,a)},a.getTime=function(){return e},a.getDelta=function(){return f},a.countFPS=function(){b++,c+=f,b%10==0&&(this.fps=me.Math.clamp(Math.round(1e3*b/c),0,me.sys.fps),c=0,b=0)},a}()}(),function(){me.pool=function(){var a={},b={},c=0;return a.init=function(){a.register("me.Entity",me.Entity),a.register("me.CollectableEntity",me.CollectableEntity),a.register("me.LevelEntity",me.LevelEntity),a.register("me.Tween",me.Tween,!0),a.register("me.Color",me.Color,!0),a.register("me.Particle",me.Particle,!0),a.register("me.Sprite",me.Sprite),a.register("me.Text",me.Text,!0),a.register("me.BitmapText",me.BitmapText,!0),a.register("me.BitmapTextData",me.BitmapTextData,!0),a.register("me.ImageLayer",me.ImageLayer,!0),a.register("me.ColorLayer",me.ColorLayer,!0),a.register("me.Vector2d",me.Vector2d,!0),a.register("me.Vector3d",me.Vector3d,!0),a.register("me.ObservableVector2d",me.ObservableVector2d,!0),a.register("me.ObservableVector3d",me.ObservableVector3d,!0),a.register("me.Matrix2d",me.Matrix2d,!0),a.register("me.Rect",me.Rect,!0),a.register("me.Polygon",me.Polygon,!0),a.register("me.Line",me.Line,!0),a.register("me.Ellipse",me.Ellipse,!0)},a.register=function(a,c,d){if(void 0===c)throw new Error("Cannot register object '"+a+"', invalid class");b[a]={class:c,pool:d?[]:void 0}},a.pull=function(a){for(var d=new Array(arguments.length),e=0;e<arguments.length;e++)d[e]=arguments[e];var f=b[a];if(f){var g,h=f.class,i=f.pool;return i&&(g=i.pop())?(d.shift(),"function"==typeof g.onResetEvent?g.onResetEvent.apply(g,d):g.init.apply(g,d),c--):(d[0]=h,g=new(h.bind.apply(h,d)),i&&(g.className=a)),g}throw new Error("Cannot instantiate object of type '"+a+"'")},a.purge=function(){for(var a in b)b[a]&&(b[a].pool=[]);c=0},a.push=function(a){var d=a.className;void 0!==d&&b[d]&&(b[d].pool.push(a),c++)},a.exists=function(a){return a in b},a.getInstanceCount=function(a){return c},a}()}(),function(){me.Math=function(){var a={};return a.DEG_TO_RAD=Math.PI/180,a.RAD_TO_DEG=180/Math.PI,a.TAU=2*Math.PI,a.ETA=.5*Math.PI,a.isPowerOfTwo=function(a){return 0==(a&a-1)},a.nextPowerOfTwo=function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,++a},a.degToRad=function(b){return b*a.DEG_TO_RAD},a.radToDeg=function(b){return b*a.RAD_TO_DEG},a.clamp=function(a,b,c){return a<b?b:a>c?c:+a},a.random=function(a,b){return~~(Math.random()*(b-a))+a},a.randomFloat=function(a,b){return Math.random()*(b-a)+a},a.weightedRandom=function(a,b){return~~(Math.pow(Math.random(),2)*(b-a))+a},a.round=function(a,b){var c=Math.pow(10,b||0);return~~(.5+a*c)/c},a.toBeCloseTo=function(a,b,c){return"number"!=typeof c&&(c=2),Math.abs(a-b)<Math.pow(10,-c)/2},a}()}(),function(){me.Vector2d=me.Object.extend({init:function(a,b){return this.set(a||0,b||0)},_set:function(a,b){return this.x=a,this.y=b,this},set:function(a,b){if(a!==+a||b!==+b)throw new Error("invalid x,y parameters (not a number)");return this._set(a,b)},setZero:function(){return this.set(0,0)},setV:function(a){return this._set(a.x,a.y)},add:function(a){return this._set(this.x+a.x,this.y+a.y)},sub:function(a){return this._set(this.x-a.x,this.y-a.y)},scale:function(a,b){return this._set(this.x*a,this.y*(void 0!==b?b:a))},toIso:function(){return this._set(this.x-this.y,.5*(this.x+this.y))},to2d:function(){return this._set(this.y+this.x/2,this.y-this.x/2)},scaleV:function(a){return this._set(this.x*a.x,this.y*a.y)},div:function(a){return this._set(this.x/a,this.y/a)},abs:function(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)},clamp:function(a,b){return new me.Vector2d(me.Math.clamp(this.x,a,b),me.Math.clamp(this.y,a,b))},clampSelf:function(a,b){return this._set(me.Math.clamp(this.x,a,b),me.Math.clamp(this.y,a,b))},minV:function(a){return this._set(this.x<a.x?this.x:a.x,this.y<a.y?this.y:a.y)},maxV:function(a){return this._set(this.x>a.x?this.x:a.x,this.y>a.y?this.y:a.y)},floor:function(){return new me.Vector2d(Math.floor(this.x),Math.floor(this.y))},floorSelf:function(){return this._set(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return new me.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){return this._set(Math.ceil(this.x),Math.ceil(this.y))},negate:function(){return new me.Vector2d(-this.x,-this.y)},negateSelf:function(){return this._set(-this.x,-this.y)},copy:function(a){return this._set(a.x,a.y)},equals:function(a){return this.x===a.x&&this.y===a.y},normalize:function(){return this.div(this.length()||1)},perp:function(){return this._set(this.y,-this.x)},rotate:function(a){var b=this.x,c=this.y;return this._set(b*Math.cos(a)-c*Math.sin(a),b*Math.sin(a)+c*Math.cos(a))},dotProduct:function(a){return this.x*a.x+this.y*a.y},length2:function(){return this.dotProduct(this)},length:function(){return Math.sqrt(this.length2())},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},distance:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},angle:function(a){return Math.acos(me.Math.clamp(this.dotProduct(a)/(this.length()*a.length()),-1,1))},project:function(a){return this.scale(this.dotProduct(a)/a.length2())},projectN:function(a){return this.scale(this.dotProduct(a))},clone:function(){return me.pool.pull("me.Vector2d",this.x,this.y)},toString:function(){return"x:"+this.x+",y:"+this.y}})}(),function(){me.Vector3d=me.Object.extend({init:function(a,b,c){return this.set(a||0,b||0,c||0)},_set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},set:function(a,b,c){if(a!==+a||b!==+b||c!==+c)throw new Error("invalid x, y, z parameters (not a number)");return this._set(a,b,c)},setZero:function(){return this.set(0,0,0)},setV:function(a){return this._set(a.x,a.y,void 0!==a.z?a.z:this.z)},add:function(a){return this._set(this.x+a.x,this.y+a.y,this.z+(a.z||0))},sub:function(a){return this._set(this.x-a.x,this.y-a.y,this.z-(a.z||0))},scale:function(a,b,c){return b=void 0!==b?b:a,c=void 0!==c?c:a,this._set(this.x*a,this.y*b,this.z*c)},scaleV:function(a){return this._set(this.x*a.x,this.y*a.y,this.z*(a.z||1))},toIso:function(){return this._set(this.x-this.y,.5*(this.x+this.y),this.z)},to2d:function(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)},div:function(a){return this._set(this.x/a,this.y/a,this.z/a)},abs:function(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)},clamp:function(a,b){return new me.Vector3d(me.Math.clamp(this.x,a,b),me.Math.clamp(this.y,a,b),me.Math.clamp(this.z,a,b))},clampSelf:function(a,b){return this._set(me.Math.clamp(this.x,a,b),me.Math.clamp(this.y,a,b),me.Math.clamp(this.z,a,b))},minV:function(a){var b=a.z||0;return this._set(this.x<a.x?this.x:a.x,this.y<a.y?this.y:a.y,this.z<b?this.z:b)},maxV:function(a){var b=a.z||0;return this._set(this.x>a.x?this.x:a.x,this.y>a.y?this.y:a.y,this.z>b?this.z:b)},floor:function(){return new me.Vector3d(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},floorSelf:function(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},ceil:function(){return new me.Vector3d(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))},ceilSelf:function(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))},negate:function(){return new me.Vector3d(-this.x,-this.y,-this.z)},negateSelf:function(){return this._set(-this.x,-this.y,-this.z)},copy:function(a){return this._set(a.x,a.y,void 0!==a.z?a.z:this.z)},equals:function(a){return this.x===a.x&&this.y===a.y&&this.z===(a.z||this.z)},normalize:function(){return this.div(this.length()||1)},perp:function(){return this._set(this.y,-this.x,this.z)},rotate:function(a){var b=this.x,c=this.y;return this._set(b*Math.cos(a)-c*Math.sin(a),b*Math.sin(a)+c*Math.cos(a),this.z)},dotProduct:function(a){return this.x*a.x+this.y*a.y+this.z*(void 0!==a.z?a.z:this.z)},length2:function(){return this.dotProduct(this)},length:function(){return Math.sqrt(this.length2())},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},distance:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-(a.z||0);return Math.sqrt(b*b+c*c+d*d)},angle:function(a){return Math.acos(me.Math.clamp(this.dotProduct(a)/(this.length()*a.length()),-1,1))},project:function(a){return this.scale(this.dotProduct(a)/a.length2())},projectN:function(a){return this.scale(this.dotProduct(a))},clone:function(){return me.pool.pull("me.Vector3d",this.x,this.y,this.z)},toString:function(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}})}(),function(){me.ObservableVector2d=me.Vector2d.extend({init:function(a,b,c){if(Object.defineProperty(this,"x",{get:function(){return this._x},set:function(a){var b=this.onUpdate(a,this._y,this._x,this._y);this._x=b&&"x"in b?b.x:a},configurable:!0}),Object.defineProperty(this,"y",{get:function(){return this._y},set:function(a){var b=this.onUpdate(this._x,a,this._x,this._y);this._y=b&&"y"in b?b.y:a},configurable:!0}),void 0===c)throw new Error("undefined `onUpdate` callback");this.setCallback(c.onUpdate),this._x=a||0,this._y=b||0},_set:function(a,b){var c=this.onUpdate(a,b,this._x,this._y);return c&&"x"in c&&"y"in c?(this._x=c.x,this._y=c.y):(this._x=a,this._y=b),this},setMuted:function(a,b){return this._x=a,this._y=b,this},setCallback:function(a){if("function"!=typeof a)throw new Error("invalid `onUpdate` callback");return this.onUpdate=a,this},add:function(a){return this._set(this._x+a.x,this._y+a.y)},sub:function(a){return this._set(this._x-a.x,this._y-a.y)},scale:function(a,b){return this._set(this._x*a,this._y*(void 0!==b?b:a))},scaleV:function(a){return this._set(this._x*a.x,this._y*a.y)},div:function(a){return this._set(this._x/a,this._y/a)},abs:function(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)},clamp:function(a,b){return new me.ObservableVector2d(me.Math.clamp(this.x,a,b),me.Math.clamp(this.y,a,b),{onUpdate:this.onUpdate})},clampSelf:function(a,b){return this._set(me.Math.clamp(this._x,a,b),me.Math.clamp(this._y,a,b))},minV:function(a){return this._set(this._x<a.x?this._x:a.x,this._y<a.y?this._y:a.y)},maxV:function(a){return this._set(this._x>a.x?this._x:a.x,this._y>a.y?this._y:a.y)},floor:function(){
return new me.ObservableVector2d(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate})},floorSelf:function(){return this._set(Math.floor(this._x),Math.floor(this._y))},ceil:function(){return new me.ObservableVector2d(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate})},ceilSelf:function(){return this._set(Math.ceil(this._x),Math.ceil(this._y))},negate:function(){return new me.ObservableVector2d(-this._x,-this._y,{onUpdate:this.onUpdate})},negateSelf:function(){return this._set(-this._x,-this._y)},copy:function(a){return this._set(a.x,a.y)},equals:function(a){return this._x===a.x&&this._y===a.y},perp:function(){return this._set(this._y,-this._x)},rotate:function(a){var b=this._x,c=this._y;return this._set(b*Math.cos(a)-c*Math.sin(a),b*Math.sin(a)+c*Math.cos(a))},dotProduct:function(a){return this._x*a.x+this._y*a.y},lerp:function(a,b){return this._x+=(a.x-this._x)*b,this._y+=(a.y-this._y)*b,this},distance:function(a){return Math.sqrt((this._x-a.x)*(this._x-a.x)+(this._y-a.y)*(this._y-a.y))},clone:function(){return me.pool.pull("me.ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate})},toVector2d:function(){return me.pool.pull("me.Vector2d",this._x,this._y)},toString:function(){return"x:"+this._x+",y:"+this._y}})}(),function(){me.ObservableVector3d=me.Vector3d.extend({init:function(a,b,c,d){if(Object.defineProperty(this,"x",{get:function(){return this._x},set:function(a){var b=this.onUpdate(a,this._y,this._z,this._x,this._y,this._z);this._x=b&&"x"in b?b.x:a},configurable:!0}),Object.defineProperty(this,"y",{get:function(){return this._y},set:function(a){var b=this.onUpdate(this._x,a,this._z,this._x,this._y,this._z);this._y=b&&"y"in b?b.y:a},configurable:!0}),Object.defineProperty(this,"z",{get:function(){return this._z},set:function(a){var b=this.onUpdate(this._x,this._y,a,this._x,this._y,this._z);this._z=b&&"z"in b?b.z:a},configurable:!0}),void 0===d)throw new Error("undefined `onUpdate` callback");this.setCallback(d.onUpdate),this._x=a||0,this._y=b||0,this._z=c||0},_set:function(a,b,c){var d=this.onUpdate(a,b,c,this._x,this._y,this._z);return d&&"x"in d&&"y"in d&&"z"in d?(this._x=d.x,this._y=d.y,this._z=d.z):(this._x=a,this._y=b,this._z=c),this},setMuted:function(a,b,c){return this._x=a,this._y=b,this._z=c,this},setCallback:function(a){if("function"!=typeof a)throw new Error("invalid `onUpdate` callback");return this.onUpdate=a,this},add:function(a){return this._set(this._x+a.x,this._y+a.y,this._z+(a.z||0))},sub:function(a){return this._set(this._x-a.x,this._y-a.y,this._z-(a.z||0))},scale:function(a,b,c){return b=void 0!==b?b:a,c=void 0!==c?c:a,this._set(this._x*a,this._y*b,this._z*c)},scaleV:function(a){return this._set(this._x*a.x,this._y*a.y,this._z*(a.z||1))},div:function(a){return this._set(this._x/a,this._y/a,this._z/a)},abs:function(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)},clamp:function(a,b){return new me.ObservableVector3d(me.Math.clamp(this._x,a,b),me.Math.clamp(this._y,a,b),me.Math.clamp(this._z,a,b),{onUpdate:this.onUpdate})},clampSelf:function(a,b){return this._set(me.Math.clamp(this._x,a,b),me.Math.clamp(this._y,a,b),me.Math.clamp(this._z,a,b))},minV:function(a){var b=a.z||0;return this._set(this._x<a.x?this._x:a.x,this._y<a.y?this._y:a.y,this._z<b?this._z:b)},maxV:function(a){var b=a.z||0;return this._set(this._x>a.x?this._x:a.x,this._y>a.y?this._y:a.y,this._z>b?this._z:b)},floor:function(){return new me.ObservableVector3d(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate})},floorSelf:function(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},ceil:function(){return new me.ObservableVector3d(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate})},ceilSelf:function(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))},negate:function(){return new me.ObservableVector3d(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate})},negateSelf:function(){return this._set(-this._x,-this._y,-this._z)},copy:function(a){return this._set(a.x,a.y,void 0!==a.z?a.z:this._z)},equals:function(a){return this._x===a.x&&this._y===a.y&&this._z===(a.z||this._z)},perp:function(){return this._set(this._y,-this._x,this._z)},rotate:function(a){var b=this._x,c=this._y;return this._set(b*Math.cos(a)-c*Math.sin(a),b*Math.sin(a)+c*Math.cos(a),this._z)},dotProduct:function(a){return this._x*a.x+this._y*a.y+this._z*(a.z||1)},lerp:function(a,b){return this._x+=(a.x-this._x)*b,this._y+=(a.y-this._y)*b,this._z+=(a.z-this._z)*b,this},distance:function(a){var b=this._x-a.x,c=this._y-a.y,d=this._z-(a.z||0);return Math.sqrt(b*b+c*c+d*d)},clone:function(){return me.pool.pull("me.ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})},toVector3d:function(){return me.pool.pull("me.Vector3d",this._x,this._y,this._z)},toString:function(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}})}(),function(){me.Matrix2d=me.Object.extend({init:function(){void 0===this.val&&(this.val=new Float32Array(9)),arguments.length&&arguments[0]instanceof me.Matrix2d?this.copy(arguments[0]):arguments.length>=6?this.setTransform.apply(this,arguments):this.identity()},identity:function(){return this.setTransform(1,0,0,0,1,0,0,0,1),this},setTransform:function(){var a=this.val;return 9===arguments.length?(a[0]=arguments[0],a[1]=arguments[1],a[2]=arguments[2],a[3]=arguments[3],a[4]=arguments[4],a[5]=arguments[5],a[6]=arguments[6],a[7]=arguments[7],a[8]=arguments[8]):6===arguments.length&&(a[0]=arguments[0],a[1]=arguments[2],a[2]=arguments[4],a[3]=arguments[1],a[4]=arguments[3],a[5]=arguments[5],a[6]=0,a[7]=0,a[8]=1),this},copy:function(a){return this.val.set(a.val),this},multiply:function(a){a=a.val;var b=this.val,c=b[0],d=b[1],e=b[3],f=b[4],g=a[0],h=a[1],i=a[3],j=a[4],k=a[6],l=a[7];return b[0]=c*g+e*h,b[1]=d*g+f*h,b[3]=c*i+e*j,b[4]=d*i+f*j,b[6]+=c*k+e*l,b[7]+=d*k+f*l,this},transpose:function(){var a=this.val,b=a[1],c=a[2],d=a[5];return a[1]=a[3],a[2]=a[6],a[3]=b,a[5]=a[7],a[6]=c,a[7]=d,this},invert:function(){var a=this.val,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=g*h-j*e,m=i*e-f*h,n=b*k+c*l+d*m;return a[0]=k/n,a[1]=(d*i-j*c)/n,a[2]=(g*c-d*f)/n,a[3]=l/n,a[4]=(j*b-d*h)/n,a[5]=(d*e-g*b)/n,a[6]=m/n,a[7]=(c*h-i*b)/n,a[8]=(f*b-c*e)/n,this},ortho:function(a,b,c,d,e,f){var g=this.val;return g[0]=2/(b-a),g[1]=0,g[2]=0,g[3]=0,g[4]=2/(d-c),g[5]=0,g[6]=-1,g[7]=1,g[8]=-2/(f-e),this},multiplyVector:function(a){var b=this.val,c=a.x,d=a.y;return a.x=c*b[0]+d*b[3]+b[6],a.y=c*b[1]+d*b[4]+b[7],a},multiplyVectorInverse:function(a){var b=this.val,c=a.x,d=a.y,e=1/(b[0]*b[4]+b[3]*-b[1]);return a.x=b[4]*e*c+-b[3]*e*d+(b[7]*b[3]-b[6]*b[4])*e,a.y=b[0]*e*d+-b[1]*e*c+(-b[7]*b[0]+b[6]*b[1])*e,a},scale:function(a,b){var c=this.val,d=a,e=void 0===b?d:b;return c[0]*=d,c[1]*=d,c[3]*=e,c[4]*=e,this},scaleV:function(a){return this.scale(a.x,a.y)},scaleX:function(a){return this.scale(a,1)},scaleY:function(a){return this.scale(1,a)},rotate:function(a){if(0!==a){var b=this.val,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=Math.sin(a),j=Math.cos(a);b[0]=j*c+i*f,b[1]=j*d+i*g,b[2]=j*e+i*h,b[3]=j*f-i*c,b[4]=j*g-i*d,b[5]=j*h-i*e}return this},translate:function(a,b){var c=this.val;return c[6]+=c[0]*a+c[3]*b,c[7]+=c[1]*a+c[4]*b,this},translateV:function(a){return this.translate(a.x,a.y)},isIdentity:function(){var a=this.val;return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&1===a[4]&&0===a[5]&&0===a[6]&&0===a[7]&&1===a[8]},clone:function(){return me.pool.pull("me.Matrix2d",this)},toArray:function(){return this.val},toString:function(){var a=this.val;return"me.Matrix2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"}}),Object.defineProperty(me.Matrix2d.prototype,"tx",{get:function(){return this.val[6]},configurable:!0}),Object.defineProperty(me.Matrix2d.prototype,"ty",{get:function(){return this.val[7]},configurable:!0})}(),function(){me.Ellipse=me.Object.extend({init:function(a,b,c,d){this.pos=new me.Vector2d,this._bounds=void 0,this.radius=NaN,this.radiusV=new me.Vector2d,this.radiusSq=new me.Vector2d,this.ratio=new me.Vector2d,this.shapeType="Ellipse",this.setShape(a,b,c,d)},onResetEvent:function(a,b,c,d){this.setShape(a,b,c,d)},setShape:function(a,b,c,d){var e=c/2,f=d/2;this.pos.set(a,b),this.radius=Math.max(e,f),this.ratio.set(e/this.radius,f/this.radius),this.radiusV.set(this.radius,this.radius).scaleV(this.ratio);var g=this.radius*this.radius;return this.radiusSq.set(g,g).scaleV(this.ratio),this.updateBounds(),this},rotate:function(){return this},scale:function(a,b){return b=void 0!==b?b:a,this.setShape(this.pos.x,this.pos.y,2*this.radiusV.x*a,2*this.radiusV.y*b)},scaleV:function(a){return this.scale(a.x,a.y)},transform:function(){return this},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this._bounds.translate(a,b),this},translateV:function(a){return this.pos.add(a),this._bounds.translateV(a),this},containsPointV:function(a){return this.containsPoint(a.x,a.y)},containsPoint:function(a,b){return a-=this.pos.x,b-=this.pos.y,a*a/this.radiusSq.x+b*b/this.radiusSq.y<=1},getBounds:function(){return this._bounds},updateBounds:function(){var a=this.radiusV.x,b=this.radiusV.y,c=this.pos.x-a,d=this.pos.y-b,e=2*a,f=2*b;return this._bounds?this._bounds.setShape(c,d,e,f):this._bounds=new me.Rect(c,d,e,f),this._bounds},clone:function(){return new me.Ellipse(this.pos.x,this.pos.y,2*this.radiusV.x,2*this.radiusV.y)}})}();var earcut_1=earcut,default_1=earcut;earcut.deviation=function(a,b,c,d){var e=b&&b.length,f=e?b[0]*c:a.length,g=Math.abs(signedArea(a,0,f,c));if(e)for(var h=0,i=b.length;h<i;h++){var j=b[h]*c,k=h<i-1?b[h+1]*c:a.length;g-=Math.abs(signedArea(a,j,k,c))}var l=0;for(h=0;h<d.length;h+=3){var m=d[h]*c,n=d[h+1]*c,o=d[h+2]*c;l+=Math.abs((a[m]-a[o])*(a[n+1]-a[m+1])-(a[m]-a[n])*(a[o+1]-a[m+1]))}return 0===g&&0===l?0:Math.abs((l-g)/g)},earcut.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var g=0;g<b;g++)c.vertices.push(a[e][f][g]);e>0&&(d+=a[e-1].length,c.holes.push(d))}return c},earcut_1.default=default_1,function(){me.Polygon=me.Object.extend({init:function(a,b,c){this.pos=new me.Vector2d,this._bounds=void 0,this.points=null,this.edges=[],this.indices=[],this.normals=[],this.shapeType="Polygon",this.setShape(a,b,c)},onResetEvent:function(a,b,c){this.setShape(a,b,c)},setShape:function(a,b,c){if(this.pos.set(a,b),!Array.isArray(c))return this;if(c[0]instanceof me.Vector2d)this.points=c;else{var d=this.points=[];c.forEach(function(a){d.push(new me.Vector2d(a.x,a.y))})}return this.recalc(),this.updateBounds(),this},transform:function(a){for(var b=this.points,c=b.length,d=0;d<c;d++)a.multiplyVector(b[d]);return this.recalc(),this.updateBounds(),this},toIso:function(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)},to2d:function(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)},rotate:function(a){if(0!==a){for(var b=this.points,c=b.length,d=0;d<c;d++)b[d].rotate(a);this.recalc(),this.updateBounds()}return this},scale:function(a,b){b=void 0!==b?b:a;for(var c=this.points,d=c.length,e=0;e<d;e++)c[e].scale(a,b);return this.recalc(),this.updateBounds(),this},scaleV:function(a){return this.scale(a.x,a.y)},recalc:function(){var a,b=this.edges,c=this.normals,d=this.indices,e=this.points,f=e.length;if(f<3)throw new Error("Requires at least 3 points");for(a=0;a<f;a++)void 0===b[a]&&(b[a]=new me.Vector2d),b[a].copy(e[(a+1)%f]).sub(e[a]),void 0===c[a]&&(c[a]=new me.Vector2d),c[a].copy(b[a]).perp().normalize();return b.length=f,c.length=f,d.length=0,this},getIndices:function(a,b){if(0===this.indices.length){for(var c=this.points,d=[],e=0;e<c.length;e++)d.push(c[e].x),d.push(c[e].y);this.indices=earcut_1(d)}return this.indices},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this._bounds.translate(a,b),this},translateV:function(a){return this.pos.add(a),this._bounds.translateV(a),this},containsPointV:function(a){return this.containsPoint(a.x,a.y)},containsPoint:function(a,b){for(var c=!1,d=this.pos.x,e=this.pos.y,f=this.points,g=f.length,h=0,i=g-1;h<g;i=h++){var j=f[h].y+e,k=f[h].x+d,l=f[i].y+e,m=f[i].x+d;j>b!=l>b&&a<(m-k)*(b-j)/(l-j)+k&&(c=!c)}return c},getBounds:function(){return this._bounds},updateBounds:function(){return this._bounds||(this._bounds=new me.Rect(0,0,0,0)),this._bounds.setPoints(this.points),this._bounds.translateV(this.pos),this._bounds},clone:function(){var a=[];return this.points.forEach(function(b){a.push(b.clone())}),new me.Polygon(this.pos.x,this.pos.y,a)}})}(),function(){me.Rect=me.Polygon.extend({init:function(a,b,c,d){me.Polygon.prototype.init.apply(this,[a,b,[new me.Vector2d(0,0),new me.Vector2d(c,0),new me.Vector2d(c,d),new me.Vector2d(0,d)]]),this.shapeType="Rectangle"},onResetEvent:function(a,b,c,d){this.setShape(a,b,c,d)},setShape:function(a,b,c,d){var e=c;return 4===arguments.length&&(e=this.points,e[0].set(0,0),e[1].set(c,0),e[2].set(c,d),e[3].set(0,d)),me.Polygon.prototype.setShape.apply(this,[a,b,e]),this._width=this.points[2].x,this._height=this.points[2].y,this},resize:function(a,b){return this.width=a,this.height=b,this},getBounds:function(){return this},setPoints:function(a){var b=1/0,c=1/0,d=-1/0,e=-1/0;return a.forEach(function(a){b=Math.min(b,a.x),c=Math.min(c,a.y),d=Math.max(d,a.x),e=Math.max(e,a.y)}),this.setShape(b,c,d-b,e-c),this},recalc:function(){return me.Polygon.prototype.recalc.apply(this),this._width=this.points[2].x,this._height=this.points[2].y,this},updateBounds:function(){return this},clone:function(){return new me.Rect(this.pos.x,this.pos.y,this._width,this._height)},copy:function(a){return this.setShape(a.pos.x,a.pos.y,a._width,a._height)},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this},translateV:function(a){return this.translate(a.x,a.y)},union:function(a){var b=Math.min(this.left,a.left),c=Math.min(this.top,a.top);return this.resize(Math.max(this.right,a.right)-b,Math.max(this.bottom,a.bottom)-c),this.pos.set(b,c),this},overlaps:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},contains:function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPoint:function(a,b){return a>=this.left&&a<=this.right&&b>=this.top&&b<=this.bottom},equals:function(a){return a.left===this.left&&a.right===this.right&&a.top===this.top&&a.bottom===this.bottom},isFinite:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(){return isFinite(this.pos.x)&&isFinite(this.pos.y)&&isFinite(this._width)&&isFinite(this._height)}),toPolygon:function(){return new me.Polygon(this.pos.x,this.pos.y,this.points)}}),Object.defineProperty(me.Rect.prototype,"left",{get:function(){return this.pos.x},configurable:!0}),Object.defineProperty(me.Rect.prototype,"right",{get:function(){var a=this._width;return this.pos.x+a||a},configurable:!0}),Object.defineProperty(me.Rect.prototype,"top",{get:function(){return this.pos.y},configurable:!0}),Object.defineProperty(me.Rect.prototype,"bottom",{get:function(){var a=this._height;return this.pos.y+a||a},configurable:!0}),Object.defineProperty(me.Rect.prototype,"width",{get:function(){return this._width},set:function(a){this._width!==a&&(this.points[1].x=this.points[2].x=a,this.recalc())},configurable:!0}),Object.defineProperty(me.Rect.prototype,"height",{get:function(){return this._height},set:function(a){this._height!==a&&(this.points[2].y=this.points[3].y=a,this.recalc())},configurable:!0}),Object.defineProperty(me.Rect.prototype,"centerX",{get:function(){return this.pos.x+this._width/2},set:function(a){this.pos.x=a-this._width/2},configurable:!0}),Object.defineProperty(me.Rect.prototype,"centerY",{get:function(){return this.pos.y+this._height/2},set:function(a){this.pos.y=a-this._height/2},configurable:!0})}(),function(){me.Line=me.Polygon.extend({containsPointV:function(a){return this.containsPoint(a.x,a.y)},containsPoint:function(a,b){a-=this.pos.x,b-=this.pos.y;var c=this.points[0],d=this.points[1];return(b-c.y)*(d.x-c.x)==(d.y-c.y)*(a-c.x)},recalc:function(){var a=this.edges,b=this.normals,c=this.points;if(2!==c.length)throw new Error("Requires exactly 2 points");return void 0===a[0]&&(a[0]=new me.Vector2d),a[0].copy(c[1]).sub(c[0]),void 0===b[0]&&(b[0]=new me.Vector2d),b[0].copy(a[0]).perp().normalize(),this},clone:function(){var a=[];return this.points.forEach(function(b){a.push(b.clone())}),new me.Line(this.pos.x,this.pos.y,a)}})}(),function(){me.Body=me.Rect.extend({init:function(a,b,c){if(this.ancestor=a,void 0===this.shapes&&(this.shapes=[]),this.collisionMask=me.collision.types.ALL_OBJECT,this.collisionType=me.collision.types.ENEMY_OBJECT,void 0===this.vel&&(this.vel=new me.Vector2d),this.vel.set(0,0),void 0===this.accel&&(this.accel=new me.Vector2d),this.accel.set(0,0),void 0===this.force&&(this.force=new me.Vector2d),this.force.set(0,0),void 0===this.friction&&(this.friction=new me.Vector2d),this.friction.set(0,0),this.bounce=0,this.mass=1,void 0===this.maxVel&&(this.maxVel=new me.Vector2d),this.maxVel.set(490,490),void 0===this.gravity&&(this.gravity=new me.Vector2d),this.gravity.set(0,"number"==typeof me.sys.gravity?me.sys.gravity:.98),this.falling=!1,this.jumping=!1,me.Rect.prototype.init.apply(this,[0,0,this.ancestor.width,this.ancestor.height]),"function"==typeof c&&(this.onBodyUpdate=c),Array.isArray(b)){for(var d=0;d<b.length;d++)this.addShape(b[d],!0);this.updateBounds()}},addShape:function(a,b){return a instanceof me.Rect?this.shapes.push(a.toPolygon()):this.shapes.push(a),!0!==b&&this.updateBounds(),this.shapes.length},addShapesFromJSON:function(a,b,c){var d;if(c=c||1,void 0===a.rigidBodies){if(void 0===(d=a[b]))throw new Error("Identifier ("+b+") undefined for the given PhysicsEditor JSON object)");if(d.length){for(var e=0;e<d.length;e++){for(var f=[],g=0;g<d[e].shape.length;g+=2)f.push(new me.Vector2d(d[e].shape[g],d[e].shape[g+1]));this.addShape(new me.Polygon(0,0,f),!0)}this.mass=d[0].density||0,this.friction.set(d[0].friction||0,d[0].friction||0),this.bounce=d[0].bounce||0}}else{if(a.rigidBodies.forEach(function(a){a.name===b&&(d=a)}),void 0===d)throw new Error("Identifier ("+b+") undefined for the given PhysicsEditor JSON object)");this.pos.set(d.origin.x,1-d.origin.y).scale(c);var h=this;d.polygons.forEach(function(a){var b=[];a.forEach(function(a){b.push(new me.Vector2d(a.x,1-a.y).scale(c))}),h.addShape(new me.Polygon(0,0,b),!0)}),d.circles.forEach(function(a){h.addShape(new me.Ellipse(a.cx*c,(1-a.cy)*c,2*a.r*c,2*a.r*c),!0)})}return this.updateBounds(),this.shapes.length},getShape:function(a){return this.shapes[a||0]},removeShape:function(a){return me.utils.array.remove(this.shapes,a),this.updateBounds(),this.shapes.length},removeShapeAt:function(a){return this.removeShape(this.getShape(a))},setCollisionMask:function(a){this.collisionMask=a},respondToCollision:function(a){var b=a.overlapV;if(this.ancestor.pos.sub(b),0!==b.x&&(this.vel.x=~~(.5+this.vel.x-b.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),0!==b.y){this.vel.y=~~(.5+this.vel.y-b.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce);var c=Math.sign(this.gravity.y)||1;this.falling=b.y>=c,this.jumping=b.y<=-c}},updateBounds:function(){if(this.shapes.length>0){var a=this.shapes[0].getBounds();this.pos.setV(a.pos),this.resize(a.width,a.height);for(var b=1;b<this.shapes.length;b++)this.union(this.shapes[b].getBounds())}return"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this),this},setVelocity:function(a,b){this.accel.x=0!==a?a:this.accel.x,this.accel.y=0!==b?b:this.accel.y,this.setMaxVelocity(a,b)},setMaxVelocity:function(a,b){this.maxVel.x=a,this.maxVel.y=b},setFriction:function(a,b){this.friction.x=a||0,this.friction.y=b||0},applyFriction:function(a){var b=this.friction.x*me.timer.tick,c=a.x+b,d=a.x-b,e=this.friction.y*me.timer.tick,f=a.y+e,g=a.y-e;a.x=c<0?c:d>0?d:0,a.y=f<0?f:g>0?g:0},computeVelocity:function(a){this.force.x&&(a.x+=this.force.x*me.timer.tick),this.force.y&&(a.y+=this.force.y*me.timer.tick),(this.friction.x||this.friction.y)&&this.applyFriction(a),this.gravity.x&&(a.x+=this.gravity.x*this.mass*me.timer.tick),this.gravity.y&&(a.y+=this.gravity.y*this.mass*me.timer.tick,this.falling=a.y*Math.sign(this.gravity.y)>0,this.jumping=!this.falling&&this.jumping),0!==a.y&&(a.y=me.Math.clamp(a.y,-this.maxVel.y,this.maxVel.y)),0!==a.x&&(a.x=me.Math.clamp(a.x,-this.maxVel.x,this.maxVel.x))},update:function(){return this.computeVelocity(this.vel),this.ancestor.pos.add(this.vel),0!==this.vel.x||0!==this.vel.y},destroy:function(){this.onBodyUpdate=void 0,this.ancestor=void 0,this.shapes.length=0}})}(),function(){function a(a,b,c,d){this.max_objects=b||4,this.max_levels=c||4,this.level=d||0,this.bounds=a,this.objects=[],this.nodes=[]}var b=[],c=function(a,c,d,e){if(b.length>0){var f=b.pop();return f.bounds=a,f.max_objects=c||4,f.max_levels=d||4,f.level=e||0,f}return new me.QuadTree(a,c,d,e)},d=function(a){b.push(a)},e=new me.Vector2d;a.prototype.split=function(){var a=this.level+1,b=~~(.5+this.bounds.width/2),d=~~(.5+this.bounds.height/2),e=~~(.5+this.bounds.pos.x),f=~~(.5+this.bounds.pos.y);this.nodes[0]=c({pos:{x:e+b,y:f},width:b,height:d},this.max_objects,this.max_levels,a),this.nodes[1]=c({pos:{x:e,y:f},width:b,height:d},this.max_objects,this.max_levels,a),this.nodes[2]=c({pos:{x:e,y:f+d},width:b,height:d},this.max_objects,this.max_levels,a),this.nodes[3]=c({pos:{x:e+b,y:f+d},width:b,height:d},this.max_objects,this.max_levels,a)},a.prototype.getIndex=function(a){var b=a.getBounds(),c=b.pos;(a.floating||a.ancestor&&a.ancestor.floating)&&(c=me.game.viewport.localToWorld(c.x,c.y,e));var d=-1,f=c.x,g=c.y,h=b.width,i=b.height,j=this.bounds.pos.x+this.bounds.width/2,k=this.bounds.pos.y+this.bounds.height/2,l=g<k&&g+i<k,m=g>k;return f<j&&f+h<j?l?d=1:m&&(d=2):f>j&&(l?d=0:m&&(d=3)),d},a.prototype.insertContainer=function(a){for(var b,c=a.children.length;c--,b=a.children[c];)!0!==b.isKinematic&&(b instanceof me.Container?("rootContainer"!==b.name&&this.insert(b),this.insertContainer(b)):"function"==typeof b.getBounds&&this.insert(b))},a.prototype.insert=function(a){var b=-1;if(this.nodes.length>0&&-1!==(b=this.getIndex(a)))return void this.nodes[b].insert(a);if(this.objects.push(a),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();for(var c=0;c<this.objects.length;)b=this.getIndex(this.objects[c]),-1!==b?this.nodes[b].insert(this.objects.splice(c,1)[0]):c+=1}},a.prototype.retrieve=function(a,b){var c=this.objects;if(this.nodes.length>0){var d=this.getIndex(a);if(-1!==d)c=c.concat(this.nodes[d].retrieve(a));else for(var e=0;e<this.nodes.length;e+=1)c=c.concat(this.nodes[e].retrieve(a))}return"function"==typeof b&&c.sort(b),c},a.prototype.remove=function(a){var b=!1;if(void 0===a.getBounds)return!1;if(this.nodes.length>0){var c=this.getIndex(a);-1!==c&&(b=me.utils.array.remove(this.nodes[c],a))&&this.nodes[c].isPrunable()&&this.nodes.splice(c,1)}return!1===b&&-1!==this.objects.indexOf(a)&&(me.utils.array.remove(this.objects,a),b=!0),b},a.prototype.isPrunable=function(){return!(this.hasChildren()||this.objects.length>0)},a.prototype.hasChildren=function(){for(var a=0;a<this.nodes.length;a+=1){var b=this.nodes[a];if(b.length>0||b.objects.length>0)return!0}return!1},a.prototype.clear=function(a){this.objects.length=0;for(var b=0;b<this.nodes.length;b+=1)this.nodes[b].clear(),d(this.nodes[b]);this.nodes.length=0,void 0!==a&&this.bounds.setShape(a.pos.x,a.pos.y,a.width,a.height)},me.QuadTree=a}(),function(){function a(a,b,c){for(var d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=a.length,g=0;g<f;g++){var h=a[g].dotProduct(b);h<d&&(d=h),h>e&&(e=h)}c[0]=d,c[1]=e}function b(b,c,d,e,f,h){var j=i.pop(),k=i.pop(),l=g.pop().copy(c).sub(b),m=l.dotProduct(f);if(a(d,f,j),a(e,f,k),k[0]+=m,k[1]+=m,j[0]>k[1]||k[0]>j[1])return g.push(l),i.push(j),i.push(k),!0;if(h){var n=0;if(j[0]<k[0])if(h.aInB=!1,j[1]<k[1])n=j[1]-k[0],h.bInA=!1;else{var o=j[1]-k[0],p=k[1]-j[0];n=o<p?o:-p}else if(h.bInA=!1,j[1]>k[1])n=j[0]-k[1],h.aInB=!1;else{var q=j[1]-k[0],r=k[1]-j[0];n=q<r?q:-r}var s=Math.abs(n);s<h.overlap&&(h.overlap=s,h.overlapN.copy(f),n<0&&h.overlapN.negateSelf())}return g.push(l),i.push(j),i.push(k),!1}function c(a,b){var c=a.length2(),g=b.dotProduct(a);return g<0?d:g>c?f:e}for(var d=-1,e=0,f=1,g=[],h=0;h<10;h++)g.push(new me.Vector2d);for(var i=[],j=0;j<5;j++)i.push([]);var k={pos:new me.Vector2d(0,0),ancestor:{_absPos:new me.Vector2d(0,0)}};me.collision=function(){var a={};return a.quadTree=null,a.maxDepth=4,a.maxChildren=8,a.bounds=null,a.types={NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},a.init=function(){a.bounds=me.game.world.getBounds().clone(),a.quadTree=new me.QuadTree(a.bounds,a.maxChildren,a.maxDepth),me.event.subscribe(me.event.LEVEL_LOADED,function(){a.bounds.copy(me.game.world.getBounds()),a.quadTree.clear(a.bounds)})},a.ResponseObject=function(){this.a=null,this.b=null,this.overlapN=new me.Vector2d,this.overlapV=new me.Vector2d,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE},a.ResponseObject.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this},a.response=new a.ResponseObject,a.shouldCollide=function(a,b){return!0!==a.isKinematic&&!0!==b.isKinematic&&a.body&&b.body&&0!=(a.body.collisionMask&b.body.collisionType)&&0!=(a.body.collisionType&b.body.collisionMask)},a.check=function(b,c){for(var d,e=0,f=c||a.response,g=a.quadTree.retrieve(b),h=g.length;h--,d=g[h];)if(d!==b&&a.shouldCollide(b,d)&&b.getBounds().overlaps(d.getBounds())){var i=b.body.shapes.length,j=d.body.shapes.length;if(0===i||0===j)continue;var k=0;do{var l=b.body.getShape(k),m=0;do{var n=d.body.getShape(m);!0===a["test"+l.shapeType+n.shapeType].call(this,b,l,d,n,f.clear())&&(e++,f.indexShapeA=k,f.indexShapeB=m,b.onCollision&&!1!==b.onCollision(f,d)&&b.body.respondToCollision.call(b.body,f),d.onCollision&&!1!==d.onCollision(f,b)&&d.body.respondToCollision.call(d.body,f)),m++}while(m<j);k++}while(k<i)}return e>0},a.rayCast=function(b,c){for(var d,e=0,f=c||[],g=a.quadTree.retrieve(b.getBounds()),h=g.length;h--,d=g[h];)if(d.body&&b.getBounds().overlaps(d.getBounds())){var i=d.body.shapes.length;if(0===d.body.shapes.length)continue;var j=b,l=0;do{var m=d.body.getShape(l);a["test"+j.shapeType+m.shapeType].call(this,k,j,d,m)&&(f[e]=d,e++),l++}while(l<i)}return f.length=e,f},a.testPolygonPolygon=function(a,c,d,e,f){var h,i=c.points,j=c.normals,k=j.length,l=e.points,m=e.normals,n=m.length,o=g.pop().copy(a.pos).add(a.ancestor._absPos).add(c.pos),p=g.pop().copy(d.pos).add(d.ancestor._absPos).add(e.pos);for(h=0;h<k;h++)if(b(o,p,i,l,j[h],f))return g.push(o),g.push(p),!1;for(h=0;h<n;h++)if(b(o,p,i,l,m[h],f))return g.push(o),g.push(p),!1;return f&&(f.a=a,f.b=d,f.overlapV.copy(f.overlapN).scale(f.overlap)),g.push(o),g.push(p),!0},a.testEllipseEllipse=function(a,b,c,d,e){var f=g.pop().copy(c.pos).add(c.ancestor._absPos).add(d.pos).sub(a.pos).add(a.ancestor._absPos).sub(b.pos),h=b.radius,i=d.radius,j=h+i,k=j*j,l=f.length2();if(l>k)return g.push(f),!1;if(e){var m=Math.sqrt(l);e.a=a,e.b=c,e.overlap=j-m,e.overlapN.copy(f.normalize()),e.overlapV.copy(f).scale(e.overlap),e.aInB=h<=i&&m<=i-h,e.bInA=i<=h&&m<=h-i}return g.push(f),!0},a.testPolygonEllipse=function(a,b,e,h,i){for(var j=g.pop().copy(e.pos).add(e.ancestor._absPos).add(h.pos).sub(a.pos).add(a.ancestor._absPos).sub(b.pos),k=h.radius,l=k*k,m=b.points,n=b.edges,o=n.length,p=g.pop(),q=g.pop(),r=g.pop(),s=0,t=0;t<o;t++){var u=t===o-1?0:t+1,v=0===t?o-1:t-1,w=0,x=null;p.copy(n[t]),r.copy(j).sub(m[t]),i&&r.length2()>l&&(i.aInB=!1);var y=c(p,r),z=!0;if(y===d){var A=null;if(o>1&&(p.copy(n[v]),A=g.pop().copy(j).sub(m[v]),(y=c(p,A))!==f&&(z=!1)),z){if((s=r.length())>k)return g.push(j),g.push(p),g.push(q),g.push(r),A&&g.push(A),!1;i&&(i.bInA=!1,x=r.normalize(),w=k-s)}A&&g.push(A)}else if(y===f){if(o>1&&(p.copy(n[u]),r.copy(j).sub(m[u]),(y=c(p,r))!==d&&(z=!1)),z){if((s=r.length())>k)return g.push(j),g.push(p),g.push(q),g.push(r),!1;i&&(i.bInA=!1,x=r.normalize(),w=k-s)}}else{q.copy(b.normals[t]),s=r.dotProduct(q);var B=Math.abs(s);if((1===o||s>0)&&B>k)return g.push(j),g.push(p),g.push(q),g.push(r),!1;i&&(x=q,w=k-s,(s>=0||w<2*k)&&(i.bInA=!1))}x&&i&&Math.abs(w)<Math.abs(i.overlap)&&(i.overlap=w,i.overlapN.copy(x))}return i&&(i.a=a,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),g.push(j),g.push(p),g.push(q),g.push(r),!0},a.testEllipsePolygon=function(b,c,d,e,f){var g=a.testPolygonEllipse(d,e,b,c,f);if(g&&f){var h=f.a,i=f.aInB;f.overlapN.negateSelf(),f.overlapV.negateSelf(),f.a=f.b,f.b=h,f.aInB=f.bInA,f.bInA=i}return g},a}()}(),function(){me.Renderable=me.Rect.extend({init:function(a,b,c,d){this.isRenderable=!0,this.isKinematic=!0,this.body=void 0,void 0===this.currentTransform&&(this.currentTransform=me.pool.pull("me.Matrix2d")),this.currentTransform.identity(),this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.anchorPoint instanceof me.ObservableVector2d?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate.bind(this)):this.anchorPoint=me.pool.pull("me.ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate.bind(this)}),this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this._bounds instanceof me.Rect?this._bounds.setShape(a,b,c,d):this._bounds=me.pool.pull("me.Rect",a,b,c,d),this.mask=void 0,this.tint=void 0,this.name="",this._absPos instanceof me.Vector2d?this._absPos.set(a,b):this._absPos=me.pool.pull("me.Vector2d",a,b),this.pos instanceof me.ObservableVector3d?this.pos.setMuted(a,b,0).setCallback(this.updateBoundsPos.bind(this)):this.pos=me.pool.pull("me.ObservableVector3d",a,b,0,{onUpdate:this.updateBoundsPos.bind(this)}),this._width=c,this._height=d,this._flip={x:!1,y:!1},this._inViewport=!1,this.shapeType="Rectangle",this.setOpacity(1)},onResetEvent:function(){this.init.apply(this,arguments)},getBounds:function(){return this._bounds},getOpacity:function(){return this.alpha},setOpacity:function(a){"number"==typeof a&&(this.alpha=me.Math.clamp(a,0,1),isNaN(this.alpha)&&(this.alpha=1))},flipX:function(a){return this._flip.x=!!a,this},flipY:function(a){return this._flip.y=!!a,this},transform:function(a){var b=this.getBounds();return this.currentTransform.multiply(a),b.setPoints(b.transform(a).points),b.pos.setV(this.pos),this},angleTo:function(a){var b,c,d=this.getBounds();if(a instanceof me.Renderable){var e=a.getBounds();b=e.centerX-d.centerX,c=e.centerY-d.centerY}else b=a.x-d.centerX,c=a.y-d.centerY;return Math.atan2(c,b)},distanceTo:function(a){var b,c,d=this.getBounds();if(a instanceof me.Renderable){var e=a.getBounds();b=d.centerX-e.centerX,c=d.centerY-e.centerY}else b=d.centerX-a.x,c=d.centerY-a.y;return Math.sqrt(b*b+c*c)},lookAt:function(a){var b;b=a instanceof me.Renderable?a.pos:a;var c=this.angleTo(b);return this.rotate(c),this},rotate:function(a){return isNaN(a)||this.currentTransform.rotate(a),this},scale:function(a,b){var c=a,d=void 0===b?c:b;return this.currentTransform.scale(c,d),this.getBounds().resize(this.width*c,this.height*d),this},scaleV:function(a){return this.scale(a.x,a.y),this},update:function(){return!1},updateBoundsPos:function(a,b){var c=this.getBounds();return c.pos.set(a,b,c.pos.z),this.ancestor instanceof me.Container&&!this.floating&&c.pos.add(this.ancestor._absPos),c},onAnchorUpdate:function(){},updateBounds:function(){return console.warn("Deprecated: me.Renderable.updateBounds"),me.Rect.prototype.updateBounds.apply(this)},preDraw:function(a){var b=this.getBounds(),c=b.width*this.anchorPoint.x,d=b.height*this.anchorPoint.y;if(a.save(),a.setGlobalAlpha(a.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){
var e=this._flip.x?this.centerX-c:0,f=this._flip.y?this.centerY-d:0;a.translate(e,f),a.scale(this._flip.x?-1:1,this._flip.y?-1:1),a.translate(-e,-f)}!0!==this.autoTransform||this.currentTransform.isIdentity()?a.translate(-c,-d):(this.currentTransform.translate(-c,-d),a.transform(this.currentTransform),this.currentTransform.translate(c,d)),void 0!==this.mask&&a.setMask(this.mask),void 0!==this.tint&&a.setTint(this.tint)},draw:function(){},postDraw:function(a){void 0!==this.mask&&a.clearMask(),void 0!==this.tint&&a.clearTint(),a.restore()},destroy:function(){me.pool.push(this.currentTransform),this.currentTransform=void 0,me.pool.push(this.anchorPoint),this.anchorPoint=void 0,me.pool.push(this.pos),this.pos=void 0,me.pool.push(this._absPos),this._absPos=void 0,me.pool.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,void 0!==this.mask&&(me.pool.push(this.mask),this.mask=void 0),void 0!==this.tint&&(me.pool.push(this.tint),this.tint=void 0),this.ancestor=void 0,void 0!==this.body&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}}),Object.defineProperty(me.Renderable.prototype,"inViewport",{get:function(){return this._inViewport},set:function(a){this._inViewport!==a&&(this._inViewport=a,"function"==typeof this.onVisibilityChange&&this.onVisibilityChange.call(this,a))},configurable:!0}),Object.defineProperty(me.Renderable.prototype,"width",{get:function(){return this._width},set:function(a){this._width!==a&&(this.getBounds().width=a,this._width=a)},configurable:!0}),Object.defineProperty(me.Renderable.prototype,"height",{get:function(){return this._height},set:function(a){this._height!==a&&(this.getBounds().height=a,this._height=a)},configurable:!0})}(),function(){me.ColorLayer=me.Renderable.extend({init:function(a,b,c){me.Renderable.prototype.init.apply(this,[0,0,1/0,1/0]),this.name=a,this.pos.z=c,this.floating=!0,b instanceof me.Color?this.color=b:this.color=me.pool.pull("me.Color").parseCSS(b),this.anchorPoint.set(0,0)},draw:function(a,b){var c=a.getColor(),d=me.game.viewport.pos;a.setColor(this.color),a.fillRect(b.left-d.x,b.top-d.y,b.width,b.height),a.setColor(c)},destroy:function(){me.pool.push(this.color),this.color=void 0,me.Renderable.prototype.destroy.apply(this)}})}(),function(){me.ImageLayer=me.Renderable.extend({init:function(a,b,c){if(me.Renderable.prototype.init.apply(this,[a,b,1/0,1/0]),this.image="object"===_typeof(c.image)?c.image:me.loader.getImage(c.image),!this.image)throw new Error(("string"==typeof c.image?"'"+c.image+"'":"Image")+" file for Image Layer '"+this.name+"' not found!");this.imagewidth=this.image.width,this.imageheight=this.image.height,"string"==typeof c.name&&(this.name=c.name),this.floating=!0,this.pos.z=c.z||0,this.offset=me.pool.pull("me.Vector2d",a,b),this.ratio=me.pool.pull("me.Vector2d",1,1),void 0!==c.ratio&&("number"==typeof c.ratio?this.ratio.set(c.ratio,c.ratio):this.ratio.setV(c.ratio)),void 0===c.anchorPoint?this.anchorPoint.set(0,0):"number"==typeof c.anchorPoint?this.anchorPoint.set(c.anchorPoint,c.anchorPoint):this.anchorPoint.setV(c.anchorPoint),Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(a){switch(this._repeat=a,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}this.resize(me.game.viewport.width,me.game.viewport.height),this.createPattern()},configurable:!0}),this.repeat=c.repeat||"repeat",me.event.subscribe(me.event.WEBGL_ONCONTEXT_RESTORED,this.createPattern.bind(this))},onActivateEvent:function(){var a=this.updateLayer.bind(this);this.vpChangeHdlr=me.event.subscribe(me.event.VIEWPORT_ONCHANGE,a),this.vpResizeHdlr=me.event.subscribe(me.event.VIEWPORT_ONRESIZE,this.resize.bind(this)),this.vpLoadedHdlr=me.event.subscribe(me.event.LEVEL_LOADED,function(){a(me.game.viewport.pos)}),!0!==this.ancestor.root&&this.updateLayer(me.game.viewport.pos)},resize:function(a,b){me.Renderable.prototype.resize.apply(this,[this.repeatX?1/0:a,this.repeatY?1/0:b])},createPattern:function(){this._pattern=me.video.renderer.createPattern(this.image,this._repeat)},updateLayer:function(a){var b=this.ratio.x,c=this.ratio.y;if(b===c!==0){var d=me.game.viewport,e=this.imagewidth,f=this.imageheight,g=d.bounds.width,h=d.bounds.height,i=this.anchorPoint.x,j=this.anchorPoint.y,k=i*(b-1)*(g-d.width)+this.offset.x-b*a.x,l=j*(c-1)*(h-d.height)+this.offset.y-c*a.y;this.repeatX?this.pos.x=k%e:this.pos.x=k,this.repeatY?this.pos.y=l%f:this.pos.y=l}},preDraw:function(a){a.save(),a.setGlobalAlpha(a.globalAlpha()*this.getOpacity())},draw:function(a){var b=me.game.viewport,c=this.imagewidth,d=this.imageheight,e=b.bounds.width,f=b.bounds.height,g=this.anchorPoint.x,h=this.anchorPoint.y,i=this.pos.x,j=this.pos.y;this.ratio.x===this.ratio.y===0&&(i+=g*(e-c),j+=h*(f-d)),a.translate(i,j),a.drawPattern(this._pattern,0,0,2*b.width,2*b.height)},onDeactivateEvent:function(){me.event.unsubscribe(this.vpChangeHdlr),me.event.unsubscribe(this.vpResizeHdlr),me.event.unsubscribe(this.vpLoadedHdlr)},destroy:function(){me.pool.push(this.offset),this.offset=void 0,me.pool.push(this.ratio),this.ratio=void 0,me.Renderable.prototype.destroy.apply(this)}})}(),function(){me.Sprite=me.Renderable.extend({init:function(a,b,c){if(this.animationpause=!1,this.animationspeed=100,this.offset=me.pool.pull("me.Vector2d",0,0),this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:"default",length:0,offset:new me.Vector2d,width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},me.Renderable.prototype.init.apply(this,[a,b,0,0]),c.image instanceof me.Renderer.prototype.Texture){if(this.source=c.image,this.image=this.source.getTexture(),this.textureAtlas=c.image,void 0!==c.region){var d=this.source.getRegion(c.region);if(!d)throw new Error("Texture - region for "+c.region+" not found");this.setRegion(d),this.current.width=c.framewidth||d.width,this.current.height=c.frameheight||d.height}}else this.image="object"===_typeof(c.image)?c.image:me.loader.getImage(c.image),this.current.width=c.framewidth=c.framewidth||this.image.width,this.current.height=c.frameheight=c.frameheight||this.image.height,this.source=me.video.renderer.cache.get(this.image,c),this.textureAtlas=this.source.getAtlas();void 0!==c.atlas?(this.textureAtlas=c.atlas,this.atlasIndices=c.atlasIndices):this.atlasIndices=null,this.width=this.current.width,this.height=this.current.height,void 0!==c.flipX&&this.flipX(!!c.flipX),void 0!==c.flipY&&this.flipY(!!c.flipY),void 0!==c.rotation&&this.currentTransform.rotate(c.rotation),c.anchorPoint&&this.anchorPoint.set(c.anchorPoint.x,c.anchorPoint.y),"string"==typeof c.name&&(this.name=c.name),0!==this.addAnimation("default",null)&&this.setCurrentAnimation("default"),this.autoTransform=!0},isFlickering:function(){return this._flicker.isFlickering},flicker:function(a,b){return this._flicker.duration=a,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=b,this._flicker.isFlickering=!0),this},addAnimation:function(a,b,c){this.anim[a]={name:a,frames:[],idx:0,length:0};var d=0;if("object"!==_typeof(this.textureAtlas))return 0;null==b&&(b=[],Object.keys(this.textureAtlas).forEach(function(a,c){b[c]=c}));for(var e=0,f=b.length;e<f;e++){var g,h=b[e];g="number"==typeof h||"string"==typeof h?{name:h,delay:c||this.animationspeed}:h;var i=g.name;if("number"==typeof i)void 0!==this.textureAtlas[i]&&(this.anim[a].frames[e]=Object.assign({},this.textureAtlas[i],g),d++);else{if(null===this.atlasIndices)throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[a].frames[e]=Object.assign({},this.textureAtlas[this.atlasIndices[i]],g),d++}}return this.anim[a].length=d,d},setCurrentAnimation:function(a,b,c){if(!this.anim[a])throw new Error("animation id '"+a+"' not defined");return this.current.name=a,this.current.length=this.anim[this.current.name].length,this.resetAnim="string"==typeof b?this.setCurrentAnimation.bind(this,b,null,!0):"function"==typeof b?b:void 0,this.setAnimationFrame(this.current.idx),c||(this.dt=0),this},reverseAnimation:function(a){return void 0!==a&&void 0!==this.anim[a]?this.anim[a].frames.reverse():this.anim[this.current.name].frames.reverse(),this},isCurrentAnimation:function(a){return this.current.name===a},setRegion:function(a){return null!==this.source&&(this.image=this.source.getTexture(a)),this.current.offset.setV(a.offset),this.current.angle=a.angle,this.width=this.current.width=a.width,this.height=this.current.height=a.height,a.anchorPoint&&this.anchorPoint.set(this._flip.x&&!0===a.trimmed?1-a.anchorPoint.x:a.anchorPoint.x,this._flip.y&&!0===a.trimmed?1-a.anchorPoint.y:a.anchorPoint.y),this},setAnimationFrame:function(a){return this.current.idx=(a||0)%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))},getCurrentAnimationFrame:function(){return this.current.idx},getAnimationFrameObjectByIndex:function(a){return this.anim[this.current.name].frames[a]},update:function(a){var b=!1;if(!this.animationpause&&this.current&&this.current.length>0){var c=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=a;this.dt>=c;){b=!0,this.dt-=c;var d=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(d),0===this.current.idx&&"function"==typeof this.resetAnim&&!1===this.resetAnim()){this.setAnimationFrame(this.current.length-1),this.dt%=c;break}c=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=a,this._flicker.duration<0&&("function"==typeof this._flicker.callback&&this._flicker.callback(),this.flicker(-1)),b=!0),b},updateBoundsPos:function(a,b){var c=this.getBounds();return c.pos.set(a-this.anchorPoint.x*c.width,b-this.anchorPoint.y*c.height),this.ancestor instanceof me.Container&&!this.floating&&c.pos.add(this.ancestor._absPos),c},onAnchorUpdate:function(a,b){this.anchorPoint.setMuted(a,b),this.updateBoundsPos(this.pos.x,this.pos.y)},destroy:function(){me.pool.push(this.offset),this.offset=void 0,me.Renderable.prototype.destroy.apply(this)},draw:function(a){if(!this._flicker.isFlickering||(this._flicker.state=!this._flicker.state,this._flicker.state)){var b=this.current,c=this.pos.x,d=this.pos.y,e=b.width,f=b.height,g=b.offset,h=this.offset;0!==b.angle&&(a.translate(-c,-d),a.rotate(b.angle),c-=f,e=b.height,f=b.width),a.drawImage(this.image,h.x+g.x,h.y+g.y,e,f,c,d,e,f)}}})}(),function(){me.GUI_Object=me.Sprite.extend({init:function(a,b,c){this.isClickable=!0,this.holdThreshold=250,this.isHoldable=!1,this.hover=!1,this.holdTimeout=null,this.updated=!1,this.released=!0,me.Sprite.prototype.init.apply(this,[a,b,c]),this.floating=!0,this.isKinematic=!1},update:function(a){var b=me.Sprite.prototype.update.apply(this,[a]);return this.updated?(this.released||(this.updated=!1),!0):b},clicked:function(a){if(0===a.button&&this.isClickable)return this.updated=!0,this.released=!1,this.isHoldable&&(null!==this.holdTimeout&&me.timer.clearTimeout(this.holdTimeout),this.holdTimeout=me.timer.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick.call(this,a)},onClick:function(){return!1},enter:function(a){return this.hover=!0,this.onOver.call(this,a)},onOver:function(){},leave:function(a){return this.hover=!1,this.release.call(this,a),this.onOut.call(this,a)},onOut:function(){},release:function(a){if(!1===this.released)return this.released=!0,me.timer.clearTimeout(this.holdTimeout),this.onRelease.call(this,a)},onRelease:function(){return!1},hold:function(){me.timer.clearTimeout(this.holdTimeout),this.released||this.onHold.call(this)},onHold:function(){},onActivateEvent:function(){me.input.registerPointerEvent("pointerdown",this,this.clicked.bind(this)),me.input.registerPointerEvent("pointerup",this,this.release.bind(this)),me.input.registerPointerEvent("pointercancel",this,this.release.bind(this)),me.input.registerPointerEvent("pointerenter",this,this.enter.bind(this)),me.input.registerPointerEvent("pointerleave",this,this.leave.bind(this))},onDeactivateEvent:function(){me.input.releasePointerEvent("pointerdown",this),me.input.releasePointerEvent("pointerup",this),me.input.releasePointerEvent("pointercancel",this),me.input.releasePointerEvent("pointerenter",this),me.input.releasePointerEvent("pointerleave",this),me.timer.clearTimeout(this.holdTimeout)}})}(),function(){var a=function(a,b){this.removeChildNow(a,b)},b=0;me.Container=me.Renderable.extend({init:function(a,b,c,d,e){this.pendingSort=null,me.Renderable.prototype.init.apply(this,[a||0,b||0,c||1/0,d||1/0]),this.root=e||!1,this.children=[],this.sortOn=me.game.sortOn,this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(){},this.drawCount=0,this.childBounds=this.getBounds().clone(),this.autoTransform=!0,this.isKinematic=!1,!0===this.root&&me.event.subscribe(me.event.CANVAS_ONRESIZE,this.updateChildBounds.bind(this))},reset:function(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var a,b=this.children.length;b>=0;a=this.children[--b])a&&!a.isPersistent&&this.removeChildNow(a);void 0!==this.currentTransform&&this.currentTransform.identity()},addChild:function(a,b){return a.ancestor instanceof me.Container?a.ancestor.removeChildNow(a):a.isRenderable&&(a.GUID=me.utils.createGUID(a.id)),a.ancestor=this,this.children.push(a),void 0!==a.pos&&("number"==typeof b?a.pos.z=b:!0===this.autoDepth&&(a.pos.z=this.children.length)),!0===this.autoSort&&this.sort(),"function"==typeof a.onActivateEvent&&this.isAttachedToRoot()&&a.onActivateEvent(),this.onChildChange.call(this,this.children.length-1),a},addChildAt:function(a,b){if(b>=0&&b<this.children.length)return a.ancestor instanceof me.Container?a.ancestor.removeChildNow(a):a.isRenderable&&(a.GUID=me.utils.createGUID()),a.ancestor=this,this.children.splice(b,0,a),"function"==typeof a.onActivateEvent&&this.isAttachedToRoot()&&a.onActivateEvent(),this.onChildChange.call(this,b),a;throw new Error("Index ("+b+") Out Of Bounds for addChildAt()")},forEach:function(a,b){var c=this,d=0,e=this.children.length;if("function"!=typeof a)throw new Error(a+" is not a function");for(arguments.length>1&&(c=b);d<e;)a.call(c,this.children[d],d,this.children),d++},swapChildren:function(a,b){var c=this.getChildIndex(a),d=this.getChildIndex(b);if(-1===c||-1===d)throw new Error(a+" Both the supplied childs must be a child of the caller "+this);var e=a.pos.z;a.pos.z=b.pos.z,b.pos.z=e,this.children[c]=b,this.children[d]=a},getChildAt:function(a){if(a>=0&&a<this.children.length)return this.children[a];throw new Error("Index ("+a+") Out Of Bounds for getChildAt()")},getChildIndex:function(a){return this.children.indexOf(a)},getNextChild:function(a){var b=this.children.indexOf(a)-1;if(b>=0&&b<this.children.length)return this.getChildAt(b)},hasChild:function(a){return this===a.ancestor},getChildByProp:function(a,b){for(var c=[],d=this.children.length-1;d>=0;d--){var e=this.children[d];!function(a,d){var e=a[d];b instanceof RegExp&&"string"==typeof e?b.test(e)&&c.push(a):e===b&&c.push(a)}(e,a),e instanceof me.Container&&(c=c.concat(e.getChildByProp(a,b)))}return c},getChildByType:function(a){for(var b=[],c=this.children.length-1;c>=0;c--){var d=this.children[c];d instanceof a&&b.push(d),d instanceof me.Container&&(b=b.concat(d.getChildByType(a)))}return b},getChildByName:function(a){return this.getChildByProp("name",a)},getChildByGUID:function(a){var b=this.getChildByProp("GUID",a);return b.length>0?b[0]:null},updateChildBounds:function(){this.childBounds.pos.set(1/0,1/0),this.childBounds.resize(-1/0,-1/0);for(var a,b,c=this.children.length;c--,b=this.children[c];)b.isRenderable&&null!==(a=b instanceof me.Container?b.childBounds:b.getBounds())&&this.childBounds.union(a);return this.childBounds},isAttachedToRoot:function(){if(!0===this.root)return!0;for(var a=this.ancestor;a;){if(!0===a.root)return!0;a=a.ancestor}return!1},updateBoundsPos:function(a,b){me.Renderable.prototype.updateBoundsPos.apply(this,[a,b]),this._absPos.set(a,b),this.ancestor instanceof me.Container&&!this.floating&&this._absPos.add(this.ancestor._absPos);for(var c,d=this.children.length;d--,c=this.children[d];)c.isRenderable&&c.updateBoundsPos(c.pos.x,c.pos.y);return this.getBounds()},onActivateEvent:function(){for(var a,b=this.children.length;b--,a=this.children[b];)"function"==typeof a.onActivateEvent&&a.onActivateEvent()},removeChild:function(b,c){if(!this.hasChild(b))throw new Error("Child is not mine.");me.utils.function.defer(a,this,b,c)},removeChildNow:function(a,b){if(this.hasChild(a)&&this.getChildIndex(a)>=0){"function"==typeof a.onDeactivateEvent&&a.onDeactivateEvent(),b||("function"==typeof a.destroy&&a.destroy(),me.pool.push(a));var c=this.getChildIndex(a);c>=0&&(this.children.splice(c,1),a.ancestor=void 0),this.onChildChange.call(this,c)}},setChildsProperty:function(a,b,c){for(var d=this.children.length;d>=0;d--){var e=this.children[d];!0===c&&e instanceof me.Container&&e.setChildsProperty(a,b,c),e[a]=b}},moveUp:function(a){var b=this.getChildIndex(a);b-1>=0&&this.swapChildren(a,this.getChildAt(b-1))},moveDown:function(a){var b=this.getChildIndex(a);b>=0&&b+1<this.children.length&&this.swapChildren(a,this.getChildAt(b+1))},moveToTop:function(a){var b=this.getChildIndex(a);b>0&&(this.children.splice(0,0,this.children.splice(b,1)[0]),a.pos.z=this.children[1].pos.z+1)},moveToBottom:function(a){var b=this.getChildIndex(a);b>=0&&b<this.children.length-1&&(this.children.splice(this.children.length-1,0,this.children.splice(b,1)[0]),a.pos.z=this.children[this.children.length-2].pos.z-1)},sort:function(a){if(!this.pendingSort){if(!0===a)for(var b,c=this.children.length;c--,b=this.children[c];)b instanceof me.Container&&b.sort(a);this.pendingSort=me.utils.function.defer(function(a){a.children.sort(a["_sort"+a.sortOn.toUpperCase()]),a.pendingSort=null,me.game.repaint()},this,this)}},onDeactivateEvent:function(){for(var a,b=this.children.length;b--,a=this.children[b];)"function"==typeof a.onDeactivateEvent&&a.onDeactivateEvent()},_sortZ:function(a,b){return b.pos&&a.pos?b.pos.z-a.pos.z:a.pos?-1/0:1/0},_sortReverseZ:function(a,b){return a.pos&&b.pos?a.pos.z-b.pos.z:a.pos?1/0:-1/0},_sortX:function(a,b){if(!b.pos||!a.pos)return a.pos?-1/0:1/0;var c=b.pos.z-a.pos.z;return c||b.pos.x-a.pos.x},_sortY:function(a,b){if(!b.pos||!a.pos)return a.pos?-1/0:1/0;var c=b.pos.z-a.pos.z;return c||b.pos.y-a.pos.y},destroy:function(){this.reset(),me.Renderable.prototype.destroy.apply(this,arguments)},update:function(a){me.Renderable.prototype.update.apply(this,[a]);var c=!1,d=!1,e=me.state.isPaused();this._absPos.setV(this.pos),this.ancestor&&this._absPos.add(this.ancestor._absPos);for(var f,g=this.children.length;g--,f=this.children[g];)e&&!f.updateWhenPaused||(f.isRenderable?(d=b>0||f.floating,d&&b++,f.inViewport=!1,me.state.current().cameras.forEach(function(a){a.isVisible(f,d)&&(f.inViewport=!0)}),c=(f.inViewport||f.alwaysUpdate)&&f.update(a)||c,f._absPos.setV(this._absPos).add(f.pos),b>0&&b--):c=f.update(a)||c);return c},draw:function(a,b){var c=!1;this.drawCount=0,!1===this.root&&!0===this.clipping&&!0===this.childBounds.isFinite()&&a.clipRect(this.childBounds.pos.x,this.childBounds.pos.y,this.childBounds.width,this.childBounds.height),a.translate(this.pos.x,this.pos.y);for(var d,e=this.children.length;e--,d=this.children[e];)d.isRenderable&&(c=!0===d.floating,(d.inViewport||c)&&(c&&(a.save(),a.resetTransform()),d.preDraw(a),d.draw(a,b),d.postDraw(a),c&&a.restore(),this.drawCount++))}})}(),function(){var a=Math.min,b=Math.max,c=new me.Vector2d;me.Camera2d=me.Renderable.extend({init:function(a,b,c,d){me.Renderable.prototype.init.apply(this,[a,b,c-a,d-b]),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=new me.Rect(-1/0,-1/0,1/0,1/0),this.smoothFollow=!0,this.damping=1,this.near=1,this.far=1e3,this.projectionMatrix=new me.Matrix2d,this.offset=new me.Vector2d,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this._updateProjectionMatrix(),me.event.subscribe(me.event.GAME_RESET,this.reset.bind(this)),me.event.subscribe(me.event.CANVAS_ONRESIZE,this.resize.bind(this))},_updateProjectionMatrix:function(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)},_followH:function(c){var d=this.pos.x;return c.x-this.pos.x>this.deadzone.right?d=a(c.x-this.deadzone.right,this.bounds.width-this.width):c.x-this.pos.x<this.deadzone.pos.x&&(d=b(c.x-this.deadzone.pos.x,this.bounds.pos.x)),d},_followV:function(c){var d=this.pos.y;return c.y-this.pos.y>this.deadzone.bottom?d=a(c.y-this.deadzone.bottom,this.bounds.height-this.height):c.y-this.pos.y<this.deadzone.pos.y&&(d=b(c.y-this.deadzone.pos.y,this.bounds.pos.y)),d},reset:function(a,b){this.pos.x=a||0,this.pos.y=b||0,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this._updateProjectionMatrix()},setDeadzone:function(a,b){void 0===this.deadzone&&(this.deadzone=new me.Rect(0,0,0,0)),this.deadzone.pos.set(~~((this.width-a)/2),~~((this.height-b)/2-.25*b)),this.deadzone.resize(a,b),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0},resize:function(a,b){me.Renderable.prototype.resize.apply(this,[a,b]),this.smoothFollow=!1;var c=me.levelDirector.getCurrentLevel();return this.setBounds(0,0,Math.max(a,c?c.getBounds().width:0),Math.max(b,c?c.getBounds().height:0)),this.setDeadzone(a/6,b/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),me.event.publish(me.event.VIEWPORT_ONRESIZE,[this.width,this.height]),this},setBounds:function(a,b,c,d){this.smoothFollow=!1,this.bounds.pos.set(a,b),this.bounds.resize(c,d),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0},follow:function(a,b,c){if(a instanceof me.Renderable)this.target=a.pos;else{if(!(a instanceof me.Vector2d||a instanceof me.Vector3d))throw new Error("invalid target for me.Camera2d.follow");this.target=a}this.follow_axis=void 0===b?this.AXIS.BOTH:b,this.smoothFollow=!1,this.damping="number"!=typeof c?1:me.Math.clamp(c,0,1),this.updateTarget(),this.smoothFollow=!0},unfollow:function(){this.target=null,this.follow_axis=this.AXIS.NONE},move:function(a,b){this.moveTo(this.pos.x+a,this.pos.y+b)},moveTo:function(a,b){var c=this.pos.x,d=this.pos.y;this.pos.x=me.Math.clamp(a,this.bounds.pos.x,this.bounds.width-this.width),this.pos.y=me.Math.clamp(b,this.bounds.pos.y,this.bounds.height-this.height),c===this.pos.x&&d===this.pos.y||me.event.publish(me.event.VIEWPORT_ONCHANGE,[this.pos])},updateTarget:function(){if(this.target){switch(c.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:c.x=this._followH(this.target);break;case this.AXIS.VERTICAL:c.y=this._followV(this.target);break;case this.AXIS.BOTH:c.x=this._followH(this.target),c.y=this._followV(this.target)}if(!this.pos.equals(c)){if(!0===this.smoothFollow&&this.damping<1){if(me.Math.toBeCloseTo(c.x,this.pos.x,2)&&me.Math.toBeCloseTo(c.y,this.pos.y,2))return this.pos.setV(c),!1;this.pos.lerp(c,this.damping)}else this.pos.setV(c);return!0}}return!1},update:function(a){var b=this.updateTarget(a);return this._shake.duration>0&&(this._shake.duration-=a,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):(this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.HORIZONTAL||(this.offset.x=(Math.random()-.5)*this._shake.intensity),this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.VERTICAL||(this.offset.y=(Math.random()-.5)*this._shake.intensity)),b=!0),!0===b&&me.event.publish(me.event.VIEWPORT_ONCHANGE,[this.pos]),null==this._fadeIn.tween&&null==this._fadeOut.tween||(b=!0),b},shake:function(a,b,c,d,e){0!==this._shake.duration&&!0!==e||(this._shake.intensity=a,this._shake.duration=b,this._shake.axis=c||this.AXIS.BOTH,this._shake.onComplete="function"==typeof d?d:void 0)},fadeOut:function(a,b,c){this._fadeOut.color=me.pool.pull("me.Color").copy(a),this._fadeOut.tween=me.pool.pull("me.Tween",this._fadeOut.color).to({alpha:0},b||1e3).onComplete(c||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()},fadeIn:function(a,b,c){this._fadeIn.color=me.pool.pull("me.Color").copy(a);var d=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=me.pool.pull("me.Tween",this._fadeIn.color).to({alpha:d},b||1e3).onComplete(c||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(a){var b=a.getBounds();this.moveTo(a.pos.x+b.pos.x+b.width/2,a.pos.y+b.pos.y+b.height/2)},isVisible:function(a,b){return!0===b||!0===a.floating?me.video.renderer.overlaps(a.getBounds()):a.getBounds().overlaps(this)},localToWorld:function(a,b,c){return c=c||new me.Vector2d,c.set(a,b).add(this.pos).sub(me.game.world.pos),this.currentTransform.isIdentity()||this.currentTransform.multiplyVectorInverse(c),c},worldToLocal:function(a,b,c){return c=c||new me.Vector2d,c.set(a,b),this.currentTransform.isIdentity()||this.currentTransform.multiplyVector(c),c.sub(this.pos).add(me.game.world.pos)},drawFX:function(a){this._fadeIn.tween&&(a.clearColor(this._fadeIn.color),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,me.pool.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(a.clearColor(this._fadeOut.color),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,me.pool.push(this._fadeOut.color),this._fadeOut.color=null))},draw:function(a,b){var c=this.pos.x+this.offset.x,d=this.pos.y+this.offset.y;b.currentTransform.translate(-c,-d),a.setProjection(this.projectionMatrix),a.clipRect(0,0,this.width,this.height),this.preDraw(a),b.preDraw(a),b.draw(a,this),this.drawFX(a),b.postDraw(a),this.postDraw(a),b.currentTransform.translate(c,d)}})}(),function(){me.Entity=me.Renderable.extend({init:function(a,b,c){if(this.children=[],"number"!=typeof c.width||"number"!=typeof c.height)throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");me.Renderable.prototype.init.apply(this,[a,b,c.width,c.height]),c.image&&(c.framewidth=c.framewidth||c.width,c.frameheight=c.frameheight||c.height,this.renderable=new me.Sprite(0,0,c)),c.anchorPoint&&this.anchorPoint.set(c.anchorPoint.x,c.anchorPoint.y),"string"==typeof c.name&&(this.name=c.name),this.type=c.type||"",this.id=c.id||"",this.alive=!0;var d=Array.isArray(c.shapes)?c.shapes:[new me.Polygon(0,0,[new me.Vector2d(0,0),new me.Vector2d(this.width,0),new me.Vector2d(this.width,this.height),new me.Vector2d(0,this.height)])];if(void 0!==this.body?this.body.init(this,d,this.onBodyUpdate.bind(this)):this.body=new me.Body(this,d,this.onBodyUpdate.bind(this)),0===this.width&&0===this.height&&this.resize(this.body.width,this.body.height),void 0!==c.collisionMask&&this.body.setCollisionMask(c.collisionMask),void 0!==c.collisionType){if(void 0===me.collision.types[c.collisionType])throw new Error("Invalid value for the collisionType property");this.body.collisionType=me.collision.types[c.collisionType]}this.autoTransform=!1,this.isKinematic=!1},update:function(a){return this.renderable?this.renderable.update(a):me.Renderable.prototype.update.apply(this,[a])},updateBoundsPos:function(a,b){if(void 0!==this.body){var c=this.body.pos;me.Renderable.prototype.updateBoundsPos.apply(this,[a+c.x,b+c.y])}else me.Renderable.prototype.updateBoundsPos.apply(this,[a,b]);return this.getBounds()},onBodyUpdate:function(a){this.getBounds().resize(a.width,a.height),this.updateBoundsPos(this.pos.x,this.pos.y)},preDraw:function(a){a.save(),a.translate(this.pos.x+this.body.pos.x,this.pos.y+this.body.pos.y),this.renderable instanceof me.Renderable&&a.translate(this.anchorPoint.x*this.body.width,this.anchorPoint.y*this.body.height)},draw:function(a,b){var c=this.renderable;c instanceof me.Renderable&&(c.preDraw(a),c.draw(a,b),c.postDraw(a))},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),me.Renderable.prototype.destroy.apply(this,arguments)},onDeactivateEvent:function(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()},onCollision:function(){return!1}}),Object.defineProperty(me.Entity.prototype,"renderable",{get:function(){return this.children[0]},set:function(a){if(!(a instanceof me.Renderable))throw new Error(a+"should extend me.Renderable");this.children[0]=a,this.children[0].ancestor=this},configurable:!0})}(),function(){var a,b={cameras:[]};me.Stage=me.Object.extend({init:function(a){this.cameras=new Map,this.settings=Object.assign(b,a||{})},reset:function(){var b=this;if(this.settings.cameras.forEach(function(a){b.cameras.set(a.name,a)}),!1===this.cameras.has("default")){if(void 0===a){var c=me.video.renderer.getWidth(),d=me.video.renderer.getHeight();a=new me.Camera2d(0,0,c,d)}this.cameras.set("default",a)}me.game.reset(),this.onResetEvent.apply(this,arguments)},destroy:function(){this.cameras.clear(),this.onDestroyEvent.apply(this,arguments)},onResetEvent:function(){},onDestroyEvent:function(){}})}(),function(){me.state=function(){function a(){-1===i&&-1!==h&&(me.timer.reset(),i=window.requestAnimationFrame(d))}function b(){j&&-1!==h&&(me.timer.reset(),j=!1)}function c(){j=!0}function d(a){var b=k[h].stage;me.game.update(a,b),me.game.draw(b),-1!==i&&(i=window.requestAnimationFrame(d))}function e(){window.cancelAnimationFrame(i),i=-1}function f(b){e(),k[h]&&k[h].stage.destroy(),k[b]&&(h=b,k[h].stage.reset.apply(k[h].stage,n),a(),m&&m(),me.game.repaint())}var g={},h=-1,i=-1,j=!1,k={},l={color:"",duration:0},m=null,n=null,o=0;return g.LOADING=0,g.MENU=1,g.READY=2,g.PLAY=3,g.GAMEOVER=4,g.GAME_END=5,g.SCORE=6,g.CREDITS=7,g.SETTINGS=8,g.USER=100,g.onPause=null,g.onResume=null,g.onStop=null,g.onRestart=null,g.init=function(){g.set(g.LOADING,new me.DefaultLoadingScreen)},g.stop=function(a){h!==g.LOADING&&g.isRunning()&&(e(),!0===a&&me.audio.pauseTrack(),o=window.performance.now(),me.event.publish(me.event.STATE_STOP),"function"==typeof g.onStop&&g.onStop())},g.pause=function(a){h===g.LOADING||g.isPaused()||(c(),!0===a&&me.audio.pauseTrack(),o=window.performance.now(),me.event.publish(me.event.STATE_PAUSE),"function"==typeof g.onPause&&g.onPause())},g.restart=function(b){g.isRunning()||(a(),!0===b&&me.audio.resumeTrack(),o=window.performance.now()-o,me.game.repaint(),me.event.publish(me.event.STATE_RESTART,[o]),"function"==typeof g.onRestart&&g.onRestart())},g.resume=function(a){g.isPaused()&&(b(),!0===a&&me.audio.resumeTrack(),o=window.performance.now()-o,me.event.publish(me.event.STATE_RESUME,[o]),"function"==typeof g.onResume&&g.onResume())},g.isRunning=function(){return-1!==i},g.isPaused=function(){return j},g.set=function(a,b){if(!(b instanceof me.Stage))throw new Error(b+" is not an instance of me.Stage");k[a]={},k[a].stage=b,k[a].transition=!0},g.current=function(){return k[h].stage},g.transition=function(a,b,c){"fade"===a&&(l.color=b,l.duration=c)},g.setTransition=function(a,b){k[a].transition=b},g.change=function(a){if(void 0===k[a])throw new Error("Undefined Stage for state '"+a+"'");g.isCurrent(a)||(n=null,arguments.length>1&&(n=Array.prototype.slice.call(arguments,1)),l.duration&&k[a].transition?(m=function(){me.game.viewport.fadeOut(l.color,l.duration)},me.game.viewport.fadeIn(l.color,l.duration,function(){me.utils.function.defer(f,this,a)})):me.utils.function.defer(f,this,a))},g.isCurrent=function(a){return h===a},g}()}(),
function(){var a=me.Renderable.extend({init:function(a,b,c,d){me.Renderable.prototype.init.apply(this,[a,b,c,d]),this.invalidate=!1,this.progress=0,this.anchorPoint.set(0,0)},onProgressUpdate:function(a){this.progress=~~(a*this.width),this.invalidate=!0},update:function(){return!0===this.invalidate&&(this.invalidate=!1,!0)},draw:function(a){var b=a.getColor(),c=a.getHeight();a.setColor("black"),a.fillRect(this.pos.x,c/2,this.width,this.height/2),a.setColor("#55aa00"),a.fillRect(this.pos.x,c/2,this.progress,this.height/2),a.setColor(b)}}),b=me.Renderable.extend({init:function(a,b){me.Renderable.prototype.init.apply(this,[a,b,100,85]),this.iconCanvas=me.video.createCanvas(me.Math.nextPowerOfTwo(this.width),me.Math.nextPowerOfTwo(this.height),!1);var c=me.video.renderer.getContext2d(this.iconCanvas);c.beginPath(),c.moveTo(.7,48.9),c.bezierCurveTo(10.8,68.9,38.4,75.8,62.2,64.5),c.bezierCurveTo(86.1,53.1,97.2,27.7,87,7.7),c.lineTo(87,7.7),c.bezierCurveTo(89.9,15.4,73.9,30.2,50.5,41.4),c.bezierCurveTo(27.1,52.5,5.2,55.8,.7,48.9),c.lineTo(.7,48.9),c.closePath(),c.fillStyle="rgb(255, 255, 255)",c.fill(),c.beginPath(),c.moveTo(84,7),c.bezierCurveTo(87.6,14.7,72.5,30.2,50.2,41.6),c.bezierCurveTo(27.9,53,6.9,55.9,3.2,48.2),c.bezierCurveTo(-.5,40.4,14.6,24.9,36.9,13.5),c.bezierCurveTo(59.2,2.2,80.3,-.8,84,7),c.lineTo(84,7),c.closePath(),c.lineWidth=5.3,c.strokeStyle="rgb(255, 255, 255)",c.lineJoin="miter",c.miterLimit=4,c.stroke(),this.anchorPoint.set(.5,.5)},draw:function(a){a.drawImage(this.iconCanvas,this.pos.x,this.pos.y)}}),c=me.Renderable.extend({init:function(a,b){me.Renderable.prototype.init.apply(this,[0,0,a,b]),this.fontCanvas=me.video.createCanvas(256,64),this.drawFont(me.video.renderer.getContext2d(this.fontCanvas)),this.anchorPoint.set(0,0)},drawFont:function(a){var b=me.pool.pull("me.Text",0,0,{font:"century gothic",size:32,fillStyle:"white",textAlign:"middle",textBaseline:"top",text:"melon"}),c=me.pool.pull("me.Text",0,0,{font:"century gothic",size:32,fillStyle:"#55aa00",textAlign:"middle",textBaseline:"top",bold:!0,text:"JS"}),d=b.measureText(a).width,e=c.measureText(a).width;this.pos.x=Math.round((this.width-d-e)/2),this.pos.y=Math.round(this.height/2+16),b._drawFont(a,"melon",0,0),c._drawFont(a,"JS",d,0),me.pool.push(b),me.pool.push(c)},draw:function(a){a.drawImage(this.fontCanvas,this.pos.x,this.pos.y)}});me.DefaultLoadingScreen=me.Stage.extend({onResetEvent:function(){me.game.world.addChild(new me.ColorLayer("background","#202020",0),0);var d=new a(0,me.video.renderer.getHeight()/2,me.video.renderer.getWidth(),8);this.loaderHdlr=me.event.subscribe(me.event.LOADER_PROGRESS,d.onProgressUpdate.bind(d)),this.resizeHdlr=me.event.subscribe(me.event.VIEWPORT_ONRESIZE,d.resize.bind(d)),me.game.world.addChild(d,1);var e=new b(me.video.renderer.getWidth()/2,me.video.renderer.getHeight()/2-d.height-35);me.game.world.addChild(e,1),me.game.world.addChild(new c(me.video.renderer.getWidth(),me.video.renderer.getHeight()),1)},onDestroyEvent:function(){me.event.unsubscribe(this.loaderHdlr),me.event.unsubscribe(this.resizeHdlr),this.loaderHdlr=this.resizeHdlr=null}})}(),function(){me.loader=function(){function a(b){if(o===n){if(!b&&!h.onload)throw new Error("no load callback defined");clearTimeout(p);var c=b||h.onload;setTimeout(function(){c(),me.event.publish(me.event.LOADER_COMPLETE)},300)}else p=setTimeout(function(){a(b)},100)}function b(a,b,c){i[a.name]=new Image,i[a.name].onload=b,i[a.name].onerror=c,"string"==typeof h.crossOrigin&&(i[a.name].crossOrigin=h.crossOrigin),i[a.name].src=a.src+h.nocache}function c(a,b,c){var d=new FontFace(a.name,a.src);d.load().then(function(){document.fonts.add(d),document.body.style.fontFamily=a.name,b()},function(b){c(a.name)})}function d(a,b,c){function d(b){j[a.name]=b,"tmx"===a.type&&me.levelDirector.addTMXLevel(a.name)}if(a.data)return d(a.data),void b();var e=new XMLHttpRequest,f=me.utils.file.getExtension(a.src);e.overrideMimeType&&("json"===f?e.overrideMimeType("application/json"):e.overrideMimeType("text/xml")),e.open("GET",a.src+h.nocache,!0),e.withCredentials=me.loader.withCredentials,e.ontimeout=c,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||0===e.status&&e.responseText){var g=null;switch(f){case"xml":case"tmx":case"tsx":if(me.device.ua.match(/msie/i)||!e.responseXML){if(!window.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");g=(new DOMParser).parseFromString(e.responseText,"text/xml")}else g=e.responseXML;var h=me.TMXUtils.parse(g);switch(f){case"tmx":g=h.map;break;case"tsx":g=h.tilesets[0]}break;case"json":g=JSON.parse(e.responseText);break;default:throw new Error("TMX file format "+f+"not supported !")}d(g),b()}else c(a.name)},e.send()}function e(a,b,c){var d=new XMLHttpRequest;d.overrideMimeType&&d.overrideMimeType("application/json"),d.open("GET",a.src+h.nocache,!0),d.withCredentials=me.loader.withCredentials,d.ontimeout=c,d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status&&d.responseText?(l[a.name]=JSON.parse(d.responseText),b()):c(a.name))},d.send()}function f(a,b,c){var d=new XMLHttpRequest;d.open("GET",a.src+h.nocache,!0),d.withCredentials=me.loader.withCredentials,d.responseType="arraybuffer",d.onerror=c,d.onload=function(){var c=d.response;if(c){for(var e=new Uint8Array(c),f=[],g=0;g<e.byteLength;g++)f[g]=String.fromCharCode(e[g]);k[a.name]=f.join(""),b()}},d.send()}function g(a,b,c){var d=document.createElement("script");d.src=a.src,d.type="text/javascript","string"==typeof h.crossOrigin&&(d.crossOrigin=h.crossOrigin),d.defer=!0,d.onload=function(){b()},d.onerror=function(){c(a.name)},document.getElementsByTagName("body")[0].appendChild(d)}var h={},i={},j={},k={},l={},m={},n=0,o=0,p=0;return h.nocache="",h.onload=void 0,h.onProgress=void 0,h.crossOrigin=void 0,h.withCredentials=!1,h.onResourceLoaded=function(a){o++;var b=o/n;h.onProgress&&h.onProgress(b,a),me.event.publish(me.event.LOADER_PROGRESS,[b,a])},h.onLoadingError=function(a){throw new Error("Failed loading resource "+a.src)},h.setNocache=function(a){h.nocache=a?"?"+~~(1e7*Math.random()):""},h.setBaseURL=function(a,b){"*"!==a?m[a]=b:(m.audio=b,m.binary=b,m.image=b,m.json=b,m.js=b,m.tmx=b,m.tsx=b)},h.preload=function(b,c,d){for(var e=0;e<b.length;e++)n+=h.load(b[e],h.onResourceLoaded.bind(h,b[e]),h.onLoadingError.bind(h,b[e]));void 0!==c&&(h.onload=c),!1!==d&&me.state.change(me.state.LOADING),a(c)},h.load=function(a,h,i){switch(void 0!==m[a.type]&&(a.src=m[a.type]+a.src),a.type){case"binary":return f.call(this,a,h,i),1;case"image":return b.call(this,a,h,i),1;case"json":return e.call(this,a,h,i),1;case"js":return g.call(this,a,h,i),1;case"tmx":case"tsx":return d.call(this,a,h,i),1;case"audio":return me.audio.load(a,!!a.stream,h,i),1;case"fontface":return c.call(this,a,h,i),1;default:throw new Error("load : unknown or invalid resource type : "+a.type)}},h.unload=function(a){switch(a.type){case"binary":return a.name in k&&(delete k[a.name],!0);case"image":return a.name in i&&(delete i[a.name],!0);case"json":return a.name in l&&(delete l[a.name],!0);case"js":case"fontface":return!0;case"tmx":case"tsx":return a.name in j&&(delete j[a.name],!0);case"audio":return me.audio.unload(a.name);default:throw new Error("unload : unknown or invalid resource type : "+a.type)}},h.unloadAll=function(){var a;for(a in k)k.hasOwnProperty(a)&&h.unload({name:a,type:"binary"});for(a in i)i.hasOwnProperty(a)&&h.unload({name:a,type:"image"});for(a in j)j.hasOwnProperty(a)&&h.unload({name:a,type:"tmx"});for(a in l)l.hasOwnProperty(a)&&h.unload({name:a,type:"json"});me.audio.unloadAll()},h.getTMX=function(a){return a=""+a,a in j?j[a]:null},h.getBinary=function(a){return a=""+a,a in k?k[a]:null},h.getImage=function(a){return a=me.utils.file.getBasename(""+a),a in i?i[a]:null},h.getJSON=function(a){return a=""+a,a in l?l[a]:null},h.getLoadProgress=function(){return o/n},h}()}(),function(){var a=["ex","em","pt","px"],b=[12,24,.75,1],c=function(a,b,c){a.font=b.font,a.fillStyle=b.fillStyle.toRGBA(),!0===c&&(a.strokeStyle=b.strokeStyle.toRGBA(),a.lineWidth=b.lineWidth),a.textAlign=b.textAlign,a.textBaseline=b.textBaseline};me.Text=me.Renderable.extend({init:function(a,b,c){me.Renderable.prototype.init.apply(this,[a,b,c.width||0,c.height||0]),void 0!==c.fillStyle?c.fillStyle instanceof me.Color?this.fillStyle=c.fillStyle:this.fillStyle=me.pool.pull("me.Color").parseCSS(c.fillStyle):this.fillStyle=me.pool.pull("me.Color",0,0,0),void 0!==c.strokeStyle?c.strokeStyle instanceof me.Color?this.strokeStyle=c.strokeStyle:this.strokeStyle=me.pool.pull("me.Color").parseCSS(c.strokeStyle):this.strokeStyle=me.pool.pull("me.Color",0,0,0),this.lineWidth=c.lineWidth||1,this.textAlign=c.textAlign||"left",this.textBaseline=c.textBaseline||"top",this.lineHeight=c.lineHeight||1,this._fontSize=0,this._text="",void 0!==c.anchorPoint?this.anchorPoint.setV(c.anchorPoint):this.anchorPoint.set(0,0),void 0!==c.floating&&(this.floating=!!c.floating),this.setFont(c.font,c.size),!0===c.bold&&this.bold(),!0===c.italic&&this.italic(),this.setText(c.text)},bold:function(){return this.font="bold "+this.font,this.isDirty=!0,this},italic:function(){return this.font="italic "+this.font,this.isDirty=!0,this},setFont:function(c,d){var e=c.split(",").map(function(a){return a=a.trim(),/(^".*"$)|(^'.*'$)/.test(a)?a:'"'+a+'"'});if("number"==typeof d)this._fontSize=d,d+="px";else{var f=d.match(/([-+]?[\d.]*)(.*)/);this._fontSize=parseFloat(f[1]),f[2]?this._fontSize*=b[a.indexOf(f[2])]:d+="px"}return this.height=this._fontSize,this.font=d+" "+e.join(","),this.isDirty=!0,this},setText:function(a){return a=void 0===a?"":Array.isArray(a)?a.join("\n"):a.toString(),this._text!==a&&(this._text=a,this.isDirty=!0),this},measureText:function(a,b,d){b=b||this._text;var e;e=void 0===a?me.video.renderer.getFontContext():a instanceof me.Renderer?a.getFontContext():a;var f=d||this.getBounds(),g=this._fontSize*this.lineHeight,h=(""+b).split("\n");e.save(),c(e,this),this.height=this.width=0;for(var i=0;i<h.length;i++)this.width=Math.max(e.measureText(me.utils.string.trimRight(h[i])).width,this.width),this.height+=g;return f.width=Math.ceil(this.width),f.height=Math.ceil(this.height),f.pos.x=Math.floor("right"===this.textAlign?this.pos.x-this.width:"center"===this.textAlign?this.pos.x-this.width/2:this.pos.x),f.pos.y=Math.floor(0===this.textBaseline.search(/^(top|hanging)$/)?this.pos.y:"middle"===this.textBaseline?this.pos.y-f.height/2:this.pos.y-f.height),e.restore(),f},update:function(){return!0===this.isDirty&&this.measureText(),this.isDirty},draw:function(a,b,c,d,e){void 0===this.ancestor?(this.setText(b),this.pos.x===c&&this.pos.y===d||(this.pos.x=c,this.pos.y=d,this.isDirty=!0),this.update(0),a.save(),a.setGlobalAlpha(a.globalAlpha()*this.getOpacity())):(c=this.pos.x,d=this.pos.y),!1===a.settings.subPixel&&(c=~~c,d=~~d),a.drawFont(this._drawFont(a.getFontContext(),this._text,c,d,e||!1)),void 0===this.ancestor&&a.restore(),this.isDirty=!1},drawStroke:function(a,b,c,d){this.draw.call(this,a,b,c,d,!0)},_drawFont:function(a,b,d,e,f){c(a,this,f);for(var g=(""+b).split("\n"),h=this._fontSize*this.lineHeight,i=0;i<g.length;i++){var j=me.utils.string.trimRight(g[i]);a[f?"strokeText":"fillText"](j,d,e),e+=h}return this.getBounds()},destroy:function(){me.pool.push(this.fillStyle),me.pool.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,me.Renderable.prototype.destroy.apply(this)}})}(),function(){var a=function(a,b){for(var c=b.split(""),d=0,e=null,f=0;f<c.length;f++){var g=c[f].charCodeAt(0),h=a.fontData.glyphs[g],i=e&&e.kerning?e.getKerning(g):0;d+=(h.xadvance+i)*a.fontScale.x,e=h}return d},b=function(a){return a.fontData.capHeight*a.lineHeight*a.fontScale.y};me.BitmapText=me.Renderable.extend({init:function(a,b,c){me.Renderable.prototype.init.apply(this,[a,b,c.width||0,c.height||0]),this.textAlign=c.textAlign||"left",this.textBaseline=c.textBaseline||"top",this.lineHeight=c.lineHeight||1,this.fontScale=me.pool.pull("me.Vector2d",1,1),this.fontImage="object"===_typeof(c.font)?c.font:me.loader.getImage(c.font),"string"!=typeof c.fontData?this.fontData=me.pool.pull("me.BitmapTextData",me.loader.getBinary(c.font)):this.fontData=me.pool.pull("me.BitmapTextData",c.fontData.includes("info face")?c.fontData:me.loader.getBinary(c.fontData)),void 0!==c.floating&&(this.floating=!!c.floating),"number"==typeof c.size&&1!==c.size&&this.resize(c.size),void 0!==c.anchorPoint?this.anchorPoint.set(c.anchorPoint.x,c.anchorPoint.y):this.anchorPoint.set(0,0),this.setText(c.text)},set:function(a,b){return this.textAlign=a,b&&this.resize(b),this.isDirty=!0,this},setText:function(a){return a=void 0===a?"":Array.isArray(a)?a.join("\n"):a.toString(),this._text!==a&&(this._text=a,this.isDirty=!0),this},resize:function(a){return this.fontScale.set(a,a),this.isDirty=!0,this},measureText:function(c,d){c=c||this._text;var e=(""+c).split("\n"),f=b(this),g=d||this.getBounds();g.height=g.width=0;for(var h=0;h<e.length;h++)g.width=Math.max(a(this,e[h]),g.width),g.height+=f;return g},update:function(){return!0===this.isDirty&&this.measureText(),this.isDirty},draw:function(c,d,e,f){if(void 0===this.ancestor){this.setText(d),this.update(0);var g=c.globalAlpha();c.setGlobalAlpha(g*this.getOpacity())}else e=this.pos.x,f=this.pos.y;for(var h=(""+this._text).split("\n"),i=e,j=b(this),k=0,l=0;l<h.length;l++){e=i;var m=me.utils.string.trimRight(h[l]),n=a(this,m);switch(this.textAlign){case"right":e-=n;break;case"center":e-=.5*n}switch(this.textBaseline){case"middle":f-=.5*j;break;case"ideographic":case"alphabetic":case"bottom":f-=j}!0===this.isDirty&&void 0===this.ancestor&&(0===l&&(this.pos.y=f),k<n&&(k=n,this.pos.x=e));for(var o=null,p=0,q=m.length;p<q;p++){var r=m.charCodeAt(p),s=this.fontData.glyphs[r],t=s.width,u=s.height,v=o&&o.kerning?o.getKerning(r):0;0!==t&&0!==u&&c.drawImage(this.fontImage,s.x,s.y,t,u,e+s.xoffset,f+s.yoffset*this.fontScale.y,t*this.fontScale.x,u*this.fontScale.y),e+=(s.xadvance+v)*this.fontScale.x,o=s}f+=j}void 0===this.ancestor&&c.setGlobalAlpha(g),this.isDirty=!1},destroy:function(){me.pool.push(this.fontScale),this.fontScale=void 0,me.pool.push(this.fontData),this.fontData=void 0,me.Renderable.prototype.destroy.apply(this)}})}(),function(){var a=["x","e","a","o","n","s","r","c","u","m","v","w","z"],b=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"],c=me.Object.extend({init:function(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1},getKerning:function(a){if(this.kerning){var b=this.kerning[a>>>9];if(b)return b[511&a]||0}return 0},setKerning:function(a,b){this.kerning||(this.kerning={});var c=this.kerning[a>>>9];void 0===c&&(this.kerning[a>>>9]={},c=this.kerning[a>>>9]),c[511&a]=b}});me.BitmapTextData=me.Object.extend({init:function(a){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(a)},_createSpaceGlyph:function(){var a=" ".charCodeAt(0),b=this.glyphs[a];b||(b=new c,b.id=a,b.xadvance=this._getFirstGlyph().xadvance,this.glyphs[a]=b)},_getFirstGlyph:function(){for(var a=Object.keys(this.glyphs),b=0;b<a.length;b++)if(a[b]>32)return this.glyphs[a[b]];return null},_getValueFromPair:function(a,b){var c=a.match(b);if(!c)throw new Error("Could not find pattern "+b+" in string: "+a);return c[0].split("=")[1]},parse:function(d){if(!d)throw new Error("File containing font data was empty, cannot load the bitmap font.");var e=d.split(/\r\n|\n/),f=d.match(/padding\=\d+,\d+,\d+,\d+/g);if(!f)throw new Error("Padding not found in first line");var g=f[0].split("=")[1].split(",");this.padTop=parseFloat(g[0]),this.padLeft=parseFloat(g[1]),this.padBottom=parseFloat(g[2]),this.padRight=parseFloat(g[3]),this.lineHeight=parseFloat(this._getValueFromPair(e[1],/lineHeight\=\d+/g));for(var h=parseFloat(this._getValueFromPair(e[1],/base\=\d+/g)),i=this.padTop+this.padBottom,j=null,k=4;k<e.length;k++){var l=e[k],m=l.split(/=|\s+/);if(l&&!/^kernings/.test(l))if(/^kerning\s/.test(l)){var n=parseFloat(m[2]),o=parseFloat(m[4]),p=parseFloat(m[6]);j=this.glyphs[n],null!==j&&void 0!==j&&j.setKerning(o,p)}else{j=new c;var q=parseFloat(m[2]);j.id=q,j.x=parseFloat(m[4]),j.y=parseFloat(m[6]),j.width=parseFloat(m[8]),j.height=parseFloat(m[10]),j.xoffset=parseFloat(m[12]),j.yoffset=parseFloat(m[14]),j.xadvance=parseFloat(m[16]),j.width>0&&j.height>0&&(this.descent=Math.min(h+j.yoffset,this.descent)),this.glyphs[q]=j}}this.descent+=this.padBottom,this._createSpaceGlyph();var r=null;for(k=0;k<a.length;k++){var s=a[k];if(r=this.glyphs[s.charCodeAt(0)])break}r||(r=this._getFirstGlyph());var t=null;for(k=0;k<b.length;k++){var u=b[k];if(t=this.glyphs[u.charCodeAt(0)])break}if(t)this.capHeight=t.height;else for(var v in this.glyphs)if(this.glyphs.hasOwnProperty(v)){if(j=this.glyphs[v],0===j.height||0===j.width)continue;this.capHeight=Math.max(this.capHeight,j.height)}this.capHeight-=i}})}();var howler=createCommonjsModule(function(a,b){!function(){var a=function(){this.init()};a.prototype={init:function(){var a=this||c;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var b=this||c;if(a=parseFloat(a),b.ctx||k(),void 0!==a&&a>=0&&a<=1){if(b._volume=a,b._muted)return b;b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a,c.ctx.currentTime);for(var d=0;d<b._howls.length;d++)if(!b._howls[d]._webAudio)for(var e=b._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=b._howls[d]._soundById(e[f]);g&&g._node&&(g._node.volume=g._volume*a)}return b}return b._volume},mute:function(a){var b=this||c;b.ctx||k(),b._muted=a,b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a?0:b._volume,c.ctx.currentTime);for(var d=0;d<b._howls.length;d++)if(!b._howls[d]._webAudio)for(var e=b._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=b._howls[d]._soundById(e[f]);g&&g._node&&(g._node.muted=!!a||g._muted)}return b},unload:function(){for(var a=this||c,b=a._howls.length-1;b>=0;b--)a._howls[b].unload();return a.usingWebAudio&&a.ctx&&void 0!==a.ctx.close&&(a.ctx.close(),a.ctx=null,k()),a},codecs:function(a){return(this||c)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||c;if(a.state=a.ctx?a.ctx.state||"suspended":"suspended",a._autoSuspend(),!a.usingWebAudio)if("undefined"!=typeof Audio)try{var b=new Audio;void 0===b.oncanplaythrough&&(a._canPlayEvent="canplay")}catch(b){a.noAudio=!0}else a.noAudio=!0;try{var b=new Audio;b.muted&&(a.noAudio=!0)}catch(a){}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||c,b=null;try{b="undefined"!=typeof Audio?new Audio:null}catch(b){return a}if(!b||"function"!=typeof b.canPlayType)return a;var d=b.canPlayType("audio/mpeg;").replace(/^no$/,""),e=a._navigator&&a._navigator.userAgent.match(/OPR\/([0-6].)/g),f=e&&parseInt(e[0].split("/")[1],10)<33;return a._codecs={mp3:!(f||!d&&!b.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!d,opus:!!b.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!b.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!b.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(b.canPlayType("audio/x-mp4;")||b.canPlayType("audio/mp4;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!b.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!b.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!b.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(b.canPlayType("audio/x-flac;")||b.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||c;if(!a._audioUnlocked&&a.ctx){a._audioUnlocked=!1,a.autoUnlock=!1,a._mobileUnloaded||44100===a.ctx.sampleRate||(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var b=function(c){for(var d=0;d<a.html5PoolSize;d++)try{var e=new Audio;e._unlocked=!0,a._releaseHtml5Audio(e)}catch(c){a.noAudio=!0}for(var d=0;d<a._howls.length;d++)if(!a._howls[d]._webAudio)for(var f=a._howls[d]._getSoundIds(),g=0;g<f.length;g++){var h=a._howls[d]._soundById(f[g]);h&&h._node&&!h._node._unlocked&&(h._node._unlocked=!0,h._node.load())}a._autoResume();var i=a.ctx.createBufferSource();i.buffer=a._scratchBuffer,i.connect(a.ctx.destination),void 0===i.start?i.noteOn(0):i.start(0),"function"==typeof a.ctx.resume&&a.ctx.resume(),i.onended=function(){i.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",b,!0),document.removeEventListener("touchend",b,!0),document.removeEventListener("click",b,!0);for(var c=0;c<a._howls.length;c++)a._howls[c]._emit("unlock")}};return document.addEventListener("touchstart",b,!0),document.addEventListener("touchend",b,!0),document.addEventListener("click",b,!0),a}},_obtainHtml5Audio:function(){var a=this||c;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var b=(new Audio).play();return b&&"undefined"!=typeof Promise&&(b instanceof Promise||"function"==typeof b.then)&&b.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var b=this||c;return a._unlocked&&b._html5AudioPool.push(a),b},_autoSuspend:function(){var a=this;if(a.autoSuspend&&a.ctx&&void 0!==a.ctx.suspend&&c.usingWebAudio){for(var b=0;b<a._howls.length;b++)if(a._howls[b]._webAudio)for(var d=0;d<a._howls[b]._sounds.length;d++)if(!a._howls[b]._sounds[d]._paused)return a;return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){a.autoSuspend&&(a._suspendTimer=null,a.state="suspending",a.ctx.suspend().then(function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())}))},3e4),a}},_autoResume:function(){var a=this;if(a.ctx&&void 0!==a.ctx.resume&&c.usingWebAudio)return"running"===a.state&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):"suspended"===a.state?(a.ctx.resume().then(function(){a.state="running";for(var b=0;b<a._howls.length;b++)a._howls[b]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):"suspending"===a.state&&(a._resumeAfterSuspend=!0),a}};var c=new a,d=function(a){var b=this;if(!a.src||0===a.src.length)return void console.error("An array of source files must be passed with any new Howl.");b.init(a)};d.prototype={init:function(a){var b=this;return c.ctx||k(),b._autoplay=a.autoplay||!1,b._format="string"!=typeof a.format?a.format:[a.format],b._html5=a.html5||!1,b._muted=a.mute||!1,b._loop=a.loop||!1,b._pool=a.pool||5,b._preload="boolean"!=typeof a.preload||a.preload,b._rate=a.rate||1,b._sprite=a.sprite||{},b._src="string"!=typeof a.src?a.src:[a.src],b._volume=void 0!==a.volume?a.volume:1,b._xhrWithCredentials=a.xhrWithCredentials||!1,b._duration=0,b._state="unloaded",b._sounds=[],b._endTimers={},b._queue=[],b._playLock=!1,b._onend=a.onend?[{fn:a.onend}]:[],b._onfade=a.onfade?[{fn:a.onfade}]:[],b._onload=a.onload?[{fn:a.onload}]:[],b._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],b._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],b._onpause=a.onpause?[{fn:a.onpause}]:[],b._onplay=a.onplay?[{fn:a.onplay}]:[],b._onstop=a.onstop?[{fn:a.onstop}]:[],b._onmute=a.onmute?[{fn:a.onmute}]:[],b._onvolume=a.onvolume?[{fn:a.onvolume}]:[],b._onrate=a.onrate?[{fn:a.onrate}]:[],b._onseek=a.onseek?[{fn:a.onseek}]:[],b._onunlock=a.onunlock?[{fn:a.onunlock}]:[],b._onresume=[],b._webAudio=c.usingWebAudio&&!b._html5,void 0!==c.ctx&&c.ctx&&c.autoUnlock&&c._unlockAudio(),c._howls.push(b),b._autoplay&&b._queue.push({event:"play",action:function(){b.play()}}),b._preload&&b.load(),b},load:function(){var a=this,b=null;if(c.noAudio)return void a._emit("loaderror",null,"No audio support.");"string"==typeof a._src&&(a._src=[a._src]);for(var d=0;d<a._src.length;d++){var f,h;if(a._format&&a._format[d])f=a._format[d];else{if("string"!=typeof(h=a._src[d])){a._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(h),f||(f=/\.([^.]+)$/.exec(h.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&c.codecs(f)){b=a._src[d];break}}return b?(a._src=b,a._state="loading","https:"===window.location.protocol&&"http:"===b.slice(0,5)&&(a._html5=!0,a._webAudio=!1),new e(a),a._webAudio&&g(a),a):void a._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(a,b){var d=this,e=null;if("number"==typeof a)e=a,a=null;else{if("string"==typeof a&&"loaded"===d._state&&!d._sprite[a])return null;if(void 0===a&&(a="__default",!d._playLock)){for(var f=0,g=0;g<d._sounds.length;g++)d._sounds[g]._paused&&!d._sounds[g]._ended&&(f++,e=d._sounds[g]._id);1===f?a=null:e=null}}var h=e?d._soundById(e):d._inactiveSound();if(!h)return null;if(e&&!a&&(a=h._sprite||"__default"),"loaded"!==d._state){h._sprite=a,h._ended=!1;var i=h._id;return d._queue.push({event:"play",action:function(){d.play(i)}}),i}if(e&&!h._paused)return b||d._loadQueue("play"),h._id;d._webAudio&&c._autoResume();var j=Math.max(0,h._seek>0?h._seek:d._sprite[a][0]/1e3),k=Math.max(0,(d._sprite[a][0]+d._sprite[a][1])/1e3-j),l=1e3*k/Math.abs(h._rate),m=d._sprite[a][0]/1e3,n=(d._sprite[a][0]+d._sprite[a][1])/1e3,o=!(!h._loop&&!d._sprite[a][2]);h._sprite=a,h._ended=!1;var p=function(){h._paused=!1,h._seek=j,h._start=m,h._stop=n,h._loop=o};if(j>=n)return void d._ended(h);var q=h._node;if(d._webAudio){var r=function(){d._playLock=!1,p(),d._refreshBuffer(h);var a=h._muted||d._muted?0:h._volume;q.gain.setValueAtTime(a,c.ctx.currentTime),h._playStart=c.ctx.currentTime,void 0===q.bufferSource.start?h._loop?q.bufferSource.noteGrainOn(0,j,86400):q.bufferSource.noteGrainOn(0,j,k):h._loop?q.bufferSource.start(0,j,86400):q.bufferSource.start(0,j,k),l!==1/0&&(d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),l)),b||setTimeout(function(){d._emit("play",h._id),d._loadQueue()},0)};"running"===c.state?r():(d._playLock=!0,d.once("resume",r),d._clearTimer(h._id))}else{var s=function(){q.currentTime=j,q.muted=h._muted||d._muted||c._muted||q.muted,q.volume=h._volume*c.volume(),q.playbackRate=h._rate;try{var e=q.play();if(e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)?(d._playLock=!0,p(),e.then(function(){d._playLock=!1,q._unlocked=!0,b||(d._emit("play",h._id),d._loadQueue())}).catch(function(){d._playLock=!1,d._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),h._ended=!0,h._paused=!0})):b||(d._playLock=!1,p(),d._emit("play",h._id),d._loadQueue()),q.playbackRate=h._rate,q.paused)return void d._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==a||h._loop?d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),l):(d._endTimers[h._id]=function(){d._ended(h),q.removeEventListener("ended",d._endTimers[h._id],!1)},q.addEventListener("ended",d._endTimers[h._id],!1))}catch(a){d._emit("playerror",h._id,a)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===q.src&&(q.src=d._src,q.load());var t=window&&window.ejecta||!q.readyState&&c._navigator.isCocoonJS;if(q.readyState>=3||t)s();else{d._playLock=!0;var u=function(){s(),q.removeEventListener(c._canPlayEvent,u,!1)};q.addEventListener(c._canPlayEvent,u,!1),d._clearTimer(h._id)}}return h._id},pause:function(a){var b=this;if("loaded"!==b._state||b._playLock)return b._queue.push({event:"pause",action:function(){b.pause(a)}}),b;for(var c=b._getSoundIds(a),d=0;d<c.length;d++){b._clearTimer(c[d]);var e=b._soundById(c[d]);if(e&&!e._paused&&(e._seek=b.seek(c[d]),e._rateSeek=0,e._paused=!0,b._stopFade(c[d]),e._node))if(b._webAudio){if(!e._node.bufferSource)continue;void 0===e._node.bufferSource.stop?e._node.bufferSource.noteOff(0):e._node.bufferSource.stop(0),b._cleanBuffer(e._node)}else isNaN(e._node.duration)&&e._node.duration!==1/0||e._node.pause();arguments[1]||b._emit("pause",e?e._id:null)}return b},stop:function(a,b){var c=this;if("loaded"!==c._state||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),c;for(var d=c._getSoundIds(a),e=0;e<d.length;e++){c._clearTimer(d[e]);var f=c._soundById(d[e]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,c._stopFade(d[e]),f._node&&(c._webAudio?f._node.bufferSource&&(void 0===f._node.bufferSource.stop?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),c._cleanBuffer(f._node)):isNaN(f._node.duration)&&f._node.duration!==1/0||(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&c._clearSound(f._node))),b||c._emit("stop",f._id))}return c},mute:function(a,b){var d=this;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(a,b)}}),d;if(void 0===b){if("boolean"!=typeof a)return d._muted;d._muted=a}for(var e=d._getSoundIds(b),f=0;f<e.length;f++){var g=d._soundById(e[f]);g&&(g._muted=a,g._interval&&d._stopFade(g._id),d._webAudio&&g._node?g._node.gain.setValueAtTime(a?0:g._volume,c.ctx.currentTime):g._node&&(g._node.muted=!!c._muted||a),d._emit("mute",g._id))}return d},volume:function(){var a,b,d=this,e=arguments;if(0===e.length)return d._volume;if(1===e.length||2===e.length&&void 0===e[1]){d._getSoundIds().indexOf(e[0])>=0?b=parseInt(e[0],10):a=parseFloat(e[0])}else e.length>=2&&(a=parseFloat(e[0]),b=parseInt(e[1],10));var f;if(!(void 0!==a&&a>=0&&a<=1))return f=b?d._soundById(b):d._sounds[0],f?f._volume:0;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"volume",action:function(){d.volume.apply(d,e)}}),d;void 0===b&&(d._volume=a),b=d._getSoundIds(b);for(var g=0;g<b.length;g++)(f=d._soundById(b[g]))&&(f._volume=a,e[2]||d._stopFade(b[g]),d._webAudio&&f._node&&!f._muted?f._node.gain.setValueAtTime(a,c.ctx.currentTime):f._node&&!f._muted&&(f._node.volume=a*c.volume()),d._emit("volume",f._id));return d},fade:function(a,b,d,e){var f=this;if("loaded"!==f._state||f._playLock)return f._queue.push({event:"fade",action:function(){f.fade(a,b,d,e)}}),f;a=parseFloat(a),b=parseFloat(b),d=parseFloat(d),f.volume(a,e);for(var g=f._getSoundIds(e),h=0;h<g.length;h++){var i=f._soundById(g[h]);if(i){if(e||f._stopFade(g[h]),f._webAudio&&!i._muted){var j=c.ctx.currentTime,k=j+d/1e3;i._volume=a,i._node.gain.setValueAtTime(a,j),i._node.gain.linearRampToValueAtTime(b,k)}f._startFadeInterval(i,a,b,d,g[h],void 0===e)}}return f},_startFadeInterval:function(a,b,c,d,e,f){var g=this,h=b,i=c-b,j=Math.abs(i/.01),k=Math.max(4,j>0?d/j:d),l=Date.now();a._fadeTo=c,a._interval=setInterval(function(){var e=(Date.now()-l)/d;l=Date.now(),h+=i*e,h=Math.max(0,h),h=Math.min(1,h),h=Math.round(100*h)/100,g._webAudio?a._volume=h:g.volume(h,a._id,!0),f&&(g._volume=h),(c<b&&h<=c||c>b&&h>=c)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,g.volume(c,a._id),g._emit("fade",a._id))},k)},_stopFade:function(a){var b=this,d=b._soundById(a);return d&&d._interval&&(b._webAudio&&d._node.gain.cancelScheduledValues(c.ctx.currentTime),clearInterval(d._interval),d._interval=null,b.volume(d._fadeTo,a),d._fadeTo=null,b._emit("fade",a)),b},loop:function(){var a,b,c,d=this,e=arguments;if(0===e.length)return d._loop;if(1===e.length){
if("boolean"!=typeof e[0])return!!(c=d._soundById(parseInt(e[0],10)))&&c._loop;a=e[0],d._loop=a}else 2===e.length&&(a=e[0],b=parseInt(e[1],10));for(var f=d._getSoundIds(b),g=0;g<f.length;g++)(c=d._soundById(f[g]))&&(c._loop=a,d._webAudio&&c._node&&c._node.bufferSource&&(c._node.bufferSource.loop=a,a&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop)));return d},rate:function(){var a,b,d=this,e=arguments;if(0===e.length)b=d._sounds[0]._id;else if(1===e.length){var f=d._getSoundIds(),g=f.indexOf(e[0]);g>=0?b=parseInt(e[0],10):a=parseFloat(e[0])}else 2===e.length&&(a=parseFloat(e[0]),b=parseInt(e[1],10));var h;if("number"!=typeof a)return h=d._soundById(b),h?h._rate:d._rate;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"rate",action:function(){d.rate.apply(d,e)}}),d;void 0===b&&(d._rate=a),b=d._getSoundIds(b);for(var i=0;i<b.length;i++)if(h=d._soundById(b[i])){d.playing(b[i])&&(h._rateSeek=d.seek(b[i]),h._playStart=d._webAudio?c.ctx.currentTime:h._playStart),h._rate=a,d._webAudio&&h._node&&h._node.bufferSource?h._node.bufferSource.playbackRate.setValueAtTime(a,c.ctx.currentTime):h._node&&(h._node.playbackRate=a);var j=d.seek(b[i]),k=(d._sprite[h._sprite][0]+d._sprite[h._sprite][1])/1e3-j,l=1e3*k/Math.abs(h._rate);!d._endTimers[b[i]]&&h._paused||(d._clearTimer(b[i]),d._endTimers[b[i]]=setTimeout(d._ended.bind(d,h),l)),d._emit("rate",h._id)}return d},seek:function(){var a,b,d=this,e=arguments;if(0===e.length)b=d._sounds[0]._id;else if(1===e.length){var f=d._getSoundIds(),g=f.indexOf(e[0]);g>=0?b=parseInt(e[0],10):d._sounds.length&&(b=d._sounds[0]._id,a=parseFloat(e[0]))}else 2===e.length&&(a=parseFloat(e[0]),b=parseInt(e[1],10));if(void 0===b)return d;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"seek",action:function(){d.seek.apply(d,e)}}),d;var h=d._soundById(b);if(h){if(!("number"==typeof a&&a>=0)){if(d._webAudio){var i=d.playing(b)?c.ctx.currentTime-h._playStart:0,j=h._rateSeek?h._rateSeek-h._seek:0;return h._seek+(j+i*Math.abs(h._rate))}return h._node.currentTime}var k=d.playing(b);k&&d.pause(b,!0),h._seek=a,h._ended=!1,d._clearTimer(b),d._webAudio||!h._node||isNaN(h._node.duration)||(h._node.currentTime=a);var l=function(){d._emit("seek",b),k&&d.play(b,!0)};if(k&&!d._webAudio){var m=function(){d._playLock?setTimeout(m,0):l()};setTimeout(m,0)}else l()}return d},playing:function(a){var b=this;if("number"==typeof a){var c=b._soundById(a);return!!c&&!c._paused}for(var d=0;d<b._sounds.length;d++)if(!b._sounds[d]._paused)return!0;return!1},duration:function(a){var b=this,c=b._duration,d=b._soundById(a);return d&&(c=b._sprite[d._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var a=this,b=a._sounds,d=0;d<b.length;d++)b[d]._paused||a.stop(b[d]._id),a._webAudio||(a._clearSound(b[d]._node),b[d]._node.removeEventListener("error",b[d]._errorFn,!1),b[d]._node.removeEventListener(c._canPlayEvent,b[d]._loadFn,!1),c._releaseHtml5Audio(b[d]._node)),delete b[d]._node,a._clearTimer(b[d]._id);var e=c._howls.indexOf(a);e>=0&&c._howls.splice(e,1);var g=!0;for(d=0;d<c._howls.length;d++)if(c._howls[d]._src===a._src||a._src.indexOf(c._howls[d]._src)>=0){g=!1;break}return f&&g&&delete f[a._src],c.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,b,c,d){var e=this,f=e["_on"+a];return"function"==typeof b&&f.push(d?{id:c,fn:b,once:d}:{id:c,fn:b}),e},off:function(a,b,c){var d=this,e=d["_on"+a],f=0;if("number"==typeof b&&(c=b,b=null),b||c)for(f=0;f<e.length;f++){var g=c===e[f].id;if(b===e[f].fn&&g||!b&&g){e.splice(f,1);break}}else if(a)d["_on"+a]=[];else{var h=Object.keys(d);for(f=0;f<h.length;f++)0===h[f].indexOf("_on")&&Array.isArray(d[h[f]])&&(d[h[f]]=[])}return d},once:function(a,b,c){var d=this;return d.on(a,b,c,1),d},_emit:function(a,b,c){for(var d=this,e=d["_on"+a],f=e.length-1;f>=0;f--)e[f].id&&e[f].id!==b&&"load"!==a||(setTimeout(function(a){a.call(this,b,c)}.bind(d,e[f].fn),0),e[f].once&&d.off(a,e[f].fn,e[f].id));return d._loadQueue(a),d},_loadQueue:function(a){var b=this;if(b._queue.length>0){var c=b._queue[0];c.event===a&&(b._queue.shift(),b._loadQueue()),a||c.action()}return b},_ended:function(a){var b=this,d=a._sprite;if(!b._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(b._ended.bind(b,a),100),b;var e=!(!a._loop&&!b._sprite[d][2]);if(b._emit("end",a._id),!b._webAudio&&e&&b.stop(a._id,!0).play(a._id),b._webAudio&&e){b._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=c.ctx.currentTime;var f=1e3*(a._stop-a._start)/Math.abs(a._rate);b._endTimers[a._id]=setTimeout(b._ended.bind(b,a),f)}return b._webAudio&&!e&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,b._clearTimer(a._id),b._cleanBuffer(a._node),c._autoSuspend()),b._webAudio||e||b.stop(a._id,!0),b},_clearTimer:function(a){var b=this;if(b._endTimers[a]){if("function"!=typeof b._endTimers[a])clearTimeout(b._endTimers[a]);else{var c=b._soundById(a);c&&c._node&&c._node.removeEventListener("ended",b._endTimers[a],!1)}delete b._endTimers[a]}return b},_soundById:function(a){for(var b=this,c=0;c<b._sounds.length;c++)if(a===b._sounds[c]._id)return b._sounds[c];return null},_inactiveSound:function(){var a=this;a._drain();for(var b=0;b<a._sounds.length;b++)if(a._sounds[b]._ended)return a._sounds[b].reset();return new e(a)},_drain:function(){var a=this,b=a._pool,c=0,d=0;if(!(a._sounds.length<b)){for(d=0;d<a._sounds.length;d++)a._sounds[d]._ended&&c++;for(d=a._sounds.length-1;d>=0;d--){if(c<=b)return;a._sounds[d]._ended&&(a._webAudio&&a._sounds[d]._node&&a._sounds[d]._node.disconnect(0),a._sounds.splice(d,1),c--)}}},_getSoundIds:function(a){var b=this;if(void 0===a){for(var c=[],d=0;d<b._sounds.length;d++)c.push(b._sounds[d]._id);return c}return[a]},_refreshBuffer:function(a){var b=this;return a._node.bufferSource=c.ctx.createBufferSource(),a._node.bufferSource.buffer=f[b._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,c.ctx.currentTime),b},_cleanBuffer:function(a){var b=this,d=c._navigator&&c._navigator.vendor.indexOf("Apple")>=0;if(c._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),d))try{a.bufferSource.buffer=c._scratchBuffer}catch(a){}return a.bufferSource=null,b},_clearSound:function(a){/MSIE |Trident\//.test(c._navigator&&c._navigator.userAgent)||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var e=function(a){this._parent=a,this.init()};e.prototype={init:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._rate=b._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++c._counter,b._sounds.push(a),a.create(),a},create:function(){var a=this,b=a._parent,d=c._muted||a._muted||a._parent._muted?0:a._volume;return b._webAudio?(a._node=void 0===c.ctx.createGain?c.ctx.createGainNode():c.ctx.createGain(),a._node.gain.setValueAtTime(d,c.ctx.currentTime),a._node.paused=!0,a._node.connect(c.masterGain)):(a._node=c._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(c._canPlayEvent,a._loadFn,!1),a._node.src=b._src,a._node.preload="auto",a._node.volume=d*c.volume(),a._node.load()),a},reset:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._rate=b._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++c._counter,a},_errorListener:function(){var a=this;a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorFn,!1)},_loadListener:function(){var a=this,b=a._parent;b._duration=Math.ceil(10*a._node.duration)/10,0===Object.keys(b._sprite).length&&(b._sprite={__default:[0,1e3*b._duration]}),"loaded"!==b._state&&(b._state="loaded",b._emit("load"),b._loadQueue()),a._node.removeEventListener(c._canPlayEvent,a._loadFn,!1)}};var f={},g=function(a){var b=a._src;if(f[b])return a._duration=f[b].duration,void j(a);if(/^data:[^;]+;base64,/.test(b)){for(var c=atob(b.split(",")[1]),d=new Uint8Array(c.length),e=0;e<c.length;++e)d[e]=c.charCodeAt(e);i(d.buffer,a)}else{var g=new XMLHttpRequest;g.open("GET",b,!0),g.withCredentials=a._xhrWithCredentials,g.responseType="arraybuffer",g.onload=function(){var b=(g.status+"")[0];if("0"!==b&&"2"!==b&&"3"!==b)return void a._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");i(g.response,a)},g.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete f[b],a.load())},h(g)}},h=function(a){try{a.send()}catch(b){a.onerror()}},i=function(a,b){var d=function(){b._emit("loaderror",null,"Decoding audio data failed.")},e=function(a){a&&b._sounds.length>0?(f[b._src]=a,j(b,a)):d()};"undefined"!=typeof Promise&&1===c.ctx.decodeAudioData.length?c.ctx.decodeAudioData(a).then(e).catch(d):c.ctx.decodeAudioData(a,e,d)},j=function(a,b){b&&!a._duration&&(a._duration=b.duration),0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1e3*a._duration]}),"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue())},k=function(){if(c.usingWebAudio){try{"undefined"!=typeof AudioContext?c.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?c.ctx=new webkitAudioContext:c.usingWebAudio=!1}catch(a){c.usingWebAudio=!1}c.ctx||(c.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(c._navigator&&c._navigator.platform),b=c._navigator&&c._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=b?parseInt(b[1],10):null;if(a&&d&&d<9){var e=/safari/.test(c._navigator&&c._navigator.userAgent.toLowerCase());(c._navigator&&c._navigator.standalone&&!e||c._navigator&&!c._navigator.standalone&&!e)&&(c.usingWebAudio=!1)}c.usingWebAudio&&(c.masterGain=void 0===c.ctx.createGain?c.ctx.createGainNode():c.ctx.createGain(),c.masterGain.gain.setValueAtTime(c._muted?0:1,c.ctx.currentTime),c.masterGain.connect(c.ctx.destination)),c._setup()}};b.Howler=c,b.Howl=d,"undefined"!=typeof window?(window.HowlerGlobal=a,window.Howler=c,window.Howl=d,window.Sound=e):void 0!==commonjsGlobal&&(commonjsGlobal.HowlerGlobal=a,commonjsGlobal.Howler=c,commonjsGlobal.Howl=d,commonjsGlobal.Sound=e)}(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(a){var b=this;if(!b.ctx||!b.ctx.listener)return b;for(var c=b._howls.length-1;c>=0;c--)b._howls[c].stereo(a);return b},HowlerGlobal.prototype.pos=function(a,b,c){var d=this;return d.ctx&&d.ctx.listener?(b="number"!=typeof b?d._pos[1]:b,c="number"!=typeof c?d._pos[2]:c,"number"!=typeof a?d._pos:(d._pos=[a,b,c],void 0!==d.ctx.listener.positionX?(d.ctx.listener.positionX.setTargetAtTime(d._pos[0],Howler.ctx.currentTime,.1),d.ctx.listener.positionY.setTargetAtTime(d._pos[1],Howler.ctx.currentTime,.1),d.ctx.listener.positionZ.setTargetAtTime(d._pos[2],Howler.ctx.currentTime,.1)):d.ctx.listener.setPosition(d._pos[0],d._pos[1],d._pos[2]),d)):d},HowlerGlobal.prototype.orientation=function(a,b,c,d,e,f){var g=this;if(!g.ctx||!g.ctx.listener)return g;var h=g._orientation;return b="number"!=typeof b?h[1]:b,c="number"!=typeof c?h[2]:c,d="number"!=typeof d?h[3]:d,e="number"!=typeof e?h[4]:e,f="number"!=typeof f?h[5]:f,"number"!=typeof a?h:(g._orientation=[a,b,c,d,e,f],void 0!==g.ctx.listener.forwardX?(g.ctx.listener.forwardX.setTargetAtTime(a,Howler.ctx.currentTime,.1),g.ctx.listener.forwardY.setTargetAtTime(b,Howler.ctx.currentTime,.1),g.ctx.listener.forwardZ.setTargetAtTime(c,Howler.ctx.currentTime,.1),g.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),g.ctx.listener.upY.setTargetAtTime(b,Howler.ctx.currentTime,.1),g.ctx.listener.upZ.setTargetAtTime(c,Howler.ctx.currentTime,.1)):g.ctx.listener.setOrientation(a,b,c,d,e,f),g)},Howl.prototype.init=function(a){return function(b){var c=this;return c._orientation=b.orientation||[1,0,0],c._stereo=b.stereo||null,c._pos=b.pos||null,c._pannerAttr={coneInnerAngle:void 0!==b.coneInnerAngle?b.coneInnerAngle:360,coneOuterAngle:void 0!==b.coneOuterAngle?b.coneOuterAngle:360,coneOuterGain:void 0!==b.coneOuterGain?b.coneOuterGain:0,distanceModel:void 0!==b.distanceModel?b.distanceModel:"inverse",maxDistance:void 0!==b.maxDistance?b.maxDistance:1e4,panningModel:void 0!==b.panningModel?b.panningModel:"HRTF",refDistance:void 0!==b.refDistance?b.refDistance:1,rolloffFactor:void 0!==b.rolloffFactor?b.rolloffFactor:1},c._onstereo=b.onstereo?[{fn:b.onstereo}]:[],c._onpos=b.onpos?[{fn:b.onpos}]:[],c._onorientation=b.onorientation?[{fn:b.onorientation}]:[],a.call(this,b)}}(Howl.prototype.init),Howl.prototype.stereo=function(b,c){var d=this;if(!d._webAudio)return d;if("loaded"!==d._state)return d._queue.push({event:"stereo",action:function(){d.stereo(b,c)}}),d;var e=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===c){if("number"!=typeof b)return d._stereo;d._stereo=b,d._pos=[b,0,0]}for(var f=d._getSoundIds(c),g=0;g<f.length;g++){var h=d._soundById(f[g]);if(h){if("number"!=typeof b)return h._stereo;h._stereo=b,h._pos=[b,0,0],h._node&&(h._pannerAttr.panningModel="equalpower",h._panner&&h._panner.pan||a(h,e),"spatial"===e?void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(b,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):h._panner.setPosition(b,0,0):h._panner.pan.setValueAtTime(b,Howler.ctx.currentTime)),d._emit("stereo",h._id)}}return d},Howl.prototype.pos=function(b,c,d,e){var f=this;if(!f._webAudio)return f;if("loaded"!==f._state)return f._queue.push({event:"pos",action:function(){f.pos(b,c,d,e)}}),f;if(c="number"!=typeof c?0:c,d="number"!=typeof d?-.5:d,void 0===e){if("number"!=typeof b)return f._pos;f._pos=[b,c,d]}for(var g=f._getSoundIds(e),h=0;h<g.length;h++){var i=f._soundById(g[h]);if(i){if("number"!=typeof b)return i._pos;i._pos=[b,c,d],i._node&&(i._panner&&!i._panner.pan||a(i,"spatial"),void 0!==i._panner.positionX?(i._panner.positionX.setValueAtTime(b,Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(c,Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(d,Howler.ctx.currentTime)):i._panner.setPosition(b,c,d)),f._emit("pos",i._id)}}return f},Howl.prototype.orientation=function(b,c,d,e){var f=this;if(!f._webAudio)return f;if("loaded"!==f._state)return f._queue.push({event:"orientation",action:function(){f.orientation(b,c,d,e)}}),f;if(c="number"!=typeof c?f._orientation[1]:c,d="number"!=typeof d?f._orientation[2]:d,void 0===e){if("number"!=typeof b)return f._orientation;f._orientation=[b,c,d]}for(var g=f._getSoundIds(e),h=0;h<g.length;h++){var i=f._soundById(g[h]);if(i){if("number"!=typeof b)return i._orientation;i._orientation=[b,c,d],i._node&&(i._panner||(i._pos||(i._pos=f._pos||[0,0,-.5]),a(i,"spatial")),void 0!==i._panner.orientationX?(i._panner.orientationX.setValueAtTime(b,Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(c,Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(d,Howler.ctx.currentTime)):i._panner.setOrientation(b,c,d)),f._emit("orientation",i._id)}}return f},Howl.prototype.pannerAttr=function(){var b,c,d,e=this,f=arguments;if(!e._webAudio)return e;if(0===f.length)return e._pannerAttr;if(1===f.length){if("object"!=typeof f[0])return d=e._soundById(parseInt(f[0],10)),d?d._pannerAttr:e._pannerAttr;b=f[0],void 0===c&&(b.pannerAttr||(b.pannerAttr={coneInnerAngle:b.coneInnerAngle,coneOuterAngle:b.coneOuterAngle,coneOuterGain:b.coneOuterGain,distanceModel:b.distanceModel,maxDistance:b.maxDistance,refDistance:b.refDistance,rolloffFactor:b.rolloffFactor,panningModel:b.panningModel}),e._pannerAttr={coneInnerAngle:void 0!==b.pannerAttr.coneInnerAngle?b.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:void 0!==b.pannerAttr.coneOuterAngle?b.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:void 0!==b.pannerAttr.coneOuterGain?b.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:void 0!==b.pannerAttr.distanceModel?b.pannerAttr.distanceModel:e._distanceModel,maxDistance:void 0!==b.pannerAttr.maxDistance?b.pannerAttr.maxDistance:e._maxDistance,refDistance:void 0!==b.pannerAttr.refDistance?b.pannerAttr.refDistance:e._refDistance,rolloffFactor:void 0!==b.pannerAttr.rolloffFactor?b.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:void 0!==b.pannerAttr.panningModel?b.pannerAttr.panningModel:e._panningModel})}else 2===f.length&&(b=f[0],c=parseInt(f[1],10));for(var g=e._getSoundIds(c),h=0;h<g.length;h++)if(d=e._soundById(g[h])){var i=d._pannerAttr;i={coneInnerAngle:void 0!==b.coneInnerAngle?b.coneInnerAngle:i.coneInnerAngle,coneOuterAngle:void 0!==b.coneOuterAngle?b.coneOuterAngle:i.coneOuterAngle,coneOuterGain:void 0!==b.coneOuterGain?b.coneOuterGain:i.coneOuterGain,distanceModel:void 0!==b.distanceModel?b.distanceModel:i.distanceModel,maxDistance:void 0!==b.maxDistance?b.maxDistance:i.maxDistance,refDistance:void 0!==b.refDistance?b.refDistance:i.refDistance,rolloffFactor:void 0!==b.rolloffFactor?b.rolloffFactor:i.rolloffFactor,panningModel:void 0!==b.panningModel?b.panningModel:i.panningModel};var j=d._panner;j?(j.coneInnerAngle=i.coneInnerAngle,j.coneOuterAngle=i.coneOuterAngle,j.coneOuterGain=i.coneOuterGain,j.distanceModel=i.distanceModel,j.maxDistance=i.maxDistance,j.refDistance=i.refDistance,j.rolloffFactor=i.rolloffFactor,j.panningModel=i.panningModel):(d._pos||(d._pos=e._pos||[0,0,-.5]),a(d,"spatial"))}return e},Sound.prototype.init=function(a){return function(){var b=this,c=b._parent;b._orientation=c._orientation,b._stereo=c._stereo,b._pos=c._pos,b._pannerAttr=c._pannerAttr,a.call(this),b._stereo?c.stereo(b._stereo):b._pos&&c.pos(b._pos[0],b._pos[1],b._pos[2],b._id)}}(Sound.prototype.init),Sound.prototype.reset=function(a){return function(){var b=this,c=b._parent;return b._orientation=c._orientation,b._stereo=c._stereo,b._pos=c._pos,b._pannerAttr=c._pannerAttr,b._stereo?c.stereo(b._stereo):b._pos?c.pos(b._pos[0],b._pos[1],b._pos[2],b._id):b._panner&&(b._panner.disconnect(0),b._panner=void 0,c._refreshBuffer(b)),a.call(this)}}(Sound.prototype.reset);var a=function(a,b){b=b||"spatial","spatial"===b?(a._panner=Howler.ctx.createPanner(),a._panner.coneInnerAngle=a._pannerAttr.coneInnerAngle,a._panner.coneOuterAngle=a._pannerAttr.coneOuterAngle,a._panner.coneOuterGain=a._pannerAttr.coneOuterGain,a._panner.distanceModel=a._pannerAttr.distanceModel,a._panner.maxDistance=a._pannerAttr.maxDistance,a._panner.refDistance=a._pannerAttr.refDistance,a._panner.rolloffFactor=a._pannerAttr.rolloffFactor,a._panner.panningModel=a._pannerAttr.panningModel,void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(a._pos[0],Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(a._pos[1],Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(a._pos[2],Howler.ctx.currentTime)):a._panner.setPosition(a._pos[0],a._pos[1],a._pos[2]),void 0!==a._panner.orientationX?(a._panner.orientationX.setValueAtTime(a._orientation[0],Howler.ctx.currentTime),a._panner.orientationY.setValueAtTime(a._orientation[1],Howler.ctx.currentTime),a._panner.orientationZ.setValueAtTime(a._orientation[2],Howler.ctx.currentTime)):a._panner.setOrientation(a._orientation[0],a._orientation[1],a._orientation[2])):(a._panner=Howler.ctx.createStereoPanner(),a._panner.pan.setValueAtTime(a._stereo,Howler.ctx.currentTime)),a._panner.connect(a._node),a._paused||a._parent.pause(a._id,!0).play(a._id,!0)}}()}),howler_1=howler.Howler,howler_2=howler.Howl;!function(){me.audio=function(){function a(a,b){if(e++>3){var d="melonJS: failed loading "+a;if(!1!==me.sys.stopOnAudioError)throw new Error(d);me.audio.disable(),b&&b(),console.log(d+", disabling audio")}else c[a].load()}var b={},c={},d=null,e=0;return b.init=function(a){if(!me.initialized)throw new Error("me.audio.init() called before engine initialization.");return a="string"==typeof a?a:"mp3",this.audioFormats=a.split(","),!howler_1.noAudio},b.hasAudio=function(){return!howler_1.noAudio},b.enable=function(){this.unmuteAll()},b.disable=function(){this.muteAll()},b.load=function(b,d,f,g){var h=[];if(void 0===this.audioFormats||0===this.audioFormats.length)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");for(var i=0;i<this.audioFormats.length;i++)h.push(b.src+b.name+"."+this.audioFormats[i]+me.loader.nocache);return c[b.name]=new howler_2({src:h,volume:howler_1.volume(),html5:!0===d,xhrWithCredentials:me.loader.withCredentials,onloaderror:function(){a.call(me.audio,b.name,g)},onload:function(){e=0,f&&f()}}),1},b.play=function(a,b,d,e){var f=c[a];if(f&&void 0!==f){var g=f.play();return"boolean"==typeof b&&f.loop(b,g),f.volume("number"==typeof e?me.Math.clamp(e,0,1):howler_1.volume(),g),"function"==typeof d&&(!0===b?f.on("end",d,g):f.once("end",d,g)),g}throw new Error("audio clip "+a+" does not exist")},b.fade=function(a,b,d,e,f){var g=c[a];if(!g||void 0===g)throw new Error("audio clip "+a+" does not exist");g.fade(b,d,e,f)},b.seek=function(a,b,d){var e=c[a];if(e&&void 0!==e)return e.seek.apply(e,Array.prototype.slice.call(arguments,1));throw new Error("audio clip "+a+" does not exist")},b.rate=function(a,b,d){var e=c[a];if(e&&void 0!==e)return e.rate.apply(e,Array.prototype.slice.call(arguments,1));throw new Error("audio clip "+a+" does not exist")},b.stop=function(a,b){var d=c[a];if(!d||void 0===d)throw new Error("audio clip "+a+" does not exist");d.stop(b),d.off("end",void 0,b)},b.pause=function(a,b){var d=c[a];if(!d||void 0===d)throw new Error("audio clip "+a+" does not exist");d.pause(b)},b.resume=function(a,b){var d=c[a];if(!d||void 0===d)throw new Error("audio clip "+a+" does not exist");d.play(b)},b.playTrack=function(a,b){return d=a,me.audio.play(d,!0,null,b)},b.stopTrack=function(){null!==d&&(c[d].stop(),d=null)},b.pauseTrack=function(){null!==d&&c[d].pause()},b.resumeTrack=function(){null!==d&&c[d].play()},b.getCurrentTrack=function(){return d},b.setVolume=function(a){howler_1.volume(a)},b.getVolume=function(){return howler_1.volume()},b.mute=function(a,b,d){d=void 0===d||!!d;var e=c[a];if(!e||void 0===e)throw new Error("audio clip "+a+" does not exist");e.mute(d,b)},b.unmute=function(a,c){b.mute(a,c,!1)},b.muteAll=function(){howler_1.mute(!0)},b.unmuteAll=function(){howler_1.mute(!1)},b.muted=function(){return howler_1._muted},b.unload=function(a){return a in c&&(c[a].unload(),delete c[a],!0)},b.unloadAll=function(){for(var a in c)c.hasOwnProperty(a)&&b.unload(a)},b}()}(),function(){me.video=function(){function a(a,b,c,d){try{return new me.WebGLRenderer(a,b,c,d)}catch(e){return console.log("Error creating WebGL renderer :"+e.message),new me.CanvasRenderer(a,b,c,d)}}var b={},c=-1,d=1,e=0,f=0,g=1/0,h=1/0,i={wrapper:void 0,renderer:2,doubleBuffering:!1,autoScale:!1,scale:1,scaleMethod:"fit",transparent:!1,blendMode:"normal",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,verbose:!1,consoleHeader:!0};return b.CANVAS=0,b.WEBGL=1,b.AUTO=2,b.init=function(c,g,h){if(!me.initialized)throw new Error("me.video.init() called before engine initialization.");i=Object.assign(i,h||{}),i.doubleBuffering=!!i.doubleBuffering,i.useParentDOMSize=!!i.useParentDOMSize,i.autoScale="auto"===i.scale||!1,i.transparent=!!i.transparent,i.antiAlias=!!i.antiAlias,i.failIfMajorPerformanceCaveat=!!i.failIfMajorPerformanceCaveat,i.subPixel=!!i.subPixel,i.verbose=!!i.verbose,0!==i.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)&&(i.scaleMethod="fit"),!0===me.utils.getUriFragment().webgl&&(i.renderer=b.WEBGL),i.scale=i.autoScale?1:+i.scale||1,me.sys.scale=new me.Vector2d(i.scale,i.scale),(i.autoScale||1!==i.scale)&&(i.doubleBuffering=!0),d=c/g,e=c,f=g;var j=c*me.sys.scale.x,k=g*me.sys.scale.y;i.zoomX=j,i.zoomY=k,window.addEventListener("resize",me.utils.function.throttle(function(a){me.event.publish(me.event.WINDOW_ONRESIZE,[a])},100),!1),window.addEventListener("orientationchange",function(a){me.event.publish(me.event.WINDOW_ONORIENTATION_CHANGE,[a])},!1),window.addEventListener("onmozorientationchange",function(a){me.event.publish(me.event.WINDOW_ONORIENTATION_CHANGE,[a])},!1),void 0!==window.screen&&(window.screen.onorientationchange=function(a){me.event.publish(me.event.WINDOW_ONORIENTATION_CHANGE,[a])}),window.addEventListener("scroll",me.utils.function.throttle(function(a){me.video.renderer.updateBounds(),me.event.publish(me.event.WINDOW_ONSCROLL,[a])},100),!1),me.event.subscribe(me.event.WINDOW_ONRESIZE,me.video.onresize.bind(me.video)),me.event.subscribe(me.event.WINDOW_ONORIENTATION_CHANGE,me.video.onresize.bind(me.video));var l;if(l=!0===me.device.ejecta?document.getElementById("canvas"):void 0!==window.canvas?window.canvas:b.createCanvas(j,k),h.wrapper&&(i.wrapper=document.getElementById(h.wrapper)),i.wrapper||(i.wrapper=document.body),i.wrapper.appendChild(l),void 0===l.getContext)return!1;switch(i.renderer){case b.AUTO:case b.WEBGL:this.renderer=a(l,c,g,i);break;default:this.renderer=new me.CanvasRenderer(l,c,g,i)}var m=me.device.devicePixelRatio;if(m>1&&(l.style.width=l.width/m+"px",l.style.height=l.height/m+"px"),window.getComputedStyle){var n=window.getComputedStyle(l,null);me.video.setMaxSize(parseInt(n.maxWidth,10),parseInt(n.maxHeight,10))}if(me.game.init(),me.video.onresize(),"MutationObserver"in window){new MutationObserver(me.video.onresize.bind(me.video)).observe(i.wrapper,{attributes:!1,childList:!0,subtree:!0})}if(!1!==h.consoleHeader){var o=me.video.renderer instanceof me.CanvasRenderer?"CANVAS":"WebGL",p=me.device.hasWebAudio?"Web Audio":"HTML5 Audio";console.log("melonJS v"+me.version+" | http://melonjs.org"),console.log(o+" | "+p+" | pixel ratio "+me.device.devicePixelRatio+" | "+(me.device.isMobile?"mobile":"desktop")+" | "+me.device.getScreenOrientation()+" | "+me.device.language),console.log("resolution: requested "+c+"x"+g+", got "+me.video.renderer.getWidth()+"x"+me.video.renderer.getHeight())}return!0},b.setMaxSize=function(a,b){g=a||1/0,h=b||1/0,me.utils.function.defer(me.video.onresize,me.video)},b.createCanvas=function(a,b){if(0===a||0===b)throw new Error("width or height was zero, Canvas could not be initialized !");var c=document.createElement("canvas");return c.width=a,c.height=b,c},b.getWrapper=function(){return i.wrapper},b.onresize=function(){var a=1,b=1;if(i.autoScale){var j,k,l=me.video.renderer.getScreenCanvas().parentNode;if(void 0!==l)if(i.useParentDOMSize&&"function"==typeof l.getBoundingClientRect){var m=l.getBoundingClientRect();j=m.width||m.right-m.left,k=m.height||m.bottom-m.top}else j=l.width,k=l.height;var n=Math.min(g,j||window.innerWidth),o=Math.min(h,k||window.innerHeight),p=n/o,q=1/0,r=1/0;"fill-min"===i.scaleMethod&&p>d||"fill-max"===i.scaleMethod&&p<d||"flex-width"===i.scaleMethod?(q=Math.min(g,f*p),a=b=n/q,q=~~(q+.5),this.renderer.resize(q,f)):"fill-min"===i.scaleMethod&&p<d||"fill-max"===i.scaleMethod&&p>d||"flex-height"===i.scaleMethod?(r=Math.min(h,e*(o/n)),a=b=o/r,r=~~(r+.5),this.renderer.resize(e,r)):"flex"===i.scaleMethod?this.renderer.resize(n,o):"stretch"===i.scaleMethod?(a=n/e,b=o/f):a=b=p<d?n/e:o/f,a*=me.device.devicePixelRatio,b*=me.device.devicePixelRatio,c>0&&clearTimeout(c),c=me.utils.function.defer(me.video.scale,this,a,b)}this.renderer.updateBounds()},b.scale=function(a,b){var d=this.renderer.getScreenCanvas(),e=this.renderer.getScreenContext(),f=this.renderer.settings,g=d.width*a,h=d.height*b;me.sys.scale.set(a,b),me.device.devicePixelRatio>1?(d.style.width=g/me.device.devicePixelRatio+"px",d.style.height=h/me.device.devicePixelRatio+"px"):(d.style.width=g+"px",d.style.height=h+"px"),this.renderer.setAntiAlias(e,f.antiAlias),this.renderer.setBlendMode(f.blendMode,e),this.renderer.updateBounds(),me.game.repaint(),c=-1},b}()}(),function(){me.Renderer=me.Object.extend({init:function(a,b,c,d){return this.settings=d,this.isContextValid=!0,this.currentScissor=new Int32Array([0,0,this.width,this.height]),this.currentBlendMode="normal",this.canvas=this.backBufferCanvas=a,this.context=null,this.currentColor=new me.Color(0,0,0,1),this.currentTint=new me.Color(255,255,255,1),this.projectionMatrix=new me.Matrix2d,this.uvOffset=0,this.parentBounds=new me.Rect(0,0,0,0),me.event.subscribe(me.event.GAME_RESET,function(){me.video.renderer.reset()}),this},clear:function(){},reset:function(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.currentTint.setColor(255,255,255,1),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height,this.updateBounds()},updateBounds:function(){var a,b=this.getScreenCanvas();a=void 0===b.getBoundingClientRect?{left:0,top:0,width:0,height:0}:b.getBoundingClientRect(),this.parentBounds.setShape(a.left,a.top,a.width,a.height)},getBounds:function(){return this.parentBounds},getCanvas:function(){return this.backBufferCanvas},getScreenCanvas:function(){return this.canvas},getScreenContext:function(){return this.context},getBlendMode:function(){return this.currentBlendMode},getContext2d:function(a,b){if(void 0===a||null===a)throw new Error("You must pass a canvas element in order to create a 2d context");if(void 0===a.getContext)throw new Error("Your browser does not support HTML5 canvas.");"boolean"!=typeof b&&(b=!0);var c=a.getContext("2d",{alpha:b});return c.canvas||(c.canvas=a),this.setAntiAlias(c,this.settings.antiAlias),c},getWidth:function(){return this.backBufferCanvas.width},getHeight:function(){return this.backBufferCanvas.height},getColor:function(){return this.currentColor},globalAlpha:function(){return this.currentColor.glArray[3]},overlaps:function(a){return a.left<this.getWidth()&&a.right>0&&a.top<this.getHeight()&&a.bottom>0},resize:function(a,b){a===this.backBufferCanvas.width&&b===this.backBufferCanvas.height||(this.canvas.width=this.backBufferCanvas.width=a,this.canvas.height=this.backBufferCanvas.height=b,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=a,this.currentScissor[3]=b,me.event.publish(me.event.CANVAS_ONRESIZE,[a,b])),this.updateBounds()},setAntiAlias:function(a,b){var c=a.canvas;me.agent.setPrefixed("imageSmoothingEnabled",!0===b,a),!0!==b?(c.style["image-rendering"]="pixelated",c.style["image-rendering"]="crisp-edges",c.style["image-rendering"]="-moz-crisp-edges",c.style["image-rendering"]="-o-crisp-edges",c.style["image-rendering"]="-webkit-optimize-contrast",c.style.msInterpolationMode="nearest-neighbor"):c.style["image-rendering"]="auto"},setProjection:function(a){this.projectionMatrix.copy(a)},stroke:function(a,b){"Rectangle"===a.shapeType?this.strokeRect(a.left,a.top,a.width,a.height,b):a instanceof me.Line||a instanceof me.Polygon?this.strokePolygon(a,b):a instanceof me.Ellipse&&this.strokeEllipse(a.pos.x,a.pos.y,a.radiusV.x,a.radiusV.y,b)},fill:function(a){this.stroke(a,!0)},setMask:function(a){},clearMask:function(){},setTint:function(a){this.currentTint.copy(a)},clearTint:function(){this.currentTint.setColor(255,255,255,1)},drawFont:function(){}})}(),function(){me.Renderer.prototype.Texture=me.Object.extend({init:function(a,b,c){if(this.format=null,this.sources=new Map,this.atlases=new Map,void 0!==a){a=Array.isArray(a)?a:[a];for(var d in a){var e=a[d];if(void 0!==e.meta){if(e.meta.app.includes("texturepacker")){if(this.format="texturepacker",void 0===b){var f=me.loader.getImage(e.meta.image);if(!f)throw new Error("Atlas texture '"+f+"' not found");this.sources.set(e.meta.image,f)}else this.sources.set(e.meta.image||"default","string"==typeof b?me.loader.getImage(b):b);this.repeat="no-repeat"}else if(e.meta.app.includes("ShoeBox")){
if(!e.meta.exporter||!e.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default","string"==typeof b?me.loader.getImage(b):b)}else e.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=e.meta.repeat||"no-repeat",this.sources.set("default","string"==typeof b?me.loader.getImage(b):b));this.atlases.set(e.meta.image||"default",this.parse(e))}else void 0!==e.framewidth&&void 0!==e.frameheight&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",void 0!==b&&(e.image="string"==typeof b?me.loader.getImage(b):b),this.atlases.set("default",this.parseFromSpriteSheet(e)),this.sources.set("default",e.image))}}if(0===this.atlases.length)throw new Error("texture atlas format not supported");if(!1!==c){b=Array.isArray(b)?b:[b];var g=!0,h=!1,i=void 0;try{for(var j,k=this.sources[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value;c instanceof me.Renderer.TextureCache?c.set(l,this):me.video.renderer.cache.set(l,this)}}catch(a){h=!0,i=a}finally{try{g||null==k.return||k.return()}finally{if(h)throw i}}}},createAtlas:function(a,b,c,d){return{meta:{app:"melonJS",size:{w:a,h:b},repeat:d||"no-repeat",image:"default"},frames:[{filename:c||"default",frame:{x:0,y:0,w:a,h:b}}]}},parse:function(a){var b={},c=this;return a.frames.forEach(function(d){if(d.hasOwnProperty("filename")){var e,f,g=d.frame,h=d.spriteSourceSize&&d.sourceSize&&d.pivot;h&&(e=d.sourceSize.w*d.pivot.x-(d.trimmed?d.spriteSourceSize.x:0),f=d.sourceSize.h*d.pivot.y-(d.trimmed?d.spriteSourceSize.y:0)),b[d.filename]={name:d.filename,texture:a.meta.image||"default",offset:new me.Vector2d(g.x,g.y),anchorPoint:h?new me.Vector2d(e/g.w,f/g.h):null,trimmed:!!d.trimmed,width:g.w,height:g.h,angle:!0===d.rotated?-me.Math.ETA:0},c.addUvsMap(b,d.filename,a.meta.size.w,a.meta.size.h)}}),b},parseFromSpriteSheet:function(a){var b={},c=a.image,d=a.spacing||0,e=a.margin||0,f=c.width,g=c.height,h=me.pool.pull("me.Vector2d",~~((f-e+d)/(a.framewidth+d)),~~((g-e+d)/(a.frameheight+d)));f%(a.framewidth+d)==0&&g%(a.frameheight+d)==0||(f=h.x*(a.framewidth+d),g=h.y*(a.frameheight+d),console.warn("Spritesheet Texture for image: "+c.src+" is not divisible by "+(a.framewidth+d)+"x"+(a.frameheight+d)+", truncating effective size to "+f+"x"+g));for(var i=0,j=h.x*h.y;i<j;i++){var k=""+i;b[k]={name:k,texture:"default",offset:new me.Vector2d(e+(d+a.framewidth)*(i%h.x),e+(d+a.frameheight)*~~(i/h.x)),anchorPoint:a.anchorPoint||null,trimmed:!1,width:a.framewidth,height:a.frameheight,angle:0},this.addUvsMap(b,k,f,g)}return me.pool.push(h),b},addUvsMap:function(a,b,c,d){if(me.video.renderer instanceof me.WebGLRenderer){var e=a[b].offset,f=a[b].width,g=a[b].height;a[b].uvs=new Float32Array([e.x/c,e.y/d,(e.x+f)/c,(e.y+g)/d]);a[e.x+","+e.y+","+c+","+d]=a[b]}return a[b]},addQuadRegion:function(a,b,c,d,e){!0===me.video.renderer.settings.verbose&&console.warn("Adding texture region",a,"for texture",this);var f=this.getTexture(),g=this.getAtlas(),h=f.width,i=f.height;return g[a]={name:a,offset:new me.Vector2d(b,c),width:d,height:e,angle:0},this.addUvsMap(g,a,h,i),g[a]},getAtlas:function(a){return"string"==typeof a?this.atlases.get(a):this.atlases.values().next().value},getTexture:function(a){return"object"===_typeof(a)&&"string"==typeof a.texture?this.sources.get(a.texture):this.sources.values().next().value},getRegion:function(a,b){var c;return"string"==typeof b?c=this.getAtlas(b)[a]:this.atlases.forEach(function(b){void 0!==b[a]&&(c=b[a])}),c},getUVs:function(a){var b=this.getRegion(a);if(void 0===b){var c=a.split(","),d=+c[0],e=+c[1],f=+c[2],g=+c[3];b=this.addQuadRegion(a,d,e,f,g)}return b.uvs},createSpriteFromName:function(a,b){return me.pool.pull("me.Sprite",0,0,Object.assign({image:this,region:a},b||{}))},createAnimationFromName:function(a,b){for(var c,d=[],e={},f=0,g=0,h=0;h<a.length;++h){if(null==(c=this.getRegion(a[h])))throw new Error("Texture - region for "+a[h]+" not found");d[h]=c,e[a[h]]=h,f=Math.max(c.width,f),g=Math.max(c.height,g)}return new me.Sprite(0,0,Object.assign({image:this,framewidth:f,frameheight:g,margin:0,spacing:0,atlas:d,atlasIndices:e},b||{}))}})}(),function(){me.Renderer.TextureCache=me.Object.extend({init:function(a){this.cache=new Map,this.units=new Map,this.max_size=a||1/0,this.clear()},clear:function(){this.cache.clear(),this.units.clear(),this.length=0},validate:function(){if(this.length>=this.max_size)throw new Error("Texture cache overflow: "+this.max_size+" texture units available.")},get:function(a,b){return this.cache.has(a)||(b||(b=me.video.renderer.Texture.prototype.createAtlas.apply(me.video.renderer.Texture.prototype,[a.width,a.height,a.src?me.utils.file.getBasename(a.src):void 0])),this.set(a,new me.video.renderer.Texture(b,a,!1))),this.cache.get(a)},set:function(a,b){var c=a.width,d=a.height;if(!me.Math.isPowerOfTwo(c)||!me.Math.isPowerOfTwo(d)){var e=void 0!==a.src?a.src:a;console.warn("[Texture] "+e+" is not a POT texture ("+c+"x"+d+")")}this.validate(),this.cache.set(a,b),this.units.set(b,this.length++)},getUnit:function(a){return this.units.get(a)}})}(),function(){me.CanvasRenderer=me.Renderer.extend({init:function(a,b,c,d){return me.Renderer.prototype.init.apply(this,[a,b,c,d]),this.context=this.getContext2d(this.canvas,this.settings.transparent),this.settings.doubleBuffering?(this.backBufferCanvas=me.video.createCanvas(b,c),this.backBufferContext2D=this.getContext2d(this.backBufferCanvas)):(this.backBufferCanvas=this.canvas,this.backBufferContext2D=this.context),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new me.Renderer.TextureCache,!1===this.settings.textureSeamFix||this.settings.antiAlias||(this.uvOffset=1),this},reset:function(){me.Renderer.prototype.reset.apply(this)},resetTransform:function(){this.backBufferContext2D.setTransform(1,0,0,1,0,0)},setBlendMode:function(a,b){switch(b=b||this.getContext(),this.currentBlendMode=a,a){case"multiply":b.globalCompositeOperation="multiply";break;default:b.globalCompositeOperation="source-over",this.currentBlendMode="normal"}this.settings.doubleBuffering&&this.settings.transparent&&(this.context.globalCompositeOperation="copy")},clear:function(){this.settings.transparent&&this.clearColor("rgba(0,0,0,0)",!0)},flush:function(){this.settings.doubleBuffering&&this.context.drawImage(this.backBufferCanvas,0,0)},clearColor:function(a,b){this.save(),this.resetTransform(),this.backBufferContext2D.globalCompositeOperation=b?"copy":"source-over",this.backBufferContext2D.fillStyle=a instanceof me.Color?a.toRGBA():a,this.fillRect(0,0,this.backBufferCanvas.width,this.backBufferCanvas.height),this.restore()},clearRect:function(a,b,c,d){this.backBufferContext2D.clearRect(a,b,c,d)},createPattern:function(a,b){return this.backBufferContext2D.createPattern(a,b)},drawImage:function(a,b,c,d,e,f,g,h,i){this.backBufferContext2D.globalAlpha<1/255||(void 0===d?(d=h=a.width,e=i=a.height,f=b,g=c,b=0,c=0):void 0===f&&(f=b,g=c,h=d,i=e,d=a.width,e=a.height,b=0,c=0),!1===this.settings.subPixel&&(f=~~f,g=~~g),this.backBufferContext2D.drawImage(a,b,c,d,e,f,g,h,i))},drawPattern:function(a,b,c,d,e){if(!(this.backBufferContext2D.globalAlpha<1/255)){var f=this.backBufferContext2D.fillStyle;this.backBufferContext2D.fillStyle=a,this.backBufferContext2D.fillRect(b,c,d,e),this.backBufferContext2D.fillStyle=f}},strokeArc:function(a,b,c,d,e,f,g){var h=this.backBufferContext2D;h.globalAlpha<1/255||(h.translate(a,b),h.beginPath(),h.arc(0,0,c,d,e,f||!1),h[!0===g?"fill":"stroke"](),h.translate(-a,-b))},fillArc:function(a,b,c,d,e,f){this.strokeArc(a,b,c,d,e,f||!1,!0)},strokeEllipse:function(a,b,c,d,e){var f=this.backBufferContext2D;if(!(f.globalAlpha<1/255)){var g=c,h=d,i=a-g,j=a+g,k=b-h,l=b+h,m=.551784*g,n=.551784*h,o=a-m,p=a+m,q=b-n,r=b+n;f.beginPath(),f.moveTo(a,k),f.bezierCurveTo(p,k,j,q,j,b),f.bezierCurveTo(j,r,p,l,a,l),f.bezierCurveTo(o,l,i,r,i,b),f.bezierCurveTo(i,q,o,k,a,k),f[!0===e?"fill":"stroke"](),f.closePath()}},fillEllipse:function(a,b,c,d){this.strokeEllipse(a,b,c,d,!0)},strokeLine:function(a,b,c,d){var e=this.backBufferContext2D;e<1/255||(e.beginPath(),e.moveTo(a,b),e.lineTo(c,d),e.stroke())},fillLine:function(a,b,c,d){this.strokeLine(a,b,c,d)},strokePolygon:function(a,b){var c=this.backBufferContext2D;if(!(c.globalAlpha<1/255)){this.translate(a.pos.x,a.pos.y),c.beginPath(),c.moveTo(a.points[0].x,a.points[0].y);for(var d,e=1;e<a.points.length;e++)d=a.points[e],c.lineTo(d.x,d.y);c.lineTo(a.points[0].x,a.points[0].y),c[!0===b?"fill":"stroke"](),c.closePath(),this.translate(-a.pos.x,-a.pos.y)}},fillPolygon:function(a){this.strokePolygon(a,!0)},strokeRect:function(a,b,c,d){this.backBufferContext2D.globalAlpha<1/255||this.backBufferContext2D.strokeRect(a,b,c,d)},fillRect:function(a,b,c,d){this.backBufferContext2D.globalAlpha<1/255||this.backBufferContext2D.fillRect(a,b,c,d)},getContext:function(){return this.backBufferContext2D},getFontContext:function(){return this.getContext()},save:function(){this.backBufferContext2D.save()},restore:function(){this.backBufferContext2D.restore(),this.currentColor.glArray[3]=this.backBufferContext2D.globalAlpha,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height},rotate:function(a){this.backBufferContext2D.rotate(a)},scale:function(a,b){this.backBufferContext2D.scale(a,b)},setColor:function(a){this.backBufferContext2D.strokeStyle=this.backBufferContext2D.fillStyle=a instanceof me.Color?a.toRGBA():a},setGlobalAlpha:function(a){this.backBufferContext2D.globalAlpha=this.currentColor.glArray[3]=a},setLineWidth:function(a){this.backBufferContext2D.lineWidth=a},setTransform:function(a){this.resetTransform(),this.transform(a)},transform:function(a){var b=a.val,c=b[6],d=b[7];!1===this.settings.subPixel&&(c=~~c,d=~~d),this.backBufferContext2D.transform(b[0],b[1],b[3],b[4],c,d)},translate:function(a,b){!1===this.settings.subPixel?this.backBufferContext2D.translate(~~a,~~b):this.backBufferContext2D.translate(a,b)},clipRect:function(a,b,c,d){var e=this.backBufferCanvas;if(0!==a||0!==b||c!==e.width||d!==e.height){var f=this.currentScissor;if(f[0]!==a||f[1]!==b||f[2]!==c||f[3]!==d){var g=this.backBufferContext2D;g.beginPath(),g.rect(a,b,c,d),g.clip(),f[0]=a,f[1]=b,f[2]=c,f[3]=d}}},setMask:function(a){var b=this.backBufferContext2D,c=a.pos.x,d=a.pos.y;if(a instanceof me.Ellipse){var e=a.radiusV.x,f=a.radiusV.y,g=c-e,h=c+e,i=d-f,j=d+f,k=.551784*e,l=.551784*f,m=c-k,n=c+k,o=d-l,p=d+l;b.beginPath(),b.moveTo(c,i),b.bezierCurveTo(n,i,h,o,h,d),b.bezierCurveTo(h,p,n,j,c,j),b.bezierCurveTo(m,j,g,p,g,d),b.bezierCurveTo(g,o,m,i,c,i)}else{b.save(),b.beginPath(),b.moveTo(c+a.points[0].x,d+a.points[0].y);for(var q,r=1;r<a.points.length;r++)q=a.points[r],b.lineTo(c+q.x,d+q.y);b.closePath()}b.clip()},clearMask:function(){this.backBufferContext2D.restore()}})}(),function(){me.WebGLRenderer=me.Renderer.extend({init:function(a,b,c,d){var e=this;me.Renderer.prototype.init.apply(this,[a,b,c,d]),this.context=this.gl=this.getContextGL(a,this.settings.transparent),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._glPoints=[new me.Vector2d,new me.Vector2d,new me.Vector2d,new me.Vector2d],this.currentTransform=new me.Matrix2d;var f=this.settings.compositor||me.WebGLRenderer.Compositor;return this.compositor=new f(this),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode),this.cache=new me.Renderer.TextureCache(this.compositor.maxTextures),a.addEventListener("webglcontextlost",function(a){a.preventDefault(),e.isContextValid=!1,me.event.publish(me.event.WEBGL_ONCONTEXT_LOST,[e])},!1),a.addEventListener("webglcontextrestored",function(a){e.reset(),e.isContextValid=!0,me.event.publish(me.event.WEBGL_ONCONTEXT_RESTORED,[e])},!1),this},reset:function(){me.Renderer.prototype.reset.apply(this),!1===this.isContextValid?this.compositor.init(this):this.compositor.reset(),this.gl.disable(this.gl.SCISSOR_TEST),void 0!==this.fontContext2D&&this.createFontTexture(this.cache)},resetTransform:function(){this.currentTransform.identity()},createFontTexture:function(a){if(void 0===this.fontTexture){var b=me.video.createCanvas(me.Math.nextPowerOfTwo(this.backBufferCanvas.width),me.Math.nextPowerOfTwo(this.backBufferCanvas.height));this.fontContext2D=this.getContext2d(b),this.fontTexture=new this.Texture(this.Texture.prototype.createAtlas.apply(this.Texture.prototype,[this.backBufferCanvas.width,this.backBufferCanvas.height,"fontTexture"]),b,a)}else a.set(this.fontContext2D.canvas,this.fontTexture);this.compositor.uploadTexture(this.fontTexture,0,0,0)},createPattern:function(a,b){if(!me.Math.isPowerOfTwo(a.width)||!me.Math.isPowerOfTwo(a.height)){var c=void 0!==a.src?a.src:a;throw new Error("[WebGL Renderer] "+c+" is not a POT texture ("+a.width+"x"+a.height+")")}var d=new this.Texture(this.Texture.prototype.createAtlas.apply(this.Texture.prototype,[a.width,a.height,"pattern",b]),a);return this.compositor.uploadTexture(d),d},flush:function(){this.compositor.flush()},clearColor:function(a,b){this.save(),this.resetTransform(),this.currentColor.copy(a),b?this.compositor.clear():this.fillRect(0,0,this.canvas.width,this.canvas.height),this.restore()},clearRect:function(a,b,c,d){var e=this.currentColor.clone();this.currentColor.copy("#000000"),this.fillRect(a,b,c,d),this.currentColor.copy(e),me.pool.push(e)},drawFont:function(a){var b=this.getFontContext();this.flush(),this.compositor.uploadTexture(this.fontTexture,0,0,0,!0);var c=a.pos.x+","+a.pos.y+","+a.width+","+a.height;this.compositor.addQuad(this.fontTexture,c,a.pos.x,a.pos.y,a.width,a.height),b.clearRect(a.pos.x,a.pos.y,a.width,a.height)},drawImage:function(a,b,c,d,e,f,g,h,i){void 0===d?(d=h=a.width,e=i=a.height,f=b,g=c,b=0,c=0):void 0===f&&(f=b,g=c,h=d,i=e,d=a.width,e=a.height,b=0,c=0),!1===this.settings.subPixel&&(f=~~f,g=~~g);var j=b+","+c+","+d+","+e;this.compositor.addQuad(this.cache.get(a),j,f,g,h,i)},drawPattern:function(a,b,c,d,e){var f="0,0,"+d+","+e;this.compositor.addQuad(a,f,b,c,d,e)},getScreenContext:function(){return this.gl},getContextGL:function(a,b){if(void 0===a||null===a)throw new Error("You must pass a canvas element in order to create a GL context");"boolean"!=typeof b&&(b=!0);var c={alpha:b,antialias:this.settings.antiAlias,depth:!1,stencil:!0,premultipliedAlpha:b,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat},d=a.getContext("webgl",c)||a.getContext("experimental-webgl",c);if(!d)throw new Error("A WebGL context could not be created.");return d},getContext:function(){return this.gl},setBlendMode:function(a,b){switch(b=b||this.gl,b.enable(b.BLEND),a){case"multiply":b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),this.currentBlendMode=a;break;default:b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal"}},getFontContext:function(){return void 0===this.fontContext2D&&(console.warn("[WebGL Renderer] WARNING : Using Standard me.Text with WebGL will severly impact performances !"),this.createFontTexture(this.cache)),this.fontContext2D},restore:function(){if(0!==this._matrixStack.length){var a=this._colorStack.pop(),b=this._matrixStack.pop();this.currentColor.copy(a),this.currentTransform.copy(b),me.pool.push(a),me.pool.push(b)}0!==this._scissorStack.length?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height)},save:function(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice())},rotate:function(a){this.currentTransform.rotate(a)},scale:function(a,b){this.currentTransform.scale(a,b)},setAntiAlias:function(a,b){me.Renderer.prototype.setAntiAlias.apply(this,[a,b])},setGlobalAlpha:function(a){this.currentColor.glArray[3]=a},setColor:function(a){var b=this.currentColor.glArray[3];this.currentColor.copy(a),this.currentColor.glArray[3]*=b},setLineWidth:function(a){this.getScreenContext().lineWidth(a)},strokeArc:function(a,b,c,d,e,f,g){if(!0===g)this.fillArc(a,b,c,d,e,f);else{var h=this._glPoints,i=Math.floor(24*Math.sqrt(2*c)),j=(e-d)/(2*i),k=2*j,l=Math.cos(j),m=Math.sin(j);for(n=h.length;n<i+1;n++)h.push(new me.Vector2d);for(var n=0;n<i;n++){var o=j+d+k*n,p=Math.cos(o),q=-Math.sin(o);h[n].x=a+(l*p+m*q)*c,h[n].y=b+(l*-q+m*p)*c}this.compositor.drawLine(h,i,!0)}},fillArc:function(a,b,c,d,e,f){var g=this._glPoints,h=0,i=Math.floor(24*Math.sqrt(2*c)),j=(e-d)/(2*i),k=2*j,l=Math.cos(j),m=Math.sin(j);for(n=g.length;n<2*i;n++)g.push(new me.Vector2d);for(var n=0;n<i-1;n++){var o=j+d+k*n,p=Math.cos(o),q=-Math.sin(o);g[h++].set(a,b),g[h++].set(a-(l*p+m*q)*c,b-(l*-q+m*p)*c)}this.compositor.drawTriangle(g,h,!0)},strokeEllipse:function(a,b,c,d,e){if(!0===e)this.fillEllipse(a,b,c,d);else{var f,g=Math.floor(24*Math.sqrt(c))||Math.floor(12*Math.sqrt(c+d)),h=me.Math.TAU/g,i=this._glPoints;for(f=i.length;f<g;f++)i.push(new me.Vector2d);for(f=0;f<g;f++)i[f].x=a+Math.sin(h*-f)*c,i[f].y=b+Math.cos(h*-f)*d;this.compositor.drawLine(i,g)}},fillEllipse:function(a,b,c,d){var e,f=Math.floor(24*Math.sqrt(c))||Math.floor(12*Math.sqrt(c+d)),g=me.Math.TAU/f,h=this._glPoints,i=0;for(e=h.length;e<2*(f+1);e++)h.push(new me.Vector2d);for(e=0;e<f+1;e++)h[i++].set(a,b),h[i++].set(a+Math.sin(g*e)*c,b+Math.cos(g*e)*d);this.compositor.drawTriangle(h,i,!0)},strokeLine:function(a,b,c,d){var e=this._glPoints;e[0].x=a,e[0].y=b,e[1].x=c,e[1].y=d,this.compositor.drawLine(e,2,!0)},fillLine:function(a,b,c,d){this.strokeLine(a,b,c,d)},strokePolygon:function(a,b){if(!0===b)this.fillPolygon(a);else{var c,d=a.points.length,e=this._glPoints;for(c=e.length;c<d;c++)e.push(new me.Vector2d);for(c=0;c<d;c++)e[c].x=a.pos.x+a.points[c].x,e[c].y=a.pos.y+a.points[c].y;this.compositor.drawLine(e,d)}},fillPolygon:function(a){var b=a.points,c=this._glPoints,d=a.getIndices(),e=a.pos.x,f=a.pos.y;for(g=c.length;g<d.length;g++)c.push(new me.Vector2d);for(var g=0;g<d.length;g++)c[g].set(e+b[d[g]].x,f+b[d[g]].y);this.compositor.drawTriangle(c,d.length)},strokeRect:function(a,b,c,d){var e=this._glPoints;e[0].x=a,e[0].y=b,e[1].x=a+c,e[1].y=b,e[2].x=a+c,e[2].y=b+d,e[3].x=a,e[3].y=b+d,this.compositor.drawLine(e,4)},fillRect:function(a,b,c,d){var e=this._glPoints;e[0].x=a+c,e[0].y=b,e[1].x=a,e[1].y=b,e[2].x=a+c,e[2].y=b+d,e[3].x=a,e[3].y=b+d,this.compositor.drawTriangle(e,4,!0)},setTransform:function(a){this.resetTransform(),this.transform(a)},transform:function(a){if(this.currentTransform.multiply(a),!1===this.settings.subPixel){var b=this.currentTransform.val;b[6]=~~b[6],b[7]=~~b[7]}},translate:function(a,b){!1===this.settings.subPixel?this.currentTransform.translate(~~a,~~b):this.currentTransform.translate(a,b)},clipRect:function(a,b,c,d){var e=this.backBufferCanvas,f=this.gl;if(0!==a||0!==b||c!==e.width||d!==e.height){var g=this.currentScissor;if(f.isEnabled(f.SCISSOR_TEST)&&g[0]===a&&g[1]===b&&g[2]===c&&g[3]===d)return;this.flush(),f.enable(this.gl.SCISSOR_TEST),f.scissor(a+this.currentTransform.tx,e.height-d-b-this.currentTransform.ty,c,d),g[0]=a,g[1]=b,g[2]=c,g[3]=d}else f.disable(f.SCISSOR_TEST)},setMask:function(a){var b=this.gl;this.flush(),b.enable(b.STENCIL_TEST),b.clear(b.STENCIL_BUFFER_BIT),b.colorMask(!1,!1,!1,!1),b.stencilFunc(b.NOTEQUAL,1,1),b.stencilOp(b.REPLACE,b.REPLACE,b.REPLACE),this.fill(a),this.flush(),b.colorMask(!0,!0,!0,!0),b.stencilFunc(b.EQUAL,1,1),b.stencilOp(b.KEEP,b.KEEP,b.KEEP)},clearMask:function(){this.flush(),this.gl.disable(this.gl.STENCIL_TEST)}})}(),function(){var a=9*Float32Array.BYTES_PER_ELEMENT,b=0*Float32Array.BYTES_PER_ELEMENT,c=2*Float32Array.BYTES_PER_ELEMENT,d=6*Float32Array.BYTES_PER_ELEMENT,e=7*Float32Array.BYTES_PER_ELEMENT;me.WebGLRenderer.Compositor=me.Object.extend({init:function(f){var g=f.gl;this.length=0,this.units=[],this.maxTextures=Math.min(24,g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS)),this.v=[new me.Vector2d,new me.Vector2d,new me.Vector2d,new me.Vector2d],this.renderer=f,this.gl=f.gl,this.color=f.currentColor,this.tint=f.currentTint,this.viewMatrix=f.currentTransform,this.activeShader=null,this.primitiveShader=new me.PrimitiveGLShader(this.gl),this.quadShader=new me.QuadGLShader(this.gl,this.maxTextures),this.sb=g.createBuffer(),g.bindBuffer(g.ARRAY_BUFFER,this.sb),g.bufferData(g.ARRAY_BUFFER,16e3*a*4,g.STREAM_DRAW),this.sbSize=256,this.sbIndex=0,this.stream=new Float32Array(9*this.sbSize*4),this.ib=g.createBuffer(),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.ib),g.bufferData(g.ELEMENT_ARRAY_BUFFER,this.createIB(),g.STATIC_DRAW),g.vertexAttribPointer(this.quadShader.attributes.aVertex,2,g.FLOAT,!1,a,b),g.vertexAttribPointer(this.quadShader.attributes.aColor,4,g.FLOAT,!1,a,c),g.vertexAttribPointer(this.quadShader.attributes.aTexture,1,g.FLOAT,!1,a,d),g.vertexAttribPointer(this.quadShader.attributes.aRegion,2,g.FLOAT,!1,a,e),me.event.subscribe(me.event.CANVAS_ONRESIZE,function(a,b){this.flush(),this.setViewport(0,0,a,b)}.bind(this)),this.reset()},reset:function(){this.sbIndex=0,this.length=0;var a=[];this.gl=this.renderer.gl,this.flush(),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,1);for(var b=0;b<this.maxTextures;b++)this.units[b]=!1,a[b]=b;this.useShader(this.quadShader),this.quadShader.setUniform("uSampler",a)},setViewport:function(a,b,c,d){this.gl.viewport(a,b,c,d)},createTexture:function(a,b,c,d,e,f,g,h){var i=this.gl;d=d||"no-repeat";var j=me.Math.isPowerOfTwo(e||b.width)&&me.Math.isPowerOfTwo(f||b.height),k=i.createTexture(),l=0===d.search(/^repeat(-x)?$/)&&j?i.REPEAT:i.CLAMP_TO_EDGE,m=0===d.search(/^repeat(-y)?$/)&&j?i.REPEAT:i.CLAMP_TO_EDGE;return i.activeTexture(i.TEXTURE0+a),i.bindTexture(i.TEXTURE_2D,k),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,l),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,m),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,c),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,c),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,"boolean"!=typeof h||h),e||f||g?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,f,g,i.RGBA,i.UNSIGNED_BYTE,b):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,b),k},uploadTexture:function(a,b,c,d,e){var f=this.renderer.cache.getUnit(a);return this.units[f]&&!e||(this.units[f]=!0,this.createTexture(f,a.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,a.repeat,b,c,d,a.premultipliedAlpha)),f},createIB:function(){for(var a=[0,1,2,2,1,3],b=new Array(96e3),c=0;c<b.length;c++)b[c]=a[c%6]+4*~~(c/6);return new Uint16Array(b)},resizeSB:function(){this.sbSize<<=1;var a=new Float32Array(9*this.sbSize*4);a.set(this.stream),this.stream=a},useShader:function(a){this.activeShader!==a&&(this.flush(),this.activeShader=a,this.activeShader.bind(),this.activeShader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix))},addQuad:function(a,b,c,d,e,f){var g=this.color.toArray(),h=this.tint.toArray();if(!(g[3]<1/255)){h[3]=g[3],this.useShader(this.quadShader),this.length>=16e3&&this.flush(),this.length>=this.sbSize&&this.resizeSB();var i=this.viewMatrix,j=this.v[0].set(c,d),k=this.v[1].set(c+e,d),l=this.v[2].set(c,d+f),m=this.v[3].set(c+e,d+f);i.isIdentity()||(i.multiplyVector(j),i.multiplyVector(k),i.multiplyVector(l),i.multiplyVector(m));var n=this.sbIndex,o=n+9,p=o+9,q=p+9;this.stream[n+0+0]=j.x,this.stream[n+0+1]=j.y,this.stream[o+0+0]=k.x,this.stream[o+0+1]=k.y,this.stream[p+0+0]=l.x,this.stream[p+0+1]=l.y,this.stream[q+0+0]=m.x,this.stream[q+0+1]=m.y,this.stream.set(h,n+2),this.stream.set(h,o+2),this.stream.set(h,p+2),this.stream.set(h,q+2);var r=this.uploadTexture(a);this.stream[n+6]=this.stream[o+6]=this.stream[p+6]=this.stream[q+6]=r;var s=a.getUVs(b);this.stream[n+7+0]=s[0],this.stream[n+7+1]=s[1],this.stream[o+7+0]=s[2],this.stream[o+7+1]=s[1],this.stream[p+7+0]=s[0],this.stream[p+7+1]=s[3],this.stream[q+7+0]=s[2],this.stream[q+7+1]=s[3],this.sbIndex+=36,this.length++}},flush:function(){if(this.length){var a=this.gl,b=9*this.length*4;a.bufferData(a.ARRAY_BUFFER,this.stream.subarray(0,b),a.STREAM_DRAW),a.drawElements(a.TRIANGLES,6*this.length,a.UNSIGNED_SHORT,0),this.sbIndex=0,this.length=0}},drawTriangle:function(f,g,h){var i=this.gl;g=g||f.length,this.useShader(this.primitiveShader);for(var j=0,k=this.viewMatrix,l=k.isIdentity(),m=0;m<f.length;m++)l||k.multiplyVector(f[m]),this.stream[j++]=f[m].x,this.stream[j++]=f[m].y;this.primitiveShader.setUniform("uColor",this.color),i.bufferData(i.ARRAY_BUFFER,this.stream.subarray(0,2*g),i.STREAM_DRAW),i.vertexAttribPointer(this.primitiveShader.attributes.aVertex,2,i.FLOAT,!1,0,0),i.drawArrays(!0===h?i.TRIANGLE_STRIP:i.TRIANGLES,0,g),i.vertexAttribPointer(this.quadShader.attributes.aVertex,2,i.FLOAT,!1,a,b),i.vertexAttribPointer(this.quadShader.attributes.aColor,4,i.FLOAT,!1,a,c),i.vertexAttribPointer(this.quadShader.attributes.aTexture,1,i.FLOAT,!1,a,d),i.vertexAttribPointer(this.quadShader.attributes.aRegion,2,i.FLOAT,!1,a,e)},drawLine:function(f,g,h){var i=this.gl;g=g||f.length,this.useShader(this.primitiveShader);for(var j=0,k=this.viewMatrix,l=k.isIdentity(),m=0;m<f.length;m++)l||k.multiplyVector(f[m]),this.stream[j++]=f[m].x,this.stream[j++]=f[m].y;this.primitiveShader.setUniform("uColor",this.color),i.bufferData(i.ARRAY_BUFFER,this.stream.subarray(0,2*g),i.STREAM_DRAW),i.vertexAttribPointer(this.primitiveShader.attributes.aVertex,2,i.FLOAT,!1,0,0),i.drawArrays(!0===h?i.LINE_STRIP:i.LINE_LOOP,0,g),i.vertexAttribPointer(this.quadShader.attributes.aVertex,2,i.FLOAT,!1,a,b),i.vertexAttribPointer(this.quadShader.attributes.aColor,4,i.FLOAT,!1,a,c),i.vertexAttribPointer(this.quadShader.attributes.aTexture,1,i.FLOAT,!1,a,d),i.vertexAttribPointer(this.quadShader.attributes.aRegion,2,i.FLOAT,!1,a,e)},clear:function(){this.flush(),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}})}(),function(){function a(a,b){var c,d={},e=/uniform\s+(\w+)\s+(\w+)/g,f={},h={},i={};return[b.vertex,b.fragment].forEach(function(a){for(;c=e.exec(a);)f[c[2]]=c[1]}),Object.keys(f).forEach(function(c){var d=f[c];i[c]=a.getUniformLocation(b.program,c),h[c]={get:function(a){return function(){return i[a]}}(c),set:function(b,c,d){return 0===c.indexOf("mat")?function(c){a[d](i[b],!1,c)}:function(c){var e=d;c.length&&"v"!==d.substr(-1)&&(e+="v"),a[e](i[b],c)}}(c,d,"uniform"+g[d])}}),Object.defineProperties(d,h),d}function b(a,b){for(var c,d={},e=/attribute\s+\w+\s+(\w+)/g,f=[];c=e.exec(b.vertex);)f.push(c[1]);return f.forEach(function(c){d[c]=a.getAttribLocation(b.program,c),a.enableVertexAttribArray(d[c])}),d}function c(a,b,c){var d=a.createShader(b);if(a.shaderSource(d,c),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw new Error(a.getShaderInfoLog(d));return d}function d(a,b,d){var e=c(a,a.VERTEX_SHADER,b),f=c(a,a.FRAGMENT_SHADER,d),g=a.createProgram();if(a.attachShader(g,e),a.attachShader(g,f),a.linkProgram(g),!a.getProgramParameter(g,a.LINK_STATUS))throw new Error("Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+a.getProgramParameter(g,a.VALIDATE_STATUS)+"\ngl.getError()"+a.getError()+"\ngl.getProgramInfoLog()"+a.getProgramInfoLog(g));return a.useProgram(g),a.deleteShader(e),a.deleteShader(f),g}function e(a,b){return"precision"!==a.substring(0,9)?"precision "+b+" float;"+a:a}function f(a){return a=a.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1"),a=a.replace(/(\\n\s+)|(\s+\\n)/g,""),a=a.replace(/(\\r|\\n)+/g,""),a=a.replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1")}var g={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};me.GLShader=me.Object.extend({init:function(c,g,h,i){return this.gl=c,this.vertex=e(f(g),i||me.device.getMaxShaderPrecision(this.gl)),this.fragment=e(f(h),i||me.device.getMaxShaderPrecision(this.gl)),this.program=d(this.gl,this.vertex,this.fragment),this.attributes=b(this.gl,this),this.uniforms=a(this.gl,this),me.event.subscribe(me.event.WEBGL_ONCONTEXT_LOST,this.destroy.bind(this)),this},bind:function(){this.gl.useProgram(this.program)},setUniform:function(a,b){var c=this.uniforms;if(void 0===c[a])throw new Error("undefined ("+a+") uniform for shader "+this);"object"===_typeof(b)&&"function"==typeof b.toArray?c[a]=b.toArray():c[a]=b},destroy:function(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}})}(),function(){me.PrimitiveGLShader=me.GLShader.extend({init:function(a){return me.GLShader.prototype.init.apply(this,[a,["precision highp float;","// Current vertex point","attribute vec2 aVertex;","// Projection matrix","uniform mat3 uProjectionMatrix;","// Vertex color","uniform vec4 uColor;","// Fragment color","varying vec4 vColor;","void main(void) {","    // Transform the vertex position by the projection matrix","    gl_Position = vec4((uProjectionMatrix * vec3(aVertex, 1.0)).xy, 0.0, 1.0);","    // Pass the remaining attributes to the fragment shader","    vColor = vec4(uColor.rgb * uColor.a, uColor.a);","}"].join("\n"),["// fragment color","varying vec4 vColor;","void main(void) {","    gl_FragColor = vColor;","}"].join("\n")]),this}})}(),function(){me.QuadGLShader=me.GLShader.extend({init:function(a,b){return me.GLShader.prototype.init.apply(this,[a,["precision highp float;","attribute vec2 aVertex;","attribute vec4 aColor;","attribute float aTexture;","attribute vec2 aRegion;","uniform mat3 uProjectionMatrix;","varying vec4 vColor;","varying float vTexture;","varying vec2 vRegion;","void main(void) {","    // Transform the vertex position by the projection matrix","    gl_Position = vec4((uProjectionMatrix * vec3(aVertex, 1.0)).xy, 0.0, 1.0);","    // Pass the remaining attributes to the fragment shader","    vColor = vec4(aColor.rgb * aColor.a, aColor.a);","    vTexture = aTexture;","    vRegion = aRegion;","}"].join("\n"),["uniform sampler2D uSampler["+b+"];","varying vec4 vColor;","varying float vTexture;","varying vec2 vRegion;","void main(void) {","    // Convert texture unit index to integer","    int texture = int(vTexture);","    if (texture == 0) {","        gl_FragColor = texture2D(uSampler[0], vRegion) * vColor;","    }","    else {","        for (int i = 1; i < "+(b-1)+"; i++) {","            if (texture == i) {","                gl_FragColor = texture2D(uSampler[i], vRegion) * vColor;","                return;","            }","            gl_FragColor = texture2D(uSampler["+(b-1)+"], vRegion) * vColor;","        };","    }","}"].join("\n")]),this}})}(),function(){var a=new me.Vector2d;me.Pointer=me.Rect.extend({init:function(a,b,c,d){this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,me.Rect.prototype.init.apply(this,[a||0,b||0,c||1,d||1])},setEvent:function(b,c,d,e,f,g){var h=1,i=1;this.event=b,this.pageX=c||0,this.pageY=d||0,this.clientX=e||0,this.clientY=f||0,me.input.globalToLocal(this.pageX,this.pageY,this.pos),this.isNormalized=!me.device.PointerEvent||me.device.PointerEvent&&!(b instanceof window.PointerEvent),"wheel"===b.type&&(this.deltaMode=1,this.deltaX=b.deltaX,this.deltaY=-.025*b.wheelDelta,b.wheelDeltaX&&(this.deltaX=-.025*b.wheelDeltaX)),this.pointerId=void 0!==g?g:1,this.isPrimary=void 0===b.isPrimary||b.isPrimary,this.button=b.button||0,this.type=b.type,this.gameScreenX=this.pos.x,this.gameScreenY=this.pos.y,void 0!==me.game.viewport&&me.game.viewport.localToWorld(this.gameScreenX,this.gameScreenY,a),this.gameWorldX=a.x,this.gameWorldY=a.y,!1===this.isNormalized?(h=b.width||1,
i=b.height||1):"number"==typeof b.radiusX&&(h=2*b.radiusX||1,i=2*b.radiusY||1),this.resize(h,i)}})}(),function(){me.input={keyBoardEventTarget:null,pointerEventTarget:null,preventDefault:!0}}(),function(a){var b={},c={},d={},e={},f={},g={},h=function(a,c,h){c=c||a.keyCode||a.button;var i=g[c];if(me.event.publish(me.event.KEYDOWN,[i,c,!i||!d[i]]),i){if(!d[i]){var j=void 0!==h?h:c;e[i][j]||(b[i]++,e[i][j]=!0)}return!f[c]||"function"!=typeof a.preventDefault||a.preventDefault()}return!0},i=function(a,c,h){c=c||a.keyCode||a.button;var i=g[c];if(me.event.publish(me.event.KEYUP,[i,c]),i){var j=void 0!==h?h:c;return e[i][j]=void 0,b[i]>0&&b[i]--,d[i]=!1,!f[c]||"function"!=typeof a.preventDefault||a.preventDefault()}return!0};a.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},a.initKeyboardEvent=function(){null===me.input.keyBoardEventTarget&&!1===me.device.isMobile&&(me.input.keyBoardEventTarget=window,me.input.keyBoardEventTarget.addEventListener("keydown",h,!1),me.input.keyBoardEventTarget.addEventListener("keyup",i,!1))},a.isKeyPressed=function(a){return!(!b[a]||d[a])&&(c[a]&&(d[a]=!0),!0)},a.keyStatus=function(a){return b[a]>0},a.triggerKeyEvent=function(a,b,c){b?h({},a,c):i({},a,c)},a.bindKey=function(a,h,i,j){"boolean"!=typeof j&&(j=me.input.preventDefault),g[a]=h,f[a]=j,b[h]=0,c[h]=i||!1,d[h]=!1,e[h]={}},a.getBindingKey=function(a){return g[a]},a.unlockKey=function(a){d[a]=!1},a.unbindKey=function(a){var d=g[a];b[d]=0,c[d]=!1,e[d]={},g[a]=null,f[a]=null}}(me.input),function(a){function b(b,c){for(var d=0;d<b.length;d++)-1===r.indexOf(b[d])&&me.input.pointerEventTarget.addEventListener(b[d],c,{passive:!1===a.preventDefault})}function c(){if(!n){for(var c=0;c<me.device.maxTouchPoints;c++)k.push(new me.Pointer);null===me.input.pointerEventTarget&&(me.input.pointerEventTarget=me.video.renderer.getScreenCanvas()),p=me.device.PointerEvent?y:z,me.device.touch&&!me.device.PointerEvent&&(p=p.concat(A)),b(p,j),void 0===a.throttlingInterval&&(a.throttlingInterval=~~(1e3/me.sys.fps)),!0===me.sys.autoFocus&&(me.device.focus(),me.input.pointerEventTarget.addEventListener(p[2],function(){me.device.focus()},{passive:!1===a.preventDefault}));var d,f=e(p,r);if(a.throttlingInterval<17)for(d=0;d<f.length;d++)-1!==p.indexOf(f[d])&&me.input.pointerEventTarget.addEventListener(f[d],i,{passive:!0});else for(d=0;d<f.length;d++)-1!==p.indexOf(f[d])&&me.input.pointerEventTarget.addEventListener(f[d],me.utils.function.throttle(i,a.throttlingInterval,!1),{passive:!0});me.input.setTouchAction(me.input.pointerEventTarget),n=!0}}function d(a,b){for(var c=0;c<b.length;c++){if(-1!==a.indexOf(b[c]))return b[c]}}function e(a,b){for(var c=[],d=0;d<b.length;d++){-1!==a.indexOf(b[d])&&c.push(b[d])}return c}function f(a,b,c,d){var e;if(a.callbacks[b]){a.pointerId=d;for(var f=a.callbacks[b].length-1;f>=0&&(e=a.callbacks[b][f]);f--)if(!1===e(c))return!0}return!1}function g(a){for(var b=!1;a.length>0;){var c=a.pop();if(k.push(c),void 0!==c.event.timeStamp){if(c.event.timeStamp<o)continue;o=c.event.timeStamp}m.setShape(c.gameWorldX,c.gameWorldY,c.width,c.height),r.includes(c.type)&&(c.gameX=c.gameLocalX=c.gameScreenX,c.gameY=c.gameLocalY=c.gameScreenY,me.event.publish(me.event.POINTERMOVE,[c]));var e=me.collision.quadTree.retrieve(m,me.Container.prototype._sortReverseZ);e=e.concat([me.game.viewport]);for(var g,h=e.length;h--,g=e[h];){if(l.has(g)&&!0!==g.isKinematic){var i=l.get(g),j=i.region,n=j.ancestor,q=j.getBounds(),s=!1;if(!0===j.floating?(c.gameX=c.gameLocalX=c.gameScreenX,c.gameY=c.gameLocalY=c.gameScreenY):(c.gameX=c.gameLocalX=c.gameWorldX,c.gameY=c.gameLocalY=c.gameWorldY),void 0!==n){var w=n.getBounds().pos;c.gameLocalX=c.gameX-w.x,c.gameLocalY=c.gameY-w.y}if(j instanceof me.Sprite){var y=c.gameX,z=c.gameY;if(!j.currentTransform.isIdentity()){var A=j.currentTransform.multiplyVectorInverse(me.pool.pull("me.Vector2d",y,z));y=A.x,z=A.y,me.pool.push(A)}s=q.containsPoint(y,z)}else s=q.containsPoint(c.gameX,c.gameY)&&(q===j||j.containsPoint(c.gameLocalX,c.gameLocalY));switch(c.type){case r[0]:case r[1]:case r[2]:case r[3]:if(i.pointerId!==c.pointerId||s){if(null===i.pointerId&&s&&f(i,d(p,v),c,c.pointerId)){b=!0;break}}else if(f(i,d(p,x),c,null)){b=!0;break}if(s&&f(i,c.type,c,c.pointerId)){b=!0;break}break;case t[0]:case t[1]:case t[2]:case t[3]:if(i.pointerId===c.pointerId&&s&&f(i,c.type,c,null)){b=!0;break}break;case u[0]:case u[1]:case u[2]:case u[3]:if(i.pointerId===c.pointerId&&f(i,c.type,c,null)){b=!0;break}break;default:if(s&&f(i,c.type,c,c.pointerId)){b=!0;break}}}if(!0===b)break}}return b}function h(b){var c;if(me.device.TouchEvent&&b.changedTouches)for(var d=0,e=b.changedTouches.length;d<e;d++){var f=b.changedTouches[d];c=k.pop(),c.setEvent(b,f.pageX,f.pageY,f.clientX,f.clientY,f.identifier),C.push(c)}else c=k.pop(),c.setEvent(b,b.pageX,b.pageY,b.clientX,b.clientY,b.pointerId),C.push(c);return!1===b.isPrimary?C:(C[0].isPrimary=!0,Object.assign(a.pointer,C[0]),C)}function i(a){g(h(a))}function j(b){h(b);var c=C[0].button;(g(C)||"wheel"===b.type)&&!0===a.preventDefault&&b.preventDefault();var d=a.pointer.bind[c];d&&me.input.triggerKeyEvent(d,s.includes(b.type),c+1)}var k=[],l=new Map,m=new me.Rect(0,0,1,1),n=!1,o=0,p=[],q=["wheel"],r=["pointermove","mousemove","touchmove"],s=["pointerdown","mousedown","touchstart"],t=["pointerup","mouseup","touchend"],u=["pointercancel","mousecancel","touchcancel"],v=["pointerenter","mouseenter","touchenter"],w=["pointerover","mouseover","touchover"],x=["pointerleave","mouseleave","touchleave"],y=[q[0],r[0],s[0],t[0],u[0],v[0],w[0],x[0]],z=[q[0],r[1],s[1],t[1],u[1],v[1],w[1],x[1]],A=[r[2],s[2],t[2],u[2],v[2],w[2],x[2]],B={wheel:q,pointermove:r,pointerdown:s,pointerup:t,pointercancel:u,pointerenter:v,pointerover:w,pointerleave:x},C=[];a.pointer=new me.Pointer(0,0,1,1),a.pointer.bind=[0,0,0],a.pointer.LEFT=0,a.pointer.MIDDLE=1,a.pointer.RIGHT=2,a.throttlingInterval=void 0,a.globalToLocal=function(a,b,c){c=c||new me.Vector2d;var d=me.video.renderer.getBounds(),e=me.device.devicePixelRatio;a-=d.left,b-=d.top;var f=me.sys.scale;return 1===f.x&&1===f.y||(a/=f.x,b/=f.y),c.set(a*e,b*e)},a.setTouchAction=function(a,b){a.style["touch-action"]=b||"none"},a.bindPointer=function(){var b=arguments.length<2?a.pointer.LEFT:arguments[0],d=arguments.length<2?arguments[0]:arguments[1];if(c(),!me.input.getBindingKey(d))throw new Error("no action defined for keycode "+d);a.pointer.bind[b]=d},a.unbindPointer=function(b){a.pointer.bind[void 0===b?a.pointer.LEFT:b]=null},a.registerPointerEvent=function(a,b,d){if(c(),-1===y.indexOf(a))throw new Error("invalid event type : "+a);if(void 0===b)throw new Error("registerPointerEvent: region for "+b+" event is undefined ");var f=e(p,B[a]);l.has(b)||l.set(b,{region:b,callbacks:{},pointerId:null});for(var g=l.get(b),h=0;h<f.length;h++)a=f[h],g.callbacks[a]?g.callbacks[a].push(d):g.callbacks[a]=[d]},a.releasePointerEvent=function(a,b,c){if(-1===y.indexOf(a))throw new Error("invalid event type : "+a);var d=e(p,B[a]),f=l.get(b);if(void 0!==f){for(var g=0;g<d.length;g++)if(a=d[g],f.callbacks[a]){if(void 0!==c)me.utils.array.remove(f.callbacks[a],c);else for(;f.callbacks[a].length>0;)f.callbacks[a].pop();0===f.callbacks[a].length&&delete f.callbacks[a]}0===Object.keys(f.callbacks).length&&l.delete(b)}}}(me.input),function(a){function b(a){return a}function c(b,c,d){return d===a.GAMEPAD.BUTTONS.L2||d===a.GAMEPAD.BUTTONS.R2?(b+1)/2:b}function d(b,c,d){return b=b>0?d===a.GAMEPAD.BUTTONS.L2?Math.max(0,b-2e4)/111070:(b-1)/131070:(65536+b)/131070+.5}function e(a,c){var d=a.replace(h,function(a,b,c){return"000".substr(b.length-1)+b+"-"+"000".substr(c.length-1)+c+"-"}),e=a.replace(h,function(a,b,c){return b.replace(i,"")+"-"+c.replace(i,"")+"-"});c.analog=c.analog||c.buttons.map(function(){return-1}),c.normalize_fn=c.normalize_fn||b,k.set(d,c),k.set(e,c)}var f,g=.1,h=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,i=/^0+/,j={},k=new Map;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:c}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:d}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:d}]].forEach(function(a){e(a[0],a[1])});var l=function(){var b=navigator.getGamepads(),c={};Object.keys(j).forEach(function(d){var e=b[d];if(e){var f=null;"standard"!==e.mapping&&(f=k.get(e.id));var h=j[d];Object.keys(h.buttons).forEach(function(b){var i=h.buttons[b],j=b,k=-1;if(!(f&&(j=f.buttons[b],k=f.analog[b],j<0&&k<0))){var l=e.buttons[j]||{};if(f&&k>=0){var m=f.normalize_fn(e.axes[k],-1,+b);l={value:m,pressed:l.pressed||Math.abs(m)>=g}}me.event.publish(me.event.GAMEPAD_UPDATE,[d,"buttons",+b,l]),!i.pressed&&l.pressed?a._keydown(c,i.keyCode,j+256):i.pressed&&!l.pressed&&a._keyup(c,i.keyCode,j+256),i.value=l.value,i.pressed=l.pressed}}),Object.keys(h.axes).forEach(function(b){var i=h.axes[b],j=b;if(!(f&&(j=f.axes[b])<0)){var k=e.axes[j];if(void 0!==k){f&&(k=f.normalize_fn(k,+b,-1));var l=Math.sign(k)||1;if(0!==i[l].keyCode){var m=Math.abs(k)>=g+Math.abs(i[l].threshold);me.event.publish(me.event.GAMEPAD_UPDATE,[d,"axes",+b,k]),!i[l].pressed&&m?(i[-l].pressed&&(a._keyup(c,i[-l].keyCode,j+256),i[-l].value=0,i[-l].pressed=!1),a._keydown(c,i[l].keyCode,j+256)):!i[l].pressed&&!i[-l].pressed||m||(l=i[l].pressed?l:-l,a._keyup(c,i[l].keyCode,j+256)),i[l].value=k,i[l].pressed=m}}}})}})};window.addEventListener("gamepadconnected",function(a){me.event.publish(me.event.GAMEPAD_CONNECTED,[a.gamepad])},!1),window.addEventListener("gamepaddisconnected",function(a){me.event.publish(me.event.GAMEPAD_DISCONNECTED,[a.gamepad])},!1),a.GAMEPAD={AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}},a.bindGamepad=function(a,b,c){if(!me.input.getBindingKey(c))throw new Error("no action defined for keycode "+c);void 0===f&&navigator.getGamepads&&(f=me.event.subscribe(me.event.GAME_UPDATE,l)),j[a]||(j[a]={axes:{},buttons:{}});var d={keyCode:c,value:0,pressed:!1,threshold:b.threshold},e=j[a][b.type];if("buttons"===b.type)e[b.code]=d;else if("axes"===b.type){var g=Math.sign(b.threshold)||1;e[b.code]||(e[b.code]={});var h=e[b.code];h[g]=d,h[-g]||(h[-g]={keyCode:0,value:0,pressed:!1,threshold:-g})}},a.unbindGamepad=function(a,b){if(!j[a])throw new Error("no bindings for gamepad "+a);j[a].buttons[b]={}},a.setGamepadDeadzone=function(a){g=a},a.setGamepadMapping=e}(me.input),function(){me.utils=function(){var a={},b="",c=0;return a.getPixels=function(a){if(a instanceof HTMLImageElement){var b=me.CanvasRenderer.getContext2d(me.video.createCanvas(a.width,a.height));return b.drawImage(a,0,0),b.getImageData(0,0,a.width,a.height)}return a.getContext("2d").getImageData(0,0,a.width,a.height)},a.checkVersion=function(a,b){b=b||me.version;for(var c=a.split("."),d=b.split("."),e=Math.min(c.length,d.length),f=0,g=0;g<e&&!(f=+c[g]-+d[g]);g++);return f||c.length-d.length},a.getUriFragment=function(a){var b={},c=!1;return function(a){var d;if(void 0===a){if(d=b,!0===c)return d;a=document.location,c=!0}else d={};return a&&a.hash&&a.hash.substr(1).split("&").filter(function(a){return""!==a}).forEach(function(a){var b=a.split("="),c=b.shift(),e=b.join("=");d[c]=e||!0}),d}}(),a.resetGUID=function(a,d){b=me.utils.string.toHex(a.toString().toUpperCase()),c=d||0},a.createGUID=function(a){return c+=a||1,b+"-"+(a||c)},a}()}(),function(a){var b=function(){var a={},b=/^.*(\\|\/|\:)/,c=/\.[^\.]*$/;return a.getBasename=function(a){return a.replace(b,"").replace(c,"")},a.getExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)},a}();a.file=b}(me.utils),function(a){var b=function(){var a={};return a.defer=function(a,b){var c=Array.prototype.slice.call(arguments,1);return setTimeout(a.bind.apply(a,c),.01)},a.throttle=function(a,b,c){var d,e=window.performance.now();return"boolean"!=typeof c&&(c=!1),function(){var f=window.performance.now(),g=f-e,h=arguments;if(!(g<b))return e=f,a.apply(null,h);!1===c&&(clearTimeout(d),d=setTimeout(function(){return e=f,a.apply(null,h)},g))}},a}();a.function=b}(me.utils),function(a){var b=function(){var a={};return a.remove=function(a,b){var c=Array.prototype.indexOf.call(a,b);return-1!==c&&Array.prototype.splice.call(a,c,1),a},a.random=function(a){return a[me.Math.random(0,a.length)]},a.weightedRandom=function(a){return a[me.Math.weightedRandom(0,a.length)]},a}();a.array=b}(me.utils),function(a){var b=function(){var a={};return a.trimLeft=function(a){return a.replace(/^\s+/,"")},a.trimRight=function(a){return a.replace(/\s+$/,"")},a.isNumeric=function(a){return!isNaN(a)&&""!==a.trim()},a.isBoolean=function(a){var b=a.trim();return"true"===b||"false"===b},a.toHex=function(a){for(var b="",c=0;c<a.length;)b+=a.charCodeAt(c++).toString(16);return b},a}();a.string=b}(me.utils),function(){var a=function(a){return"0123456789ABCDEF".charAt(a-a%16>>4)+"0123456789ABCDEF".charAt(a%16)},b=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,c=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,d=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,e=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,f=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,g=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach(function(a){g.set(a[0],a[1])}),me.Color=me.Object.extend({init:function(a,b,c,d){return void 0===this.glArray&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(a,b,c,d)},setColor:function(a,b,c,d){return a instanceof me.Color?(this.glArray.set(a.glArray),a):(this.r=a,this.g=b,this.b=c,this.alpha=d,this)},clone:function(){return me.pool.pull("me.Color",this)},copy:function(a){return a instanceof me.Color?(this.glArray.set(a.glArray),this):this.parseCSS(a)},add:function(a){return this.glArray[0]=me.Math.clamp(this.glArray[0]+a.glArray[0],0,1),this.glArray[1]=me.Math.clamp(this.glArray[1]+a.glArray[1],0,1),this.glArray[2]=me.Math.clamp(this.glArray[2]+a.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+a.glArray[3])/2,this},darken:function(a){return a=me.Math.clamp(a,0,1),this.glArray[0]*=a,this.glArray[1]*=a,this.glArray[2]*=a,this},lighten:function(a){return a=me.Math.clamp(a,0,1),this.glArray[0]=me.Math.clamp(this.glArray[0]+(1-this.glArray[0])*a,0,1),this.glArray[1]=me.Math.clamp(this.glArray[1]+(1-this.glArray[1])*a,0,1),this.glArray[2]=me.Math.clamp(this.glArray[2]+(1-this.glArray[2])*a,0,1),this},random:function(){return this.setColor(256*Math.random(),256*Math.random(),256*Math.random(),this.alpha)},equals:function(a){return this.glArray[0]===a.glArray[0]&&this.glArray[1]===a.glArray[1]&&this.glArray[2]===a.glArray[2]&&this.glArray[3]===a.glArray[3]},parseCSS:function(a){return g.has(a)?this.setColor.apply(this,g.get(a)):this.parseRGB(a)},parseRGB:function(a){var c=b.exec(a);return c?this.setColor(+c[1],+c[2],+c[3],+c[5]):this.parseHex(a)},parseHex:function(a){var b;if(b=f.exec(a))return this.setColor(parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16),(me.Math.clamp(parseInt(b[4],16),0,255)/255).toFixed(1));if(b=e.exec(a))return this.setColor(parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16));if(b=d.exec(a))return this.setColor(parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16),(me.Math.clamp(parseInt(b[4]+b[4],16),0,255)/255).toFixed(1));if(b=c.exec(a))return this.setColor(parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16));throw new Error("invalid parameter: "+a)},toArray:function(){return this.glArray},toHex:function(){return"#"+a(this.r)+a(this.g)+a(this.b)},toHex8:function(){return"#"+a(this.r)+a(this.g)+a(this.b)+a(255*this.alpha)},toRGB:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},toRGBA:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")"}}),Object.defineProperty(me.Color.prototype,"r",{get:function(){return~~(255*this.glArray[0])},set:function(a){this.glArray[0]=me.Math.clamp(~~a||0,0,255)/255},enumerable:!0,configurable:!0}),Object.defineProperty(me.Color.prototype,"g",{get:function(){return~~(255*this.glArray[1])},set:function(a){this.glArray[1]=me.Math.clamp(~~a||0,0,255)/255},enumerable:!0,configurable:!0}),Object.defineProperty(me.Color.prototype,"b",{get:function(){return~~(255*this.glArray[2])},set:function(a){this.glArray[2]=me.Math.clamp(~~a||0,0,255)/255},enumerable:!0,configurable:!0}),Object.defineProperty(me.Color.prototype,"alpha",{get:function(){return this.glArray[3]},set:function(a){this.glArray[3]=void 0===a?1:me.Math.clamp(+a,0,1)},enumerable:!0,configurable:!0})}(),function(){me.save=function(){function a(a){return"add"===a||"remove"===a}var b={},c={init:function(){if(!0===me.device.localStorage){var a=localStorage.getItem("me.save");if("string"==typeof a&&a.length>0){(JSON.parse(a)||[]).forEach(function(a){b[a]=JSON.parse(localStorage.getItem("me.save."+a))})}}},add:function(d){Object.keys(d).forEach(function(e){a(e)||(!function(a){Object.defineProperty(c,a,{configurable:!0,enumerable:!0,get:function(){return b[a]},set:function(c){b[a]=c,!0===me.device.localStorage&&localStorage.setItem("me.save."+a,JSON.stringify(c))}})}(e),e in b||(c[e]=d[e]))}),!0===me.device.localStorage&&localStorage.setItem("me.save",JSON.stringify(Object.keys(b)))},remove:function(c){a(c)||void 0!==b[c]&&(delete b[c],!0===me.device.localStorage&&(localStorage.removeItem("me.save."+c),localStorage.setItem("me.save",JSON.stringify(Object.keys(b)))))}};return c}()}(),function(){me.levelDirector=function(){function a(a,g,h){g.container.reset(),me.game.reset(),d[c.getCurrentLevelId()]&&d[c.getCurrentLevelId()].destroy(),f=e.indexOf(a),b(a,g.container,g.flatten,g.setViewportBounds),me.event.publish(me.event.LEVEL_LOADED,[a]),g.onLoaded(a),h&&me.state.restart()}function b(a,b,c,e){function f(){b.pos.set(Math.max(0,~~((me.game.viewport.width-j.width)/2)),Math.max(0,~~((me.game.viewport.height-j.height)/2)),0)}var h=d[a],i=b.autoSort;b.autoSort=!1;var j=h.getBounds();e&&me.game.viewport.setBounds(0,0,Math.max(j.width,me.game.viewport.width),Math.max(j.height,me.game.viewport.height)),me.utils.resetGUID(a,h.nextobjectid),b.anchorPoint.set(0,0),h.addTo(b,c),b.sort(!0),b.autoSort=i,b.resize(j.width,j.height),e&&(f(),g&&me.event.unsubscribe(g),g=me.event.subscribe(me.event.VIEWPORT_ONRESIZE,f))}var c={},d={},e=[],f=0,g=null;return c.init=function(){},c.reset=function(){},c.addLevel=function(){throw new Error("no level loader defined")},c.addTMXLevel=function(a,b){return null==d[a]&&(d[a]=new me.TMXTileMap(a,me.loader.getTMX(a)),e.push(a),b&&b(),!0)},c.loadLevel=function(b,c){if(c=Object.assign({container:me.game.world,onLoaded:me.game.onLevelLoaded,flatten:me.game.mergeGroup,setViewportBounds:!0},c||{}),void 0===d[b])throw new Error("level "+b+" not found");if(!(d[b]instanceof me.TMXTileMap))throw new Error("no level loader defined");return me.state.isRunning()?(me.state.stop(),me.utils.function.defer(a,this,b,c,!0)):a(b,c),!0},c.getCurrentLevelId=function(){return e[f]},c.getCurrentLevel=function(){return d[c.getCurrentLevelId()]},c.reloadLevel=function(a){return c.loadLevel(c.getCurrentLevelId(),a)},c.nextLevel=function(a){return f+1<e.length&&c.loadLevel(e[f+1],a)},c.previousLevel=function(a){return f-1>=0&&c.loadLevel(e[f-1],a)},c.levelCount=function(){return e.length},c}()}(),function(){me.TMXUtils=function(){function setTMXValue(name,type,value){var match;if("string"!=typeof value)return value;switch(type){case"int":case"float":value=Number(value);break;case"bool":value="true"===value;break;default:if(!value||me.utils.string.isBoolean(value))value=!value||"true"===value;else if(me.utils.string.isNumeric(value))value=Number(value);else if(0===value.search(/^json:/i)){match=value.split(/^json:/i)[1];try{value=JSON.parse(match)}catch(a){throw new Error("Unable to parse JSON: "+match)}}else if(0===value.search(/^eval:/i)){match=value.split(/^eval:/i)[1];try{value=eval(match)}catch(a){throw new Error("Unable to evaluate: "+match)}}else((match=value.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(match=value.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(value="#"+match[2]+match[1]);0===name.search(/^(ratio|anchorPoint)$/)&&"number"==typeof value&&(value={x:value,y:value})}return value}function parseAttributes(a,b){if(b.attributes&&b.attributes.length>0)for(var c=0;c<b.attributes.length;c++){var d=b.attributes.item(c);void 0!==d.name?a[d.name]=d.value:a[d.nodeName]=d.nodeValue}}var api={};return api.decompress=function(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},api.decodeCSV=function(a){for(var b=a.replace("\n","").trim().split(","),c=[],d=0;d<b.length;d++)c.push(+b[d]);return c},api.decodeBase64AsArray=function(a,b){b=b||1;var c,d,e,f=window.atob(a.replace(/[^A-Za-z0-9\+\/\=]/g,"")),g=new Uint32Array(f.length/b);for(c=0,e=f.length/b;c<e;c++)for(g[c]=0,d=b-1;d>=0;--d)g[c]+=f.charCodeAt(c*b+d)<<(d<<3);return g},api.decode=function(a,b,c){switch(c=c||"none",b=b||"none"){case"csv":return api.decodeCSV(a);case"base64":var d=api.decodeBase64AsArray(a,4);return"none"===c?d:api.decompress(d,c);case"none":return a;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+b)}},api.normalize=function(a,b){var c=b.nodeName;switch(c){case"data":var d=api.parse(b);d.text=d.text||d.chunk.text,d.encoding=d.encoding||"xml",a.data=api.decode(d.text,d.encoding,d.compression),a.encoding="none";break;case"imagelayer":case"layer":case"objectgroup":case"group":var e=api.parse(b);e.type="layer"===c?"tilelayer":c,e.image&&(e.image=e.image.source),a.layers=a.layers||[],a.layers.push(e);break;case"animation":a.animation=api.parse(b).frames;break;case"frame":case"object":var f=c+"s";a[f]=a[f]||[],a[f].push(api.parse(b));break;case"tile":var g=api.parse(b);g.image&&(g.imagewidth=g.image.width,g.imageheight=g.image.height,g.image=g.image.source),a.tiles=a.tiles||{},a.tiles[g.id]=g;break;case"tileset":var h=api.parse(b);h.image&&(h.imagewidth=h.image.width,h.imageheight=h.image.height,h.image=h.image.source),a.tilesets=a.tilesets||[],a.tilesets.push(h);break;case"polygon":case"polyline":a[c]=[];for(var i,j=api.parse(b).points.split(" "),k=0;k<j.length;k++)i=j[k].split(","),a[c].push({x:+i[0],y:+i[1]});break;case"properties":a.properties=api.parse(b);break;case"property":var l=api.parse(b),m=void 0!==l.value?l.value:l.text;a[l.name]=setTMXValue(l.name,l.type||"string",m);break;default:a[c]=api.parse(b)}},api.parse=function(a){var b={},c="";if(1===a.nodeType&&parseAttributes(b,a),a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes.item(d);switch(e.nodeType){case 1:api.normalize(b,e);break;case 3:c+=e.nodeValue.trim()}}return c&&(b.text=c),b},api.applyTMXProperties=function(a,b){var c=b.properties,d=b.propertytypes;if(void 0!==c)for(var e in c)if(c.hasOwnProperty(e)){var f="string",g=e,h=c[e];void 0!==c[e].name&&(g=c[e].name),void 0!==d?f=d[e]:void 0!==c[e].type&&(f=c[e].type),void 0!==c[e].value&&(h=c[e].value),a[g]=setTMXValue(g,f,h)}},api}()}(),function(){me.TMXGroup=me.Object.extend({init:function(a,b,c){this.name=b.name,this.width=b.width||0,this.height=b.height||0,this.z=c,this.objects=[];var d=void 0===b.visible||b.visible;this.opacity=!0===d?me.Math.clamp(+b.opacity||1,0,1):0,me.TMXUtils.applyTMXProperties(this,b);var e=this;if(b.objects){b.objects.forEach(function(b){e.objects.push(new me.TMXObject(a,b,c))})}if(b.layers){b.layers.forEach(function(b){var d=new me.TMXLayer(b,a.tilewidth,a.tileheight,a.orientation,a.tilesets,c++);d.setRenderer(a.getRenderer()),e.width=Math.max(e.width,d.width),e.height=Math.max(e.height,d.height),e.objects.push(d)})}},destroy:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(a){return this.objects[a]}})}(),function(){me.TMXObject=me.Object.extend({init:function(a,b,c){this.points=void 0,this.name=b.name,this.x=+b.x,this.y=+b.y,this.z=+c,this.width=+b.width||0,this.height=+b.height||0,this.gid=+b.gid||null,this.type=b.type,this.type=b.type,this.rotation=me.Math.degToRad(+b.rotation||0),this.id=+b.id||void 0,this.orientation=a.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid?this.setTile(a.tilesets):void 0!==b.ellipse?this.isEllipse=!0:void 0!==b.polygon?(this.points=b.polygon,this.isPolygon=!0):void 0!==b.polyline&&(this.points=b.polyline,this.isPolyLine=!0),void 0!==b.text?(this.text=b.text,this.text.font=b.text.fontfamily||"sans-serif",this.text.size=b.text.pixelsize||16,this.text.fillStyle=b.text.color||"#000000",this.text.textAlign=b.text.halign||"left",this.text.textBaseline=b.text.valign||"top",this.text.width=this.width,this.text.height=this.height,me.TMXUtils.applyTMXProperties(this.text,b)):(me.TMXUtils.applyTMXProperties(this,b),this.shapes||(this.shapes=this.parseTMXShapes())),a.isEditor||a.getRenderer().adjustPosition(this)},setTile:function(a){var b=a.getTilesetByGid(this.gid);!1===b.isCollection&&(this.width=this.framewidth=b.tilewidth,this.height=this.frameheight=b.tileheight),this.tile=new me.Tile(this.x,this.y,this.gid,b)},parseTMXShapes:function(){var a=0,b=[];if(!0===this.isEllipse)b.push(new me.Ellipse(this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(!0===this.isPolygon)b.push(new me.Polygon(0,0,this.points).rotate(this.rotation));else if(!0===this.isPolyLine){var c,d,e=this.points,f=e.length-1;for(a=0;a<f;a++)c=new me.Vector2d(e[a].x,e[a].y),d=new me.Vector2d(e[a+1].x,e[a+1].y),0!==this.rotation&&(c=c.rotate(this.rotation),d=d.rotate(this.rotation)),b.push(new me.Line(0,0,[c,d]))}else b.push(new me.Polygon(0,0,[new me.Vector2d,new me.Vector2d(this.width,0),new me.Vector2d(this.width,this.height),new me.Vector2d(0,this.height)]).rotate(this.rotation));if("isometric"===this.orientation)for(a=0;a<b.length;a++)b[a].toIso();return b},getObjectPropertyByName:function(a){return this[a]}})}(),function(){me.Tile=me.Rect.extend({init:function(a,b,c,d){var e,f;if(d.isCollection){var g=d.getTileImage(536870911&c);e=g.width,f=g.height}else e=d.tilewidth,f=d.tileheight;me.Rect.prototype.init.apply(this,[a*e,b*f,e,f]),this.tileset=d,this.currentTransform=null,this.col=a,this.row=b,this.tileId=c,this.flippedX=0!=(2147483648&this.tileId),this.flippedY=0!=(1073741824&this.tileId),this.flippedAD=0!=(536870912&this.tileId),this.flipped=this.flippedX||this.flippedY||this.flippedAD,!0===this.flipped&&this.createTransform(),this.tileId&=536870911},createTransform:function(){null===this.currentTransform?this.currentTransform=new me.Matrix2d:this.currentTransform.identity(),this.flippedAD&&(this.currentTransform.setTransform(0,1,0,1,0,0,0,0,1),this.currentTransform.translate(0,this.height-this.width)),
this.flippedX&&(this.currentTransform.translate(this.flippedAD?0:this.width,this.flippedAD?this.height:0),this.currentTransform.scaleX(-1)),this.flippedY&&(this.currentTransform.translate(this.flippedAD?this.width:0,this.flippedAD?0:this.height),this.currentTransform.scaleY(-1))},getRenderable:function(a){var b,c=this.tileset;if(c.animations.has(this.tileId)){var d=[],e=[];c.animations.get(this.tileId).frames.forEach(function(a){e.push(a.tileid),d.push({name:""+a.tileid,delay:a.duration})}),b=c.texture.createAnimationFromName(e,a),b.addAnimation(this.tileId-c.firstgid,d),b.setCurrentAnimation(this.tileId-c.firstgid)}else if(!0===c.isCollection){var f=c.getTileImage(this.tileId);b=new me.Sprite(0,0,Object.assign({image:f})),b.anchorPoint.set(0,0),b.scale(a.width/this.width,a.height/this.height),void 0!==a.rotation&&(b.anchorPoint.set(.5,.5),b.currentTransform.rotate(a.rotation),b.currentTransform.translate(a.width/2,a.height/2),a.rotation=void 0)}else b=c.texture.createSpriteFromName(this.tileId-c.firstgid,a);return this.flippedX&&b.currentTransform.scaleX(-1),this.flippedY&&b.currentTransform.scaleY(-1),b}})}(),function(){me.TMXTileset=me.Object.extend({init:function(a){var b=0;if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+a.firstgid,void 0!==a.source){var c=a.source,d=me.utils.file.getExtension(c);if(("tsx"===d||"json"===d)&&!(a=me.loader.getTMX(me.utils.file.getBasename(c))))throw new Error(c+" external TSX/JSON tileset not found")}this.name=a.name,this.tilewidth=+a.tilewidth,this.tileheight=+a.tileheight,this.spacing=+a.spacing||0,this.margin=+a.margin||0,this.tileoffset=new me.Vector2d,this.isAnimated=!1,this.isCollection=!1,this.animations=new Map,this._lastUpdate=0;var e=a.tiles;for(b in e)if(e.hasOwnProperty(b)&&("animation"in e[b]&&(this.isAnimated=!0,this.animations.set(+b+this.firstgid,{dt:0,idx:0,frames:e[b].animation,cur:e[b].animation[0]})),"properties"in e[b]&&this.setTileProperty(+b+this.firstgid,e[b].properties),"image"in e[b])){var f=me.loader.getImage(e[b].image);if(!f)throw new Error("melonJS: '"+e[b].image+"' file for tile '"+(+b+this.firstgid)+"' not found!");this.imageCollection[+b+this.firstgid]=f}this.isCollection=this.imageCollection.length>0;var g=a.tileoffset;g&&(this.tileoffset.x=+g.x,this.tileoffset.y=+g.y);var h=a.tileproperties;if(h)for(b in h)h.hasOwnProperty(b)&&this.setTileProperty(+b+this.firstgid,h[b]);if(!1===this.isCollection){if(this.image=me.loader.getImage(a.image),!this.image)throw new Error("melonJS: '"+a.image+"' file for tileset '"+this.name+"' not found!");this.texture=me.video.renderer.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();var i=+a.columns||~~(this.image.width/(this.tilewidth+this.spacing)),j=~~(this.image.height/(this.tileheight+this.spacing));this.lastgid=this.firstgid+(i*j-1||0),a.tilecount&&this.lastgid-this.firstgid+1!=+a.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+a.tilecount+")")}},getTileImage:function(a){return this.imageCollection[a]},setTileProperty:function(a,b){this.TileProperties[a]=b},contains:function(a){return a>=this.firstgid&&a<=this.lastgid},getViewTileId:function(a){return this.animations.has(a)?a=this.animations.get(a).cur.tileid:a-=this.firstgid,a},getTileProperties:function(a){return this.TileProperties[a]},update:function(a){var b=0,c=me.timer.getTime(),d=!1;return this._lastUpdate!==c&&(this._lastUpdate=c,this.animations.forEach(function(c){for(c.dt+=a,b=c.cur.duration;c.dt>=b;)c.dt-=b,c.idx=(c.idx+1)%c.frames.length,c.cur=c.frames[c.idx],b=c.cur.duration,d=!0})),d},drawTile:function(a,b,c,d){if(d.flipped&&(a.save(),a.translate(b,c),a.transform(d.currentTransform),b=c=0),!0===this.isCollection)a.drawImage(this.imageCollection[d.tileId],0,0,d.width,d.height,b,c,d.width,d.height);else{var e=this.atlas[this.getViewTileId(d.tileId)].offset;a.drawImage(this.image,e.x,e.y,this.tilewidth,this.tileheight,b,c,this.tilewidth+a.uvOffset,this.tileheight+a.uvOffset)}d.flipped&&a.restore()}}),me.TMXTilesetGroup=me.Object.extend({init:function(){this.tilesets=[],this.length=0},add:function(a){this.tilesets.push(a),this.length++},getTilesetByIndex:function(a){return this.tilesets[a]},getTilesetByGid:function(a){var b=-1;a&=536870911;for(var c=0,d=this.tilesets.length;c<d;c++){if(this.tilesets[c].contains(a))return this.tilesets[c];this.tilesets[c].firstgid===this.tilesets[c].lastgid&&a>=this.tilesets[c].firstgid&&(b=c)}if(-1!==b)return this.tilesets[b];throw new Error("no matching tileset found for gid "+a)}})}(),function(){function a(a){a.layerData=new Array(a.cols);for(var b=0;b<a.cols;b++){a.layerData[b]=new Array(a.rows);for(var c=0;c<a.rows;c++)a.layerData[b][c]=null}}function b(b,c){var d=0;a(b);for(var e=0;e<b.rows;e++)for(var f=0;f<b.cols;f++){var g=c[d++];0!==g&&b.setTile(f,e,g)}}me.TMXLayer=me.Renderable.extend({init:function(a,c,d,e,f,g){me.Renderable.prototype.init.apply(this,[0,0,0,0]),this.tilewidth=a.tilewidth||c,this.tileheight=a.tileheight||d,this.orientation=e,this.tilesets=f,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(var h=0;h<this.tilesets.length;h++){var i=this.tilesets.getTilesetByIndex(h);this.maxTileSize.width=Math.max(this.maxTileSize.width,i.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,i.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=a.renderorder||"right-down",this.pos.z=g,this.anchorPoint.set(0,0),this.name=a.name,this.cols=+a.width,this.rows=+a.height;var j=void 0!==a.visible?+a.visible:1;this.setOpacity(j?+a.opacity:0),"isometric"===this.orientation?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),me.TMXUtils.applyTMXProperties(this,a),void 0===this.preRender&&(this.preRender=me.sys.preRender),b(this,me.TMXUtils.decode(a.data,a.encoding,a.compression))},onActivateEvent:function(){if(void 0===this.animatedTilesets&&(this.animatedTilesets=[]),this.tilesets)for(var a=this.tilesets.tilesets,b=0;b<a.length;b++)a[b].isAnimated&&this.animatedTilesets.push(a[b]);this.isAnimated=this.animatedTilesets.length>0,this.isAnimated&&(this.preRender=!1);var c=this.getRenderer().getBounds(this);this.getBounds().resize(c.width,c.height),!0!==this.preRender||this.canvasRenderer||(this.canvasRenderer=new me.CanvasRenderer(me.video.createCanvas(this.width,this.height),this.width,this.height,{transparent:!0}))},onDeactivateEvent:function(){this.animatedTilesets=void 0},setRenderer:function(a){this.renderer=a},getRenderer:function(a){return this.renderer},getTileId:function(a,b){var c=this.getTile(a,b);return c?c.tileId:null},getTile:function(a,b){if(this.containsPoint(a,b)){var c=this.renderer,d=null,e=c.pixelToTileCoords(a,b,me.pool.pull("me.Vector2d"));e.x>=0&&e.x<c.cols&&e.y>=0&&e.y<c.rows&&(d=this.layerData[~~e.x][~~e.y]),me.pool.push(e)}return d},setTile:function(a,b,c){this.tileset.contains(c)||(this.tileset=this.tilesets.getTilesetByGid(c));var d=this.layerData[a][b]=new me.Tile(a,b,c,this.tileset);return this.preRender&&this.renderer.drawTile(this.canvasRenderer,a,b,d),d},clearTile:function(a,b){this.layerData[a][b]=null,this.preRender&&this.canvasRenderer.clearRect(a*this.tilewidth,b*this.tileheight,this.tilewidth,this.tileheight)},update:function(a){if(this.isAnimated){for(var b=!1,c=0;c<this.animatedTilesets.length;c++)b=this.animatedTilesets[c].update(a)||b;return b}return!1},draw:function(a,b){if(this.preRender){var c=Math.min(b.width,this.width),d=Math.min(b.height,this.height);a.drawImage(this.canvasRenderer.getCanvas(),b.pos.x,b.pos.y,c,d,b.pos.x,b.pos.y,c,d)}else this.renderer.drawTileLayer(a,this,b)}})}(),function(){function a(a){switch(a.orientation){case"orthogonal":return new me.TMXOrthogonalRenderer(a);case"isometric":return new me.TMXIsometricRenderer(a);case"hexagonal":return new me.TMXHexagonalRenderer(a);case"staggered":return new me.TMXStaggeredRenderer(a);default:throw new Error(a.orientation+" type TMX Tile Map not supported!")}}function b(a,b,c){var d=new me.TMXLayer(b,a.tilewidth,a.tileheight,a.orientation,a.tilesets,c);return d.setRenderer(a.getRenderer()),d}function c(a,b,c){me.TMXUtils.applyTMXProperties(b.properties,b);var d=me.pool.pull("me.ImageLayer",+b.offsetx||+b.x||0,+b.offsety||+b.y||0,Object.assign({name:b.name,image:b.image,z:c},b.properties)),e=void 0===b.visible||b.visible;return d.setOpacity(e?+b.opacity:0),d}function d(a){return new me.TMXTileset(a)}function e(a,b,c){return new me.TMXGroup(a,b,c)}me.TMXTileMap=me.Object.extend({init:function(a,b){if(this.data=b,this.name=a,this.cols=+b.width,this.rows=+b.height,this.tilewidth=+b.tilewidth,this.tileheight=+b.tileheight,this.infinite=+b.infinite,this.orientation=b.orientation,this.renderorder=b.renderorder||"right-down",this.version=b.version,this.tiledversion=b.tiledversion,this.tilesets=null,void 0===this.layers&&(this.layers=[]),void 0===this.objectGroups&&(this.objectGroups=[]),this.isEditor="melon-editor"===b.editor,this.nextobjectid=+b.nextobjectid||void 0,this.hexsidelength=+b.hexsidelength,this.staggeraxis=b.staggeraxis,this.staggerindex=b.staggerindex,this.bounds=this.getRenderer().getBounds(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=b.backgroundcolor,me.TMXUtils.applyTMXProperties(this,b),this.initialized=!1,1===this.infinite)throw new Error("Tiled Infinite Map not supported!")},getRenderer:function(){return void 0!==this.renderer&&this.renderer.canRender(this)||(this.renderer=a(this)),this.renderer},getBounds:function(){return this.bounds},readMapObjects:function(a){if(!0!==this.initialized){var f=0,g=this;if(this.tilesets||(this.tilesets=new me.TMXTilesetGroup),void 0!==a.tilesets){a.tilesets.forEach(function(a){g.tilesets.add(d(a))})}this.backgroundcolor&&this.layers.push(me.pool.pull("me.ColorLayer","background_color",this.backgroundcolor,f++)),this.background_image&&this.layers.push(me.pool.pull("me.ImageLayer",0,0,{name:"background_image",image:this.background_image,z:f++})),a.layers.forEach(function(a){switch(a.type){case"imagelayer":g.layers.push(c(g,a,f++));break;case"tilelayer":g.layers.push(b(g,a,f++));break;case"objectgroup":case"group":g.objectGroups.push(e(g,a,f++))}}),this.initialized=!0}},addTo:function(a,b){var c=a.autoSort,d=a.autoDepth;a.autoSort=!1,a.autoDepth=!1,this.getLayers().forEach(function(b){a.addChild(b)}),this.getObjects(b).forEach(function(b){a.addChild(b)}),a.autoSort=c,a.autoDepth=d,a.sort(!0)},getObjects:function(a){var b,c=[],d=!1;this.readMapObjects(this.data);for(var e=0;e<this.objectGroups.length;e++){var f=this.objectGroups[e];d=f.name.toLowerCase().includes("collision"),!1===a&&(b=new me.Container(0,0,this.width,this.height),b.anchorPoint.set(0,0),b.name=f.name,b.pos.z=f.z,b.setOpacity(f.opacity),b.autoSort=!1,b.autoDepth=!1);for(var g=0;g<f.objects.length;g++){var h,i=f.objects[g];if(void 0===i.anchorPoint&&(i.anchorPoint={x:0,y:0}),i instanceof me.TMXLayer?h=i:"object"===_typeof(i.text)?(void 0===i.text.anchorPoint&&(i.text.anchorPoint=i.anchorPoint),h=!0===i.text.bitmap?me.pool.pull("me.BitmapText",i.x,i.y,i.text):me.pool.pull("me.Text",i.x,i.y,i.text),h.pos.z=i.z):(h=me.pool.pull(i.name||"me.Entity",i.x,i.y,i),h.pos.z=i.z),"object"===_typeof(i.tile)&&!h.renderable)switch(h.renderable=i.tile.getRenderable(i),i.rotation){case Math.PI:h.translate(-h.renderable.width,h.renderable.height);break;case Math.PI/2:h.translate(0,h.renderable.height);break;case-Math.PI/2:h.translate(-h.renderable.width,0)}d&&!i.name&&(h.body.collisionType=me.collision.types.WORLD_SHAPE),!0===a?(!0===h.isRenderable&&(h.setOpacity(h.getOpacity()*f.opacity),h.renderable instanceof me.Renderable&&h.renderable.setOpacity(h.renderable.getOpacity()*f.opacity)),c.push(h)):b.addChild(h)}!1===a&&b.children.length>0&&(b.autoSort=!0,b.autoDepth=!0,c.push(b))}return c},getLayers:function(){return this.readMapObjects(this.data),this.layers},destroy:function(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}})}(),function(){me.TMXRenderer=me.Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d,this.bounds=new me.Rect(0,0,0,0)},canRender:function(a){return this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},getBounds:function(a){var b=a instanceof me.TMXLayer?me.pool.pull("me.Rect",0,0,0,0):this.bounds;return b.setShape(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),b},pixelToTileCoords:function(a,b,c){return c},tileToPixelCoords:function(a,b,c){return c},drawTile:function(a,b,c,d){},drawTileLayer:function(a,b,c){}})}(),function(){me.TMXOrthogonalRenderer=me.TMXRenderer.extend({init:function(a){me.TMXRenderer.prototype.init.apply(this,[a.cols,a.rows,a.tilewidth,a.tileheight])},canRender:function(a){return"orthogonal"===a.orientation&&me.TMXRenderer.prototype.canRender.apply(this,[a])},pixelToTileCoords:function(a,b,c){return(c||new me.Vector2d).set(a/this.tilewidth,b/this.tileheight)},tileToPixelCoords:function(a,b,c){return(c||new me.Vector2d).set(a*this.tilewidth,b*this.tileheight)},adjustPosition:function(a){"number"==typeof a.gid&&(a.y-=a.height)},drawTile:function(a,b,c,d){var e=d.tileset;e.drawTile(a,e.tileoffset.x+b*this.tilewidth,e.tileoffset.y+(c+1)*this.tileheight-e.tileheight,d)},drawTileLayer:function(a,b,c){var d=1,e=1,f=this.pixelToTileCoords(Math.max(c.pos.x-(b.maxTileSize.width-b.tilewidth),0),Math.max(c.pos.y-(b.maxTileSize.height-b.tileheight),0),me.pool.pull("me.Vector2d")).floorSelf(),g=this.pixelToTileCoords(c.pos.x+c.width+this.tilewidth,c.pos.y+c.height+this.tileheight,me.pool.pull("me.Vector2d")).ceilSelf();switch(g.x=g.x>this.cols?this.cols:g.x,g.y=g.y>this.rows?this.rows:g.y,b.renderorder){case"right-up":g.y=f.y+(f.y=g.y)-g.y,e=-1;break;case"left-down":g.x=f.x+(f.x=g.x)-g.x,d=-1;break;case"left-up":g.x=f.x+(f.x=g.x)-g.x,g.y=f.y+(f.y=g.y)-g.y,d=-1,e=-1}for(var h=f.y;h!==g.y;h+=e)for(var i=f.x;i!==g.x;i+=d){var j=b.layerData[i][h];j&&this.drawTile(a,i,h,j)}me.pool.push(f),me.pool.push(g)}})}(),function(){me.TMXIsometricRenderer=me.TMXRenderer.extend({init:function(a){me.TMXRenderer.prototype.init.apply(this,[a.cols,a.rows,a.tilewidth,a.tileheight]),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth},canRender:function(a){return"isometric"===a.orientation&&me.TMXRenderer.prototype.canRender.apply(this,[a])},getBounds:function(a){var b=a instanceof me.TMXLayer?me.pool.pull("me.Rect",0,0,0,0):this.bounds;return b.setShape(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),b},pixelToTileCoords:function(a,b,c){return(c||new me.Vector2d).set(b/this.tileheight+(a-this.originX)/this.tilewidth,b/this.tileheight-(a-this.originX)/this.tilewidth)},tileToPixelCoords:function(a,b,c){return(c||new me.Vector2d).set((a-b)*this.hTilewidth+this.originX,(a+b)*this.hTileheight)},adjustPosition:function(a){var b=a.x/this.hTilewidth,c=a.y/this.tileheight,d=me.pool.pull("me.Vector2d");this.tileToPixelCoords(b,c,d),a.x=d.x,a.y=d.y,me.pool.push(d)},drawTile:function(a,b,c,d){var e=d.tileset;e.drawTile(a,(this.cols-1)*e.tilewidth+(b-c)*e.tilewidth>>1,-e.tilewidth+(b+c)*e.tileheight>>2,d)},drawTileLayer:function(a,b,c){var d=b.tileset,e=this.pixelToTileCoords(c.pos.x-d.tilewidth,c.pos.y-d.tileheight,me.pool.pull("me.Vector2d")).floorSelf(),f=this.pixelToTileCoords(c.pos.x+c.width+d.tilewidth,c.pos.y+c.height+d.tileheight,me.pool.pull("me.Vector2d")).ceilSelf(),g=this.tileToPixelCoords(f.x,f.y,me.pool.pull("me.Vector2d")),h=this.tileToPixelCoords(e.x,e.y,me.pool.pull("me.Vector2d"));h.x-=this.hTilewidth,h.y+=this.tileheight;var i=h.y-c.pos.y>this.hTileheight,j=c.pos.x-h.x<this.hTilewidth;i&&(j?(e.x--,h.x-=this.hTilewidth):(e.y--,h.x+=this.hTilewidth),h.y-=this.hTileheight);for(var k=i^j,l=e.clone(),m=2*h.y;m-2*this.tileheight<2*g.y;m+=this.tileheight){l.setV(e);for(var n=h.x;n<g.x;n+=this.tilewidth){if(l.x>=0&&l.y>=0&&l.x<this.cols&&l.y<this.rows){var o=b.layerData[l.x][l.y];if(o){d=o.tileset;var p=d.tileoffset;d.drawTile(a,p.x+n,p.y+m/2-d.tileheight,o)}}l.x++,l.y--}k?(e.y++,h.x-=this.hTilewidth,k=!1):(e.x++,h.x+=this.hTilewidth,k=!0)}me.pool.push(l),me.pool.push(e),me.pool.push(f),me.pool.push(g),me.pool.push(h)}})}(),function(){var a=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],b=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];me.TMXHexagonalRenderer=me.TMXRenderer.extend({init:function(a){me.TMXRenderer.prototype.init.apply(this,[a.cols,a.rows,-2&a.tilewidth,-2&a.tileheight]),this.hexsidelength=a.hexsidelength||0,this.staggerX="x"===a.staggeraxis,this.staggerEven="even"===a.staggerindex,this.sidelengthx=0,this.sidelengthy=0,"hexagonal"===a.orientation&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new me.Vector2d,new me.Vector2d,new me.Vector2d,new me.Vector2d]},canRender:function(a){return"hexagonal"===a.orientation&&me.TMXRenderer.prototype.canRender.apply(this,[a])},getBounds:function(a){var b=a instanceof me.TMXLayer?me.pool.pull("me.Rect",0,0,0,0):this.bounds;return b.pos.set(0,0),this.staggerX?(b.resize(this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),b.width>1&&(b.height+=this.rowheight)):(b.resize(this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),b.height>1&&(b.width+=this.columnwidth)),b},doStaggerX:function(a){return this.staggerX&&1&a^this.staggerEven},doStaggerY:function(a){return!this.staggerX&&1&a^this.staggerEven},topLeft:function(a,b,c){var d=c||new me.Vector2d;return this.staggerX?1&a^this.staggerEven?d.set(a-1,b):d.set(a-1,b-1):1&b^this.staggerEven?d.set(a,b-1):d.set(a-1,b-1),d},topRight:function(a,b,c){var d=c||new me.Vector2d;return this.staggerX?1&a^this.staggerEven?d.set(a+1,b):d.set(a+1,b-1):1&b^this.staggerEven?d.set(a+1,b-1):d.set(a,b-1),d},bottomLeft:function(a,b,c){var d=c||new me.Vector2d;return this.staggerX?1&a^this.staggerEven?d.set(a-1,b+1):d.set(a-1,b):1&b^this.staggerEven?d.set(a,b+1):d.set(a-1,b+1),d},bottomRight:function(a,b,c){var d=c||new me.Vector2d;return this.staggerX?1&a^this.staggerEven?d.set(a+1,b+1):d.set(a+1,b):1&b^this.staggerEven?d.set(a+1,b+1):d.set(a,b+1),d},pixelToTileCoords:function(c,d,e){var f=e||new me.Vector2d;this.staggerX?c-=this.staggerEven?this.tilewidth:this.sideoffsetx:d-=this.staggerEven?this.tileheight:this.sideoffsety;var g=me.pool.pull("me.Vector2d",Math.floor(c/(2*this.columnwidth)),Math.floor(d/(2*this.rowheight))),h=me.pool.pull("me.Vector2d",c-g.x*(2*this.columnwidth),d-g.y*(2*this.rowheight));this.staggerX?(g.x=2*g.x,this.staggerEven&&++g.x):(g.y=2*g.y,this.staggerEven&&++g.y);var i,j,k,l;this.staggerX?(i=this.sidelengthx/2,k=i+this.columnwidth,l=this.tileheight/2,this.centers[0].set(i,l),this.centers[1].set(k,l-this.rowheight),this.centers[2].set(k,l+this.rowheight),this.centers[3].set(k+this.columnwidth,l)):(j=this.sidelengthy/2,k=this.tilewidth/2,l=j+this.rowheight,this.centers[0].set(k,j),this.centers[1].set(k-this.columnwidth,l),this.centers[2].set(k+this.columnwidth,l),this.centers[3].set(k,l+this.rowheight));for(var m=0,n=Number.MAX_VALUE,o=0;o<4;++o){var p=this.centers[o].sub(h).length2();p<n&&(n=p,m=o)}var q=this.staggerX?a:b;return f.set(g.x+q[m].x,g.y+q[m].y),me.pool.push(g),me.pool.push(h),f},tileToPixelCoords:function(a,b,c){var d=Math.floor(a),e=Math.floor(b),f=c||new me.Vector2d;return this.staggerX?(f.y=e*(this.tileheight+this.sidelengthy),this.doStaggerX(d)&&(f.y+=this.rowheight),f.x=d*this.columnwidth):(f.x=d*(this.tilewidth+this.sidelengthx),this.doStaggerY(e)&&(f.x+=this.columnwidth),f.y=e*this.rowheight),f},adjustPosition:function(a){"number"==typeof a.gid&&(a.y-=a.height)},drawTile:function(a,b,c,d){var e=d.tileset,f=this.tileToPixelCoords(b,c,me.pool.pull("me.Vector2d"));e.drawTile(a,e.tileoffset.x+f.x,e.tileoffset.y+f.y+(this.tileheight-e.tileheight),d),me.pool.push(f)},drawTileLayer:function(a,b,c){var d,e=this.pixelToTileCoords(c.pos.x,c.pos.y,me.pool.pull("me.Vector2d"));e.sub(b.pos);var f=this.tileToPixelCoords(e.x+b.pos.x,e.y+b.pos.y,me.pool.pull("me.Vector2d")),g=e.clone(),h=f.clone(),i=c.pos.y-f.y<this.sideoffsety,j=c.pos.x-f.x<this.sideoffsetx;i&&e.y--,j&&e.x--;var k=b.cols,l=b.rows;if(this.staggerX){e.x=Math.max(0,e.x),e.y=Math.max(0,e.y),f=this.tileToPixelCoords(e.x+b.pos.x,e.y+b.pos.y);for(var m=this.doStaggerX(e.x+b.pos.x);f.y<c.bottom&&e.y<l;){for(g.setV(e),h.setV(f);h.x<c.right&&g.x<k;g.x+=2)d=b.layerData[g.x][g.y],d&&d.tileset.drawTile(a,h.x,h.y,d),h.x+=this.tilewidth+this.sidelengthx;m?(e.x-=1,e.y+=1,f.x-=this.columnwidth,m=!1):(e.x+=1,f.x+=this.columnwidth,m=!0),f.y+=this.rowheight}me.pool.push(g),me.pool.push(h)}else{for(e.x=Math.max(0,e.x),e.y=Math.max(0,e.y),f=this.tileToPixelCoords(e.x+b.pos.x,e.y+b.pos.y),this.doStaggerY(e.y)&&(f.x-=this.columnwidth);f.y<c.bottom&&e.y<l;e.y++){for(g.setV(e),h.setV(f),this.doStaggerY(e.y)&&(h.x+=this.columnwidth);h.x<c.right&&g.x<k;g.x++)d=b.layerData[g.x][g.y],d&&d.tileset.drawTile(a,h.x,h.y,d),h.x+=this.tilewidth+this.sidelengthx;f.y+=this.rowheight}me.pool.push(g),me.pool.push(h)}me.pool.push(e),me.pool.push(f)}})}(),function(){me.TMXStaggeredRenderer=me.TMXHexagonalRenderer.extend({canRender:function(a){return"staggered"===a.orientation&&me.TMXRenderer.prototype.canRender.apply(this,[a])},pixelToTileCoords:function(a,b,c){var d=c||new me.Vector2d,e=a,f=b;this.staggerX?e-=this.staggerEven?this.sideoffsetx:0:f-=this.staggerEven?this.sideoffsety:0;var g=me.pool.pull("me.Vector2d",Math.floor(e/this.tilewidth),Math.floor(f/this.tileheight));this.staggerX?(g.x=2*g.x,this.staggerEven&&++g.x):(g.y=2*g.y,this.staggerEven&&++g.y);var h=me.pool.pull("me.Vector2d",e-g.x*this.tilewidth,f-g.y*this.tileheight),i=h.x*(this.tileheight/this.tilewidth);return this.sideoffsety-i>h.y&&(g=this.topLeft(g.x,g.y,g)),-this.sideoffsety+i>h.y&&(g=this.topRight(g.x,g.y,g)),this.sideoffsety+i<h.y&&(g=this.bottomLeft(g.x,g.y,g)),3*this.sideoffsety-i<h.y&&(g=this.bottomRight(g.x,g.y,g)),d=this.tileToPixelCoords(g.x,g.y,d),d.set(a-d.x,b-d.y),d.set(d.x-this.tilewidth/2,d.y*(this.tilewidth/this.tileheight)),d.div(this.tilewidth/Math.sqrt(2)).rotate(me.Math.degToRad(-45)).add(g),me.pool.push(g),me.pool.push(h),d}})}(),function(){me.Tween=function(a){var b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null;this.isRenderable=!1,this._resumeCallback=function(a){j&&(j+=a)},this.setProperties=function(a){b=a,c={},d={},e={},f=1e3,g=0,h=!1,i=0,j=null,k=me.Tween.Easing.Linear.None,l=me.Tween.Interpolation.Linear,m=[],n=null,o=!1,p=null,q=null,r=me.timer.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1;for(var s in a)"object"!==_typeof(a)&&(c[s]=parseFloat(a[s]))},this.setProperties(a),this.onResetEvent=function(a){this.setProperties(a)},this.onActivateEvent=function(){me.event.subscribe(me.event.STATE_RESUME,this._resumeCallback)},this.onDeactivateEvent=function(){me.event.unsubscribe(me.event.STATE_RESUME,this._resumeCallback)},this.to=function(a,b){return void 0!==b&&(f=b),d=a,this},this.start=function(a){o=!1,me.game.world.addChild(this),j=(void 0===a?me.timer.getTime():a)+i;for(var f in d){if(d[f]instanceof Array){if(0===d[f].length)continue;d[f]=[b[f]].concat(d[f])}c[f]=b[f],c[f]instanceof Array==!1&&(c[f]*=1),e[f]=c[f]||0}return this},this.stop=function(){return me.game.world.removeChildNow(this),this},this.delay=function(a){return i=a,this},this.repeat=function(a){return g=a,this},this.yoyo=function(a){return h=a,this},this.easing=function(a){if("function"!=typeof a)throw new Error("invalid easing function for me.Tween.easing()");return k=a,this},this.interpolation=function(a){return l=a,this},this.chain=function(){return m=arguments,this},this.onStart=function(a){return n=a,this},this.onUpdate=function(a){return p=a,this},this.onComplete=function(a){return q=a,this},this.update=function(a){r=me.timer.lastUpdate>r?me.timer.lastUpdate:r+a;var s,t=r;if(t<j)return!0;!1===o&&(null!==n&&n.call(b),o=!0);var u=(t-j)/f;u=u>1?1:u;var v=k(u);for(s in d){var w=c[s]||0,x=d[s];x instanceof Array?b[s]=l(x,v):("string"==typeof x&&(x=w+parseFloat(x)),"number"==typeof x&&(b[s]=w+(x-w)*v))}if(null!==p&&p.call(b,v),1===u){if(g>0){isFinite(g)&&g--;for(s in e){if("string"==typeof d[s]&&(e[s]=e[s]+parseFloat(d[s])),h){var y=e[s];e[s]=d[s],d[s]=y}c[s]=e[s]}return j=t+i,!0}me.game.world.removeChildNow(this),null!==q&&q.call(b);for(var z=0,A=m.length;z<A;z++)m[z].start(t);return!1}return!0}},me.Tween.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(2-Math.pow(2,-10*(a-1)))}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1;return 0===a?0:1===a?1:(!c||c<1?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI),-c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/.4))},Out:function(a){var b,c=.1;return 0===a?0:1===a?1:(!c||c<1?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin((a-b)*(2*Math.PI)/.4)+1)},InOut:function(a){var b,c=.1;return 0===a?0:1===a?1:(!c||c<1?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/.4)*-.5:c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?a*a*((b+1)*a-b)*.5:.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-me.Tween.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return a<.5?.5*me.Tween.Easing.Bounce.In(2*a):.5*me.Tween.Easing.Bounce.Out(2*a-1)+.5}}},me.Tween.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=me.Tween.Interpolation.Utils.Linear;return b<0?f(a[0],a[1],d):b>1?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)},Bezier:function(a,b){var c,d=0,e=a.length-1,f=Math.pow,g=me.Tween.Interpolation.Utils.Bernstein;for(c=0;c<=e;c++)d+=f(1-b,e-c)*f(b,c)*a[c]*g(e,c);return d},CatmullRom:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=me.Tween.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(b<0&&(e=Math.floor(d=c*(1+b))),f(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):b<0?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[c<e+1?c:e+1],a[c<e+2?c:e+2],d-e)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=me.Tween.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c,d=1;if(a[b])return a[b];for(c=b;c>1;c--)d*=c;return a[b]=d}}(),CatmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e;return(2*b-2*c+f+g)*(e*h)+(-3*b+3*c-2*f-g)*h+f*e+b}}}}(),function(){me.plugins={},me.plugin=function(){var a={};return a.Base=me.Object.extend({init:function(){this.version="7.1.0"}}),a.patch=function(a,b,c){if(void 0!==a.prototype&&(a=a.prototype),"function"!=typeof a[b])throw new Error(b+" is not an existing function");var d=a[b];Object.defineProperty(a,b,{configurable:!0,value:function(a,b){return function(){this._patched=d;var a=b.apply(this,arguments);return this._patched=null,a}}(0,c)})},a.register=function(a,b){if(me.plugin[b])throw new Error("plugin "+b+" already registered");var c=[];arguments.length>2&&(c=Array.prototype.slice.call(arguments,1)),c[0]=a;var d=new(a.bind.apply(a,c));if(!(d&&d instanceof me.plugin.Base))throw new Error("Plugin should extend the me.plugin.Base Class !");if(me.utils.checkVersion(d.version)>0)throw new Error("Plugin version mismatch, expected: "+d.version+", got: "+me.version);me.plugins[b]=d},a}()}(),me.DraggableEntity=function(a,b,c,d){return a.extend({init:function(c,e,f){a.prototype.init.apply(this,[c,e,f]),this.dragging=!1,this.dragId=null,this.grabOffset=new d(0,0),this.onPointerEvent=b.registerPointerEvent,this.removePointerEvent=b.releasePointerEvent,this.initEvents()},initEvents:function(){var a=this;this.mouseDown=function(a){this.translatePointerEvent(a,c.DRAGSTART)},this.mouseUp=function(a){this.translatePointerEvent(a,c.DRAGEND)},this.onPointerEvent("pointerdown",this,this.mouseDown.bind(this)),this.onPointerEvent("pointerup",this,this.mouseUp.bind(this)),this.onPointerEvent("pointercancel",this,this.mouseUp.bind(this)),c.subscribe(c.POINTERMOVE,this.dragMove.bind(this)),c.subscribe(c.DRAGSTART,function(b,c){c===a&&a.dragStart(b)}),c.subscribe(c.DRAGEND,function(b,c){c===a&&a.dragEnd(b)})},translatePointerEvent:function(a,b){c.publish(b,[a,this])},dragStart:function(a){if(!1===this.dragging)return this.dragging=!0,this.grabOffset.set(a.gameX,a.gameY),this.grabOffset.sub(this.pos),!1},dragMove:function(a){!0===this.dragging&&(this.pos.set(a.gameX,a.gameY,this.pos.z),this.pos.sub(this.grabOffset))},dragEnd:function(){if(!0===this.dragging)return this.dragging=!1,!1},destroy:function(){c.unsubscribe(c.POINTERMOVE,this.dragMove),c.unsubscribe(c.DRAGSTART,this.dragStart),c.unsubscribe(c.DRAGEND,this.dragEnd),this.removePointerEvent("pointerdown",this),this.removePointerEvent("pointerup",this)}})}(me.Entity,me.input,me.event,me.Vector2d),me.DroptargetEntity=function(a,b){return a.extend({init:function(c,d,e){this.CHECKMETHOD_OVERLAP="overlaps",this.CHECKMETHOD_CONTAINS="contains",this.checkMethod=null,a.prototype.init.apply(this,[c,d,e]),b.subscribe(b.DRAGEND,this.checkOnMe.bind(this)),this.checkMethod=this[this.CHECKMETHOD_OVERLAP]},setCheckMethod:function(a){void 0!==this[a]&&(this.checkMethod=this[a])},checkOnMe:function(a,b){b&&this.checkMethod(b.getBounds())&&this.drop(b)},drop:function(){},destroy:function(){b.unsubscribe(b.DRAGEND,this.checkOnMe)}})}(me.Entity,me.event),function(){me.CollectableEntity=me.Entity.extend({init:function(a,b,c){me.Entity.prototype.init.apply(this,[a,b,c]),this.body.collisionType=me.collision.types.COLLECTABLE_OBJECT}})}(),function(){me.LevelEntity=me.Entity.extend({init:function(a,b,c){me.Entity.prototype.init.apply(this,[a,b,c]),this.nextlevel=c.to,this.fade=c.fade,this.duration=c.duration,this.fading=!1,this.name="levelEntity",this.gotolevel=c.to,this.loadLevelSettings={},["container","onLoaded","flatten","setViewportBounds"].forEach(function(a){void 0!==c[a]&&(this.loadLevelSettings[a]=c[a])}.bind(this)),this.body.collisionType=me.collision.types.ACTION_OBJECT},getlevelSettings:function(){
return"string"==typeof this.loadLevelSettings.container&&(this.loadLevelSettings.container=me.game.world.getChildByName(this.loadLevelSettings.container)[0]),this.loadLevelSettings},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel,this.getlevelSettings()),me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(a){this.gotolevel=a||this.nextlevel,this.fade&&this.duration?this.fading||(this.fading=!0,me.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):me.levelDirector.loadLevel(this.gotolevel,this.getlevelSettings())},onCollision:function(){return"levelEntity"===this.name&&this.goTo.apply(this),!1}})}(),function(){var a=function(){var a=me.video.createCanvas(1,1),b=a.getContext("2d");return b.fillStyle="#fff",b.fillRect(0,0,1,1),a}();me.ParticleEmitterSettings={width:0,height:0,image:a,totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:!1,textureAdditive:!1,onlyInViewport:!0,floating:!1,maxParticles:10,frequency:100,duration:1/0,framesToSkip:0},me.ParticleEmitter=me.Rect.extend({init:function(a,b,c){this._stream=!1,this._frequencyTimer=0,this._durationTimer=0,this._enabled=!1,this.isRenderable=!1,me.Rect.prototype.init.apply(this,[a,b,1/0,1/0]),this.autoSort=!1,this.container=new me.ParticleContainer(this),Object.defineProperty(this.pos,"z",{get:function(){return this.container.pos.z}.bind(this),set:function(a){this.container.pos.z=a}.bind(this),enumerable:!0,configurable:!0}),Object.defineProperty(this,"floating",{get:function(){return this.container.floating},set:function(a){this.container.floating=a},enumerable:!0,configurable:!0}),this.reset(c)},onActivateEvent:function(){this.ancestor.addChild(this.container),this.container.pos.z=this.pos.z,this.ancestor.autoSort||this.ancestor.sort()},onDeactivateEvent:function(){this.ancestor.hasChild(this.container)&&this.ancestor.removeChildNow(this.container)},destroy:function(){this.reset()},getRandomPointX:function(){return this.pos.x+me.Math.randomFloat(0,this.width)},getRandomPointY:function(){return this.pos.y+me.Math.randomFloat(0,this.height)},reset:function(a){a=a||{};var b=me.ParticleEmitterSettings,c="number"==typeof a.width?a.width:b.width,d="number"==typeof a.height?a.height:b.height;this.resize(c,d),Object.assign(this,b,a),this.container.reset()},addParticles:function(a){for(var b=0;b<~~a;b++){var c=me.pool.pull("me.Particle",this);this.container.addChild(c)}},isRunning:function(){return this._enabled&&this._stream},streamParticles:function(a){this._enabled=!0,this._stream=!0,this.frequency=Math.max(this.frequency,1),this._durationTimer="number"==typeof a?a:this.duration},stopStream:function(){this._enabled=!1},burstParticles:function(a){this._enabled=!0,this._stream=!1,this.addParticles("number"==typeof a?a:this.totalParticles),this._enabled=!1},update:function(a){if(this._enabled&&this._stream){if(this._durationTimer!==1/0&&(this._durationTimer-=a,this._durationTimer<=0))return this.stopStream(),!1;this._frequencyTimer+=a;var b=this.container.children.length;b<this.totalParticles&&this._frequencyTimer>=this.frequency&&(b+this.maxParticles<=this.totalParticles?this.addParticles(this.maxParticles):this.addParticles(this.totalParticles-b),this._frequencyTimer=0)}return!0}})}(),function(){me.ParticleContainer=me.Container.extend({init:function(a){me.Container.prototype.init.apply(this,[me.game.viewport.pos.x,me.game.viewport.pos.y,me.game.viewport.width,me.game.viewport.height]),this.autoSort=!1,this._updateCount=0,this._dt=0,this._emitter=a,this.autoTransform=!1,this.anchorPoint.set(0,0),this.isKinematic=!0},update:function(a){if(++this._updateCount>this._emitter.framesToSkip&&(this._updateCount=0),this._updateCount>0)return this._dt+=a,!1;a+=this._dt,this._dt=0;for(var b=me.game.viewport,c=this.children.length-1;c>=0;--c){var d=this.children[c];d.inViewport=b.isVisible(d,this.floating),d.update(a)||this.removeChildNow(d)}return!0},draw:function(a,b){if(this.children.length>0){var c,d=a.getContext();this._emitter.textureAdditive&&(c=d.globalCompositeOperation,d.globalCompositeOperation="lighter"),me.Container.prototype.draw.apply(this,[a,b]),this._emitter.textureAdditive&&(d.globalCompositeOperation=c)}}})}(),function(){me.Particle=me.Renderable.extend({init:function(a){me.Renderable.prototype.init.apply(this,[a.getRandomPointX(),a.getRandomPointY(),a.image.width,a.image.height]),this.alwaysUpdate=!0,this.image=a.image;var b=a.angle+(a.angleVariation>0?(me.Math.randomFloat(0,2)-1)*a.angleVariation:0),c=a.speed+(a.speedVariation>0?(me.Math.randomFloat(0,2)-1)*a.speedVariation:0);this.vel=new me.Vector2d(c*Math.cos(b),-c*Math.sin(b)),this.life=me.Math.randomFloat(a.minLife,a.maxLife),this.startLife=this.life,this.startScale=me.Math.clamp(me.Math.randomFloat(a.minStartScale,a.maxStartScale),a.minStartScale,a.maxStartScale),this.endScale=me.Math.clamp(me.Math.randomFloat(a.minEndScale,a.maxEndScale),a.minEndScale,a.maxEndScale),this.gravity=a.gravity,this.wind=a.wind,this.followTrajectory=a.followTrajectory,this.onlyInViewport=a.onlyInViewport,this.pos.z=a.z,this._deltaInv=me.sys.fps/1e3,a.followTrajectory||(this.angle=me.Math.randomFloat(a.minRotation,a.maxRotation))},update:function(a){var b=a*this._deltaInv;this.life=this.life>a?this.life-a:0;var c=this.life/this.startLife,d=this.startScale;this.startScale>this.endScale?(d*=c,d=d<this.endScale?this.endScale:d):this.startScale<this.endScale&&(d/=c,d=d>this.endScale?this.endScale:d),this.alpha=c,this.vel.x+=this.wind*b,this.vel.y+=this.gravity*b;var e=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*b,this.pos.y+=this.vel.y*b,this.currentTransform.setTransform(d,0,0,0,d,0,this.pos.x,this.pos.y,1).rotate(e),(this.inViewport||!this.onlyInViewport)&&this.life>0},preDraw:function(a){a.save(),a.setGlobalAlpha(a.globalAlpha()*this.alpha),a.transform(this.currentTransform)},draw:function(a){var b=this.width,c=this.height;a.drawImage(this.image,0,0,b,c,-b/2,-c/2,b,c)}})}(),me.device.getPixelRatio=function(){return console.log("me.device.getPixelRatio() is deprecated, please use me.device.devicePixelRatio"),me.device.devicePixelRatio},me.Font=me.Text.extend({init:function(a,b,c,d){var e={font:a,size:b,fillStyle:c,textAlign:d};me.Text.prototype.init.apply(this,[0,0,e]),console.log("me.Font is deprecated, please use me.Text")},setFont:function(a,b,c,d){return void 0!==c&&this.fillStyle.copy(c),void 0!==d&&(this.textAlign=d),me.Text.prototype.setFont.apply(this,[a,b])}}),me.BitmapFontData=me.BitmapTextData,me.BitmapFont=me.BitmapText.extend({init:function(a,b,c,d,e){var f={font:b,fontData:a,size:c,textAlign:d,textBaseline:e};me.BitmapText.prototype.init.apply(this,[0,0,f]),console.log("me.BitmapFont is deprecated, please use me.BitmapText")}}),me.ScreenObject=me.Stage.extend({init:function(a){me.Stage.prototype.init.apply(this,a),console.log("me.ScreenObject is deprecated, please use me.Stage")}}),me.Renderer.prototype.drawShape=function(){console.log("drawShape() is deprecated, please use the stroke() or fill() function"),me.Renderer.prototype.stroke.apply(this,arguments)},me.CanvasRenderer.prototype.Texture=me.Renderer.prototype.Texture,me.WebGLRenderer.prototype.Texture=me.Renderer.prototype.Texture,me.video.getPos=function(){return console.log("me.video.getPos() is deprecated, please use me.video.renderer.getBounds()"),me.video.renderer.getBounds()},me.Error=me.Object.extend.bind(Error)({init:function(a){this.name="me.Error",this.message=a}}),me.sys.checkVersion=function(a,b){return console.log("me.sys.checkVersion() is deprecated, please use me.utils.checkVersion()"),me.utils.checkVersion(a,b)},Object.defineProperty(me.game,"HASH",{get:function(){return console.log("me.game.HASH is deprecated, please use me.utils.getUriFragment()"),me.utils.getUriFragment()},configurable:!1}),me.video.updateDisplaySize=function(a,b){return console.log("me.video.updateDisplaySize() is deprecated, please use me.video.scale()"),me.video.scale(a,b)},me.Renderer.prototype.scaleCanvas=function(a,b){return console.log("scaleCanvas() is deprecated, please use me.video.scale()"),me.video.scale(a,b)},me.Entity.prototype.distanceToPoint=function(a){return console.log("distanceToPoint() is deprecated, please use me.Renderable.distanceTo()"),this.distanceTo(a)},me.Entity.prototype.angleToPoint=function(a){return console.log("angleToPoint() is deprecated, please use me.Renderable.angleTo()"),this.angleTo(a)}}();var game={res:{width:640,height:480},alive:!0,ia:{alive:!1,weightSeq:[]},enemies:[],human:{distance:0,velocity:0},ia:{generation:1},vel:{x:1,y:0},assets:[{name:"sidewalk",type:"image",src:"data/img/sidewalk.png"},{name:"cacti",type:"image",src:"data/img/cacti.png"},{name:"plant1",type:"image",src:"data/img/plant1.png"},{name:"cloud1",type:"image",src:"data/img/cloud1.png"},{name:"cloud2",type:"image",src:"data/img/cloud2.png"},{name:"cloud3",type:"image",src:"data/img/cloud3.png"},{name:"player",type:"image",src:"data/img/player.png"},{name:"enemyCacti",type:"image",src:"data/img/enemyCacti.png"},{name:"enemyFly",type:"image",src:"data/img/enemyFly.png"},{name:"PressStart2P",type:"image",src:"data/fnt/PressStart2P.png"},{name:"PressStart2P",type:"binary",src:"data/fnt/PressStart2P.fnt"}],onload:function(){if(!me.video.init(game.res.width,game.res.height,{wrapper:"screen"}))return void alert("Your browser does not support HTML5 canvas.");me.audio.init("mp3,ogg"),me.loader.onload=this.loaded.bind(this),me.loader.preload(game.assets)},loaded:function(){me.state.NEURALNETWORK=me.state.USER+1,me.state.set(me.state.READY,new WelcomeScreen),me.state.set(me.state.PLAY,new PlayScreen),me.state.set(me.state.GAMEOVER,new Gameover),me.state.set(me.state.NEURALNETWORK,new NeuralNetworkScreen(!0)),me.state.set(me.state.NEURALNETWORK2,new NeuralNetworkScreen(!1)),me.state.change(me.state.READY)}},Cacti=me.Entity.extend({init:function(a,b,c,d){this.z=d,this.zi=b,this.ze=c,void 0==a&&(a=0),this.nextFrame=!1,me.Entity.prototype.init.apply(this,[a,360,{width:me.Math.random(b,c),height:91,framewidth:30,frameheight:91}]),this.body.setVelocity(3*game.vel.x,0),this.renderable=new me.Sprite(0,0,{image:me.loader.getImage("cacti"),framewidth:30,frameheight:91}),this.body.collisionType=me.collision.types.NO_OBJECT,this.removed=!1,this.isKinematic=!0},update:function(a){if(game.alive||game.ia.alive){this.body.vel.x+=-this.body.accel.x*me.timer.tick;var b=this.body.ancestor.pos._x+this.body.width;game.res.width-(this.body.ancestor.pos._x+this.body.width)>0&&!this.nextFrame&&(this.nextFrame=!0,me.game.world.addChild(new Cacti(b-this.body.accel.x,this.zi,this.ze),this.z)),b<=15&&(this.removed=!0,me.game.world.removeChild(this))}else this.body.setVelocity(0,0);return this.body.update(a),me.Entity.prototype.update.apply(this,[a])||0!==this.body.vel.x||0!==this.body.vel.y}}),Cloud=me.Entity.extend({init:function(a,b,c,d){void 0==a&&(a=0),this.z=d,this.zi=b,this.ze=c,me.Entity.prototype.init.apply(this,[a,me.Math.random(50,300),{width:me.Math.random(b,c),height:71,framewidth:128,frameheight:71}]),this.nextFrame=!1,this.alwaysUpdate=!0,this.body.setVelocity(1*game.vel.x,0),this.renderable=new me.Sprite(0,0,{image:me.loader.getImage("cloud"+me.Math.random(1,3)),framewidth:128,frameheight:71}),this.body.collisionType=me.collision.types.NO_OBJECT,this.removed=!1,this.isKinematic=!0},update:function(a){if(game.alive||game.ia.alive){this.body.vel.x+=-this.body.accel.x*me.timer.tick;var b=this.body.ancestor.pos._x+this.body.width;game.res.width-(this.body.ancestor.pos._x+this.body.width)>0&&!this.nextFrame&&(this.nextFrame=!0,me.game.world.addChild(new Cloud(b-this.body.accel.x,this.zi,this.ze),this.z)),b<=15&&(this.removed=!0,me.game.world.removeChild(this))}else this.body.setVelocity(0,0);return this.body.update(a),me.Entity.prototype.update.apply(this,[a])||0!==this.body.vel.x||0!==this.body.vel.y}}),End=me.Renderable.extend({init:function(a,b,c,d){me.Renderable.prototype.init.apply(this,[0,0,600,10]),this.font=new me.BitmapFont(me.loader.getBinary("PressStart2P"),me.loader.getImage("PressStart2P")),this.font.textAlign="center",this.font.textBaseline="bottom",this.font2=new me.BitmapFont(me.loader.getBinary("PressStart2P"),me.loader.getImage("PressStart2P")),this.font2.textAlign="left",this.font2.textBaseline="bottom",this.selected=0,this.limit=2,me.input.bindKey(me.input.KEY.ENTER,"restart",!0)},update:function(a){me.input.isKeyPressed("restart")&&me.state.change(me.state.READY)},draw:function(a){this.font.draw(a,"ET BILU",600,130),this.font.draw(a,"GAME OVER",600,230),this.font.draw(a,"PRESS ENTER TO RETURN",600,330),this.font.draw(a,"Distance: "+game.human.distance,600,400),this.font.draw(a,"Velocity: "+game.human.velocity,600,430)}}),EnemyCacti=me.Entity.extend({init:function(){me.Entity.prototype.init.apply(this,[639,410,{width:me.Math.random(200,800),height:50,shapes:[new me.Rect(0,0,30,90)],framewidth:30,frameheight:50}]),this.body.setVelocity(4*game.vel.x,0),this.renderable=new me.Sprite(0,0,{image:me.loader.getImage("enemyCacti"),framewidth:30,frameheight:90}),this.body.collisionType=me.collision.types.ENEMY_OBJECT,this.removed=!1,this.isKinematic=!1,game.enemies.push(this.body),this.enemyId=game.enemies.lenght-1},update:function(a){if(game.alive||game.ia.alive){this.body.vel.x+=-this.body.accel.x*me.timer.tick;this.body.ancestor.pos._x+this.body.width<=15&&(this.removed=!0,me.game.world.removeChild(this),game.enemies.splice(this.enemyId,1))}else this.body.setVelocity(0,0);return this.body.update(a),me.Entity.prototype.update.apply(this,[a])||0!==this.body.vel.x||0!==this.body.vel.y}}),EnemyFactory=me.Container.extend({init:function(a,b){this.z=b,me.Container.prototype.init.apply(this),this.isPersistent=!0,this.floating=!0,this.name="EnemyFactory",this.interval=0,this.limit=a,this.hasEnemy=!1},update:function(){(game.alive||game.ia.alive)&&this.interval>=this.limit&&me.Math.random(1,4)%2==0&&(this.interval=0,this.genEnemy()),this.interval++},genEnemy:function(){me.Math.random(1,4)%2==0?me.game.world.addChild(new EnemyFly,this.z):me.game.world.addChild(new EnemyCacti,this.z)}}),EnemyFly=me.Entity.extend({init:function(){me.Entity.prototype.init.apply(this,[630,me.Math.random(1,4)%2==0?340:410,{width:75,height:33.5,shapes:[new me.Rect(-28,0,15,18),new me.Rect(-12,0,40,33.5),new me.Rect(28,0,15,18)],framewidth:75,frameheight:33.5}]),this.body.setVelocity(4*game.vel.x,0),this.alwaysUpdate=!0,this.renderable=new me.Sprite(0,0,{image:me.loader.getImage("enemyFly"),framewidth:75,frameheight:33.5}),this.body.collisionType=me.collision.types.ENEMY_OBJECT,this.isKinematic=!1,game.enemies.push(this.body),this.enemyId=game.enemies.lenght-1},update:function(a){if(game.alive||game.ia.alive){this.body.vel.x+=-this.body.accel.x*me.timer.tick;this.body.ancestor.pos._x+this.body.width<=15&&(me.game.world.removeChild(this),game.enemies.splice(this.enemyId,1))}else this.body.setVelocity(0,0);return this.body.update(a),me.Entity.prototype.update.apply(this,[a])||0!==this.body.vel.x||0!==this.body.vel.y}}),HumanPlayer=me.Entity.extend({init:function(a,b,c,d,e){this.distance=0,this.weightSeq=null,this.matrix=e,this.callback=[],this.callback.colision=c,this.callback.update=d,this.startPoint={x:a,y:b},this.entityWidth=74,this.entityHeight=89,me.Entity.prototype.init.apply(this,[this.startPoint.x,this.startPoint.y,{width:this.entityWidth,height:this.entityHeight,shapes:[new me.Rect(0,0,this.entityWidth-20,this.entityHeight)],framewidth:this.entityWidth,frameheight:this.entityHeight}]),this.body.gravity.y=.17,this.body.setVelocity(0,6),this.alwaysUpdate=!0,this.renderable=new me.Sprite(0,0,{image:me.loader.getImage("player"),framewidth:this.entityWidth,frameheight:this.entityHeight}),this.renderable.addAnimation("walk",[0,1,2,3]),this.renderable.addAnimation("jump",[5]),this.renderable.addAnimation("duck",[4]),this.runWalk(),this.body.collisionType=me.collision.types.PLAYER_OBJECT,this.isKinematic=!1,me.input.bindKey(me.input.KEY.DOWN,"duck"),me.input.bindKey(me.input.KEY.UP,"jump"),me.input.bindKey(me.input.KEY.SPACE,"jump")},update:function(a){(this.body.ancestor.pos._x+this.body.width<=15&&me.game.world.removeChild(this),this.alive)&&(game.vel.x<2?this.body.gravity.y=.17:game.vel.x<3?this.body.gravity.y=.22:game.vel.x<4&&(this.body.gravity.y=.28),me.input.isKeyPressed("jump")?this.body.jumping||this.body.falling||this.runJump():me.input.isKeyPressed("duck")?this.runDuck():this.renderable.isCurrentAnimation("walk")||this.body.jumping||this.body.falling||this.runWalk(),"function"==typeof this.callback.update&&this.callback.update(this,this.matrix));return this.body.update(a),me.collision.check(this),me.Entity.prototype.update.apply(this,[a])||0!==this.body.vel.x||0!==this.body.vel.y},onCollision:function(a){switch(a.b.body.collisionType){case me.collision.types.WORLD_SHAPE:return!0;case me.collision.types.PLAYER_OBJECT:return!1;case me.collision.types.ENEMY_OBJECT:this.callback.colision(this)}return!0},runJump:function(){this.renderable.setCurrentAnimation("jump"),this.body.vel.y=-this.body.maxVel.y*me.timer.tick,this.body.jumping=!0},runDuck:function(){this.body.shapes[0].points[0].y=20,this.body.shapes[0].points[1].y=20,this.body.pos.y=20,this.renderable.setCurrentAnimation("duck")},runWalk:function(){this.body.pos.y=0,this.body.shapes[0].points[0].y=0,this.body.shapes[0].points[1].y=0,this.renderable.setCurrentAnimation("walk")}}),NeuralFactory=me.Container.extend({init:function(a,b,c,d,e,f,g,h){var i=this;game.alive=!1,game.ia.alive=!0,game.ia.alive=!0,me.Container.prototype.init.apply(this),this.firstFix=!0,this.limit=a,this.humans=[],this.down=[],this.minChange=b,this.maxChange=c,this.totalWeight=this.getPosbKeys(6,e,f,g),this.limitChanges=parseInt(this.totalWeight/d),this.neuralColumns=e,this.neuralRows=f,this.neuralOutputs=g;var j=[];this.send=null==h||h;for(var k=0;k<this.limit;k++){var l=this.fixMatrix();j.push(l)}for(var k=0;k<this.limit;k++){var m=j[k],n=new HumanPlayer(this.rand(5,150),300,function(a){a.alive&&(a.alive=!1,a.body.vel.x=0,a.body.vel.y=0,a.distance=game.human.distance,i.popDown(a))},function(a,b){if(a.alive){var c=0,d=0,e=0,f=0,g=(a.body.ancestor.GUID,a.body.ancestor.pos._x);for(var h in game.enemies)void 0!=game.enemies[h].ancestor&&(e=game.enemies[h].ancestor.pos._x-g)>0&&(c=game.enemies[h].width,d=game.enemies[h].height,f=game.res.height-game.enemies[h].ancestor.pos._y);NeuralNetwork.exec(a,b,[e,c,d,f,4*game.vel.x,a.body.gravity.y],i.neuralColumns,i.neuralRows,i.neuralOutputs,function(b){1==b[0]&&0==b[1]&&0==b[2]?a.body.jumping||a.body.falling||a.runJump():0==b[0]&&1==b[1]&&0==b[2]&&a.runDuck()})}},m);this.humans.push(n),me.game.world.addChild(n,50)}},fixMatrix:function(){if(void 0!=game.ia.weightSeq){var a=this.clone(game.ia.weightSeq);if(this.firstFix)this.firstFix=!1;else{var b=this.getPossibilities([]);if(b.length>0)for(var c in b)a[b[c]]=(a[b[c]]+this.rand(this.minChange,this.maxChange))*(this.rand(0,3)%2==0?-1:1),(a[b[c]]>1e3||a[b[c]]<-1e3)&&(a[b[c]]=0)}return a}return[]},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return Object.values(b)},getPossibilities:function(a){if(this.limitChanges>0){var b=!0;do{var c=this.rand(0,this.totalWeight);!this.inArray(c,a)&&a.length<this.limitChanges&&a.push(c),a.length>=this.limitChanges&&(b=!1)}while(b)}return a},inArray:function(a,b){for(var c=b.length,d=0;d<c;d++)if(b[d]==a)return!0;return!1},update:function(a){var b=[];for(var c in this.humans){var d=this.humans[c];b[c]=d.distance+"."+c}b.sort(function(a,b){return b-a});var e=b[0].split(".");this.winner=e[1]},popDown:function(a){this.down.push(a),this.down.length==this.limit&&(game.ia.weightSeq=this.humans[this.winner].weightSeq,console.log("winner"),console.log(game.ia.weightSeq),game.ia.generation++,game.enemies=[],game.vel.x=1,this.send?me.state.change(me.state.NEURALNETWORK2):me.state.change(me.state.NEURALNETWORK))},getPosbKeys:function(a,b,c,d){for(var e=0,f=0;f<b-2;f++)e+=c*c;return a*c+e+c*d},rand:function(a,b){return Math.floor(Math.random()*(b-a+1))+a}}),Plant=me.Entity.extend({init:function(a,b,c,d){this.z=d,this.zi=b,this.ze=c,void 0==a&&(a=0),this.nextFrame=!1,me.Entity.prototype.init.apply(this,[a,380,{width:me.Math.random(b,c),height:70,framewidth:70,frameheight:70}]),this.body.setVelocity(3*game.vel.x,0),this.renderable=new me.Sprite(0,0,{image:me.loader.getImage("plant1"),framewidth:70,frameheight:70}),this.body.collisionType=me.collision.types.NO_OBJECT,this.removed=!1,this.isKinematic=!0},update:function(a){if(game.alive||game.ia.alive){this.body.vel.x+=-this.body.accel.x*me.timer.tick;var b=this.body.ancestor.pos._x+this.body.width;game.res.width-(this.body.ancestor.pos._x+this.body.width)>0&&!this.nextFrame&&(this.nextFrame=!0,me.game.world.addChild(new Plant(b-this.body.accel.x,this.zi,this.ze),this.z)),b<=15&&(this.removed=!0,me.game.world.removeChild(this))}else this.body.setVelocity(0,0);return this.body.update(a),me.Entity.prototype.update.apply(this,[a])||0!==this.body.vel.x||0!==this.body.vel.y}}),ScoreBoard=me.Container.extend({init:function(){me.Container.prototype.init.apply(this),this.addChild(new ScoreItem),this.addChild(new Velocity)}}),ScoreItem=me.Renderable.extend({init:function(){me.Renderable.prototype.init.apply(this,[10,10,0,0]),this.font=new me.BitmapFont(me.loader.getBinary("PressStart2P"),me.loader.getImage("PressStart2P")),this.font.textAlign="right",this.font.textBaseline="bottom",this.distance=0,this.interval=0},update:function(){if(game.alive||game.ia.alive&&!game.ia.reset){this.interval++;var a=3*game.vel.x,b=this.interval/100;this.distance+=a*b-this.distance,game.human.distance=parseInt(this.distance)}else game.ia.alive&&(game.ia.reset=!1),this.interval=0,this.distance=0},draw:function(a){this.font.draw(a,"Distance: "+parseInt(this.distance),600,100),game.ia.generation>0&&this.font.draw(a,"Generation: "+parseInt(game.ia.generation),600,200)}}),Velocity=me.Renderable.extend({init:function(){me.Renderable.prototype.init.apply(this,[10,10,0,0]),this.font=new me.BitmapFont(me.loader.getBinary("PressStart2P"),me.loader.getImage("PressStart2P")),this.font.textAlign="right",this.font.textBaseline="bottom"},update:function(){(game.alive||game.ia.alive)&&(game.vel.x<=3.5?game.vel.x+=.001:game.vel.x=3.5,game.human.velocity=parseInt(3*game.vel.x))},draw:function(a){this.font.draw(a,"Velocity: "+parseInt(3*game.vel.x),600,150)}}),Sidewalk=me.Entity.extend({init:function(a,b){this.z=b,this.nextFrame=!1,me.Entity.prototype.init.apply(this,[a,450,{width:72,height:92,shapes:[new me.Rect(0,0,192,32)],framewidth:72,frameheight:92}]),this.body.setVelocity(3*game.vel.x,0),this.renderable=new me.Sprite(0,0,{image:me.loader.getImage("sidewalk"),framewidth:192,frameheight:32}),this.body.collisionType=me.collision.types.WORLD_SHAPE,this.removed=!1,this.isKinematic=!1},update:function(a){if(this.body.setVelocity(3*game.vel.x,0),game.alive||game.ia.alive){this.body.vel.x+=-this.body.accel.x*me.timer.tick;var b=this.body.ancestor.pos._x+this.body.width;game.res.width-(this.body.ancestor.pos._x+this.body.width)>0&&!this.nextFrame&&(this.nextFrame=!0,me.game.world.addChild(new Sidewalk(b-this.body.accel.x),this.z)),b<=15&&(this.removed=!0,me.game.world.removeChild(this))}else this.body.setVelocity(0,0);return this.body.update(a),me.Entity.prototype.update.apply(this,[a])||0!==this.body.vel.x||0!==this.body.vel.y},onCollision:function(){return!1}}),Start=me.Renderable.extend({init:function(a,b,c,d){me.Renderable.prototype.init.apply(this,[0,0,600,10]),this.font=new me.BitmapFont(me.loader.getBinary("PressStart2P"),me.loader.getImage("PressStart2P")),this.font.textAlign="center",this.font.textBaseline="bottom",this.font2=new me.BitmapFont(me.loader.getBinary("PressStart2P"),me.loader.getImage("PressStart2P")),this.font2.textAlign="left",this.font2.textBaseline="bottom",this.selected=0,this.limit=2,me.input.bindKey(me.input.KEY.ENTER,"start",!0),me.input.bindKey(me.input.KEY.DOWN,"change-down",!0),me.input.bindKey(me.input.KEY.UP,"change-up",!0)},update:function(a){if(me.input.isKeyPressed("start"))switch(this.selected){case 0:me.state.change(me.state.PLAY);break;case 1:break;case 2:me.state.change(me.state.NEURALNETWORK)}else me.input.isKeyPressed("change-down")?this.selected++:me.input.isKeyPressed("change-up")&&this.selected--;this.selected>this.limit?this.selected=0:this.selected<0&&(this.selected=this.limit)},draw:function(a){this.font.draw(a,"ET BILU",600,130),this.font2.draw(a,"["+(0==this.selected?"X":" ")+"] play alone",400,230),this.font2.draw(a,"["+(1==this.selected?"X":" ")+"] vs AI",400,260),this.font2.draw(a,"["+(2==this.selected?"X":" ")+"] see AI",400,290),this.font.draw(a,"PRESS ENTER TO START",600,380)}}),Gameover=me.Stage.extend({init:function(){me.Stage.prototype.init.apply(this)},onResetEvent:function(){this.color=new me.ColorLayer("background","#ffe2b7",0),this.fade=new me.ColorLayer("background","#000000",0),this.fade.setOpacity(.4),this.sidewalk=new Sidewalk(0,10),this.cacti=new Cacti(0,100,1e3,10),this.plant=new Plant(0,500,1e3,10),this.cloud=new Cloud(0,80,1e3,10),this.end=new End,game.alive=!0,game.vel.x=1,me.game.world.addChild(this.color,0),me.game.world.addChild(this.sidewalk,10),me.game.world.addChild(this.cacti,10),me.game.world.addChild(this.plant,10),me.game.world.addChild(this.cloud,10),me.game.world.addChild(this.fade,20),me.game.world.addChild(this.end,30)},onDestroyEvent:function(){me.game.world.removeChild(this.color),me.game.world.removeChild(this.fade)}}),NeuralNetworkScreen=me.Stage.extend({init:function(a){this.send=a,me.Stage.prototype.init.apply(this)},onResetEvent:function(){this.color=new me.ColorLayer("background","#ffe2b7",0),this.scoreBoard=new ScoreBoard,this.sidewalk=new Sidewalk(0,10),this.enemyFactory=new EnemyFactory(me.Math.random(75,150),60),this.neuralFactory=new NeuralFactory(50,10,100,10,4,5,3,this.send),me.game.world.addChild(this.color,0),me.game.world.addChild(this.scoreBoard,100),me.game.world.addChild(this.sidewalk,10),me.game.world.addChild(this.enemyFactory,60),me.game.world.addChild(this.neuralFactory,60)},onDestroyEvent:function(){me.game.world.removeChild(this.color),me.game.world.removeChild(this.scoreBoard),me.game.world.removeChild(this.enemyFactory)}}),PlayScreen=me.Stage.extend({init:function(){me.Stage.prototype.init.apply(this)},onResetEvent:function(){this.color=new me.ColorLayer("background","#ffe2b7",0),this.scoreBoard=new ScoreBoard,this.sidewalk=new Sidewalk(0,10),this.cacti=new Cacti(0,100,1e3,10),this.plant=new Plant(0,500,1e3,10),this.cloud=new Cloud(0,80,1e3,10),this.humanPlayer=new HumanPlayer(30,300,function(a){a.alive=!1,a.body.vel.x=0,a.body.vel.y=0,game.alive=!1,game.vel.x=1,me.state.change(me.state.GAMEOVER)}),this.enemyFactory=new EnemyFactory(75,60),me.game.world.addChild(this.color,0),me.game.world.addChild(this.scoreBoard,100),me.game.world.addChild(this.sidewalk,10),me.game.world.addChild(this.cacti,10),me.game.world.addChild(this.plant,10),me.game.world.addChild(this.cloud,10),me.game.world.addChild(this.humanPlayer,50),me.game.world.addChild(this.enemyFactory,60)},onDestroyEvent:function(){me.game.world.removeChild(this.color),me.game.world.removeChild(this.scoreBoard),me.game.world.removeChild(this.humanPlayer),me.game.world.removeChild(this.enemyFactory)}}),WelcomeScreen=me.Stage.extend({init:function(){me.Stage.prototype.init.apply(this)},onResetEvent:function(){this.color=new me.ColorLayer("background","#ffe2b7",0),this.fade=new me.ColorLayer("background","#000000",0),this.fade.setOpacity(.4),this.sidewalk=new Sidewalk(0,10),this.cacti=new Cacti(0,100,1e3,10),this.plant=new Plant(0,500,1e3,10),this.cloud=new Cloud(0,80,1e3,10),this.start=new Start,me.game.world.addChild(this.color,0),me.game.world.addChild(this.sidewalk,10),me.game.world.addChild(this.cacti,10),me.game.world.addChild(this.plant,10),me.game.world.addChild(this.cloud,10),me.game.world.addChild(this.fade,20),me.game.world.addChild(this.start,30)},onDestroyEvent:function(){me.game.world.removeChild(this.color)}}),NeuralNetwork={exec:function(a,b,c,d,e,f,g){null==b&&(b=[]);for(var h=0,i=0;i<d-1;i++)h+=e*e;var j=c.length*e+h+e*f;0==b.length||b.length!=j?null==a.weightSeq?(a.weightSeq=this.genMatrix(j),b=a.weightSeq):b=a.weightSeq:a.weightSeq=b;for(var k=0,l=[],m=[],n=0;n<d;n++){if(0==n){for(var o in c)for(var p=0,q=0;q<e;q++)l[p]=c[o]*b[k]+(void 0!=l[p]?l[p]:0),p++,k++;p=0;for(var q=0;q<e;q++)l[p]<=0&&(l[p]=0),p++}if(n==d-1){for(var r=n-1,s=l.length,t=0;t<e;t++){for(var u=0,v=(r<1?0:r)*e,p=s,q=0;q<f;q++)l[p]=l[v]*b[k],u+=l[v]*b[k],v++,p++,k++;m.push(u<=0?0:1)}p=s;for(var q=0;q<e;q++)l[p]<=0&&(l[p]=0),p++}else{for(var s=l.length,o=0;o<e;o++)for(var r=n-1,v=(r<1?0:r)*e,p=s,q=0;q<e;q++){l[v],b[k];l[p]=l[v]*b[k]+(void 0!=l[p]?l[p]:0),v++,p++,k++}p=s;for(var q=0;q<e;q++)l[p]<=0&&(l[p]=0),p++}}g(m)},genMatrix:function(a){for(var b=[],c=0;c<a;c++)b.push(this.rand(1,1e3)*(1==this.rand(1,4)?1:-1));return b},rand:function(a,b){return Math.floor(Math.random()*(b-a+1))+a}};